构建微服务架构之九
消息总线
字数
本文参考了
问题
如何实现对配置信息的实时更新
虽然
我们已经能够通过
接口和
仓库的
来实现
仓库中的内容修改触发应用程序的属性更新
但是
如果所有触发操作均需要我们手工去维护
中的应用位置的话
随着系统的不断扩张
会变的越来越难以维护
而消息代理中间件是解决该问题最为合适的方案
消息代理有这样一个功能
消息代理中间件可以将消息路由到一个或多个目的地
利用这个功能
我们就能完美的解决该问题
下面我们来说说
中的具体实现方案
消息总线和
结合实现
的基础知识和使用方法
简介
消息队列
用于应用系统解耦
消息异步分发
是一个在
基础上完整的
可复用的企业消息系统
其优点如下
可靠性高
路由灵活
支持集群
支持互联
便于追踪
的安装与使用实践
实践环境
系统
安装
安装
通过官方下载页面
获取
安装包
直接打开并完成安装
安装
通过官方下载页面
获取
安装包
下载完成后
直接运行安装程序
安装完成之后
会自动的注册为服务
并以默认配置启动起来
启动
管理
我们可以直接通过配置文件的访问进行管理
也可以通过
的访问进行管理
下面我们将介绍如何通过
进行管理
执行
命令
开启
管理插件
这样我们就可以通过浏览器来进行管理了
打开浏览器并访问
并使用默认用户
登录
密码也为
我们可以看到如下图的管理页面
下面我们开始具体介绍
的配置
并以一个
与
结合的例子来实现配置内容的实时更新
准备工作
需要用到已经实现的关于
的几个工程
定义在
仓库中的一个目录
其中存储了应用名为
的多环境配置文件
配置文件中有一个
参数
配置了
仓库
并注册到了
的服务端
通过
发现
的客户端
应用名为
用来访问配置服务器以获取配置信息
该应用中提供了一个
接口
它会获取
中的
属性返回
扩展
应用
修改
增加
模块
最终的
文件如下
在配置文件中增加关于
的连接和用户信息
最终配置如下
启动
再启动两个
使用不同的端口
我们可以在
中的控制台中看到如下内容
在启动时候
客户端程序多了一个
请求
先访问两个
的
请求
会返回当前
中的
属性
接着
我们修改
中的
属性值
并发送
请求到其中的一个
最后
我们再分别访问启动的两个
的
请求
此时这两个请求都会返回最新的
中的
属性
到这里
我们已经能够通过
来实时更新总线上的属性配置了
架构优化
既然
的
接口提供了针对服务和实例进行配置更新的参数
那么我们的架构也可以做出一些调整
在之前的架构中
服务的配置更新需要通过向具体服务中的某个实例发送请求
再触发对整个服务集群的配置更新
虽然能实现功能
但是这样的结果是
我们指定的应用实例就会不同于集群中的其他应用实例
这样会增加集群内部的复杂度
不利于将来的运维工作
比如
我们需要对服务实例进行迁移
那么我们不得不修改
中的配置等
所以我们要尽可能的让服务集群中的各个节点是对等的
因此
我们将之前的架构做了一些调整
如下图所示
在
中也引入
将配置服务端也加入到消息总线中来
请求不在发送到具体服务实例上
而是发送给
并可通过
参数来指定需要更新配置的服务或实例
通过上面的改动
我们的服务实例就不需要再承担触发配置更新的职责
同时
对于
的触发等配置都只需要针对
即可
从而简化了集群上的一些维护工作
消息总线和
结合实现
简介
是一个由
开发的分布式消息系统
它于
年初开源
现在由著名的
基金会维护与开发
使用
实现
被用作
的活动流和运营数据处理的管道
现在也被诸多互联网企业广泛地用作为数据流管道和消息系统
首先
我们需要从官网上下载安装介质
下载地址为
本例中采用的版本为
图片
由于
的设计中依赖了
所以我们可以在
和
目录中除了看到
相关的内容之外
还有
相关的内容
其中
目录存放了
和
的命令行工具
根目录下是适用于
的
而
下的则是适用于
下的
我们可以根据实际的系统来设置环境变量
以方便后续的使用和操作
而在
目录中
则是用来存放了关于
与
的配置信息
然后
启动
执行命令
该命令需要指定
的配置文件位置才能正确启动
的压缩包中包含了其默认配置
开发与测试环境不需要修改
图片
图片
最后
启动
执行命令
该命令也需要指定
配置文件的正确位置
如上命令中指向了解压目录包含的默认配置
若在测试时
使用外部集中环境的
的话
我们可以在该配置文件中通过
参数来设置
的地址和端口
它默认会连接本地
端口的
如果需要设置多个
节点
可以为这个参数配置多个
地址
并用逗号分割
比如
图片
创建
执行命令
通过该命令
创建一个名为
的
该
包含一个分区一个
在创建完成后
可以使用
命令来查看当前的
整合
上面使用
实现消息总线的案例中
我们已经通过引入
模块
完成了使用
来实现的消息总线
若我们要使用
来实现消息总线时
只需要把
替换成
模块
在
的
节点中进行修改
具体如下
如果我们在启动
时均采用了默认配置
那么我们不需要再做任何其他配置就能在本地实现从
到
的切换
在
启动时
我们可以在控制台中看到如下输出
从控制台的输出内容
我们可以看到
连接到了
中
并使用了名为
的
此时
我们可以使用
命令来查看当前
中的
若已成功启动了
并配置正确
我们就可以在
中看到已经多了一个名为
的
我们再启动配置了
模块的
可以看到控制台中输出如下内容
可以看到
启动时输出了类似的内容
他们都订阅了名为
的
在启动了
和
之后
为了更明显地观察消息总线刷新配置的效果
我们可以在本地启动多个不同端口的
此时
我们的
以及多个
都已经连接到了由
实现的消息总线上
我们可以先访问各个
上的
请求
查看他获取到的配置内容
然后
修改
中对应的参数内容
再访问各个
上的
请求
可以看到配置内容并没有改变
最后
我们向
发送
请求
此时我们再去访问各个
上的
请求
就能获得到最新的配置信息
各客户端上的配置都已经加载为最新的
配置内容
从
的控制台中
我们可以看到如下内容
监听类记录了收到远程刷新请求
并刷新了
属性的日志
完整示例
日记本
著作权归作者所有
举报文章
下载
生成长微博图片
更多分享
为开发人员提供了快速构建分布式系统中一些常见模式的工具
例如配置管理
服务发现
断路器
智能路由
微代理
控制总线
分布式系统的协调导致了样板模式
使用
开发人员可以快速地支持实现这些模式的服务和应用程序
他们将在任何分布式
卡卡罗
参考指南
参考指南
介绍
转载自
带目录浏览地址
毛宇鹏
入门手册
服务器配置
重要说明
本方是翻译自
这个文章
感谢
宜家拍了一支广告
大家集体
颅内高潮
近两年
国内外各大视频网站
音乐平台逐渐开始流行一种以听觉为主视觉为辅的
娱乐项目
从
年起
上就陆陆续续出现了一些
小组和
主播
他们会通过窃窃私语的声音
咀嚼食物的声音
手指和物体摩擦发出的声音来刺激听众感官
大创意
转
龙巅
谈谈鱼缸中的氨化细菌
硝化细菌
反硝化细菌及稳定水族环境的建立
要创造一个优质的水环境
关键是要培养一套稳定的过滤系统
所谓过滤系统不是简单的把水抽到过滤棉再返回水族箱中
我们要创造的过滤系统是能够把鱼类的粪便
体表排出来的废物
残留的饵料等分解为对于鱼伤害最小的硝酸盐
再通过反硝化细菌和植物的固氮作用把硝酸盐吸收掉
这个过
柏衡
推荐一个开发资料备忘录合集网站
首页
咕咕鷄
月
泓默和阿米一起策划的手作教室
课程咨询
请添加泓默的微信
注明咨询
月课程
朱泓默
不让工作影响家庭
这两天
我对工作长度有些不满
又没有解决方案
所以心里烦躁
另又觉得有点吃亏
不值
回家后不知觉的带着情绪
晚上和儿子出去玩
他才玩一会儿就要回家
我突然生气
一路上没有沟通
我想先让自己冷静
回家后在门口他看看我
尴尬的笑了笑
我也不好意思的笑了笑
我说
我们好好谈谈吧
蜂蜜