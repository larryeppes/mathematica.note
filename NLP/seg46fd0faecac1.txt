卡卡罗
字数
为开发人员提供了快速构建分布式系统中一些常见模式的工具
例如配置管理
服务发现
断路器
智能路由
微代理
控制总线
分布式系统的协调导致了样板模式
使用
开发人员可以快速地支持实现这些模式的服务和应用程序
他们将在任何分布式环境中运行良好
包括开发人员自己的笔记本电脑
裸机数据中心
以及
等托管平台
版本
特性
专注于提供良好的开箱即用经验的典型用例和可扩展性机制覆盖
分布式
版本化配置
服务注册和发现
路由
调用
负载均衡
断路器
分布式消息传递
云原生应用程序
云原生
是一种应用开发风格
鼓励在持续交付和价值驱动开发领域轻松采用最佳实践
相关的学科是建立
其中开发实践与交付和运营目标相一致
例如通过使用声明式编程和管理和监控
以多种具体方式促进这些开发风格
起点是一组功能
分布式系统中的所有组件都需要或需要时轻松访问
许多这些功能都由
覆盖
我们在
中建立
更多的由
提供为两个库
和
上下文为
应用程序
引导上下文
加密
刷新范围和环境端点
的
提供实用程序和特殊服务
是一组在不同的
实现中使用的抽象和常用类
例如
如果由于
非法密钥大小
而导致异常
并且您正在使用
的
则需要安装
加密扩展
无限强度管理策略文件
有关详细信息
请参阅以下链接
将文件解压缩到
文件夹
无论您使用的是哪个版本的
注意
根据非限制性
许可证发布
如果您想为文档的这一部分做出贡献
或者发现错误
请在
中找到项目中的源代码和问题跟踪器
上下文
应用程序上下文服务
对于如何使用
构建应用程序有一个看法
例如它具有常规配置文件的常规位置
以及用于常见管理和监视任务的端点
建立在此之上
并添加了一些可能系统中所有组件将使用或偶尔需要的功能
引导应用程序上下文
一个
应用程序通过创建一个
引导
上下文来进行操作
这个上下文是主应用程序的父上下文
开箱即用
负责从外部源加载配置属性
还解密本地外部配置文件中的属性
这两个上下文共享一个
这是任何
应用程序的外部属性的来源
属性的优先级高
因此默认情况下不能被本地配置覆盖
引导上下文使用与主应用程序上下文不同的外部配置约定
因此使用
或
代替引导和主上下文的外部配置
例
如果您的应用程序需要服务器上的特定于应用程序的配置
那么设置
在
或
中是个好主意
您可以通过设置
例如在系统属性中
来完全禁用引导过程
应用程序上下文层次结构
如果您从
或
构建应用程序上下文
则将
上下文添加为该上下文的父级
这是一个
的功能
即子上下文从其父进程继承属性源和配置文件
因此与不使用
构建相同上下文相比
主
应用程序上下文将包含其他属性源
额外的财产来源是
如果在
上下文中找到任何
则可选
显示为高优先级
并且具有非空属性
一个例子是来自
服务器的属性
有关如何自定义此属性源的内容的
说明
请参阅
下文
如果
配置文件处于活动状态
则为朋友
如果您有一个
或属性
那么这些属性用于配置引导上下文
然后在父进程设置时将它们添加到子上下文中
它们的优先级低于
或属性
以及作为创建
应用程序的过程的正常部分添加到子级的任何其他属性源
有关如何自定义这些属性源的内容的
说明
请参阅
下文
由于属性源的排序规则
引导
条目优先
但请注意
这些条目不包含来自
的任何数据
它具有非常低的优先级
但可用于设置默认值
您可以通过简单地设置您创建的任何
的父上下文来扩展上下文层次结构
例如使用自己的界面
或使用
方便方法
和
引导环境将是您创建自己的最高级祖先的父级
层次结构中的每个上下文都将有自己的
引导
属性源
可能为空
以避免无意中将值从父级升级到其后代
层次结构中的每个上下文
原则上
也可以具有不同的
因此如果存在配置服务器
则不同的远程属性源
普通的
应用程序上下文行为规则适用于属性解析
子环境中的属性通过名称和属性源名称覆盖父项中的属性
如果子级具有与父级名称相同的属性源
一个来自父母的孩子不包括在孩子中
请注意
允许您在整个层次结构中共享
但这不是默认值
因此
兄弟情境尤其不需要具有相同的资料或财产来源
尽管它们与父母共享共同点
改变引导位置
可以使用
默认
引导
或
默认为空
指定
或
位置
例如在系统属性中
这些属性的行为类似于具有相同名称的
变体
实际上它们用于通过在其
中设置这些属性来设置引导
如果在正在构建的上下文中有活动的配置文件
来自
或通过
则该配置文件中的属性也将被加载
就像常规的
应用程序
例如来自
的
开发
简介
覆盖远程
的值
通过引导上下文添加到应用程序的属性源通常是
远程
例如从配置服务器
并且默认情况下
不能在本地覆盖
除了在命令行上
如果要允许您的应用程序使用自己的系统属性或配置文件覆盖远程属性
则远程属性源必须通过设置
在本地设置本身不起作用
授予权限
一旦设置了该标志
就会有一些更精细的设置来控制远程属性与系统属性和应用程序本地配置的位置
覆盖任何本地属性源
如果只有系统属性和
应该覆盖远程设置
而不是本地配置文件
自定义引导配置
可以通过在
键下添加条目
来训练引导上下文来执行任何您喜欢的操作
这是用于创建上下文的
类的逗号分隔列表
您可以在此处创建要用于自动装配的主应用程序上下文的任何
并且还有
类型的
的特殊合同
如果要控制启动顺序
默认顺序为
最后
可以使用
标记类
警告
添加自定义
时
请注意
您添加的类不是错误的
到您的
主
应用程序上下文中
可能不需要它们
对于您的
或
注释配置类尚未涵盖的启动配置类
请使用单独的包名称
引导过程通过将初始化器注入主
实例
即正常的
启动顺序
无论是作为独立应用程序运行还是部署在应用程序服务器中
结束
首先
从
中找到的类创建引导上下文
然后在
类型的所有
添加到主
开始之前
自定义引导属性源
引导过程添加的外部配置的默认属性源是
但您可以通过将
类型的
添加到引导上下文
通过
添加其他源
您可以使用此方法从其他服务器或数据库中插入其他属性
作为一个例子
请考虑以下微不足道的自定义定位器
传入的
是要创建的
的
即为我们提供额外的属性来源的
它将已经具有正常的
提供的资源来源
因此您可以使用它们来定位特定于此
的属性源
例如通过将其绑定在
上
如在默认情况下所做的那样
属性源定位器
如果你在这个类中创建一个
然后添加一个
包含
那么
将显示在其类路径中包含该
的任何应用程序中
环境变化
应用程序将收听
并以几种标准方式进行更改
用户可以以常规方式添加
附加
当观察到
时
它将有一个已更改的键值列表
应用程序将使用以下内容
重新绑定上下文中的任何
为
中的任何属性设置记录器级别
请注意
配置客户端不会通过默认轮询查找
中的更改
通常我们不建议检测更改的方法
尽管可以使用
注释进行设置
如果您有一个扩展的客户端应用程序
那么最好将
广播到所有实例
而不是让它们轮询更改
例如使用
总线
涵盖了大量的刷新用例
只要您真的可以更改
并发布事件
这些
是公开的
部分内核为
您可以通过访问
端点
普通
执行器功能
来验证更改是否绑定到
例如
可以在运行时更改其
由
创建的默认
是一个
并且动态增加容量
重新绑定
不会覆盖另一大类用例
您需要更多的控制刷新
并且您需要更改在整个
上是原子的
为了解决这些担忧
我们有
刷新范围
当配置更改时
标有
的
将得到特殊处理
这解决了状态
在初始化时只注入配置的问题
例如
如果通过
更改数据库
时
有开放连接
那么我们可能希望这些连接的持有人能够完成他们正在做的工作
然后下一次有人从游泳池借用一个连接
他得到一个新的
刷新范围
是在使用时初始化的懒惰代理
即当调用一个方法时
并且作用域作为初始值的缓存
要强制
重新初始化下一个方法调用
您只需要使其缓存条目无效
是上下文中的一个
它有一个公共方法
来清除目标缓存中的范围内的所有
还有一个
方法可以按名称刷新单个
此功能在
端点
通过
或
中公开
注意
技术上
在
类上工作
但可能会导致令人惊讶的行为
例如
这
并不
意味着该类中定义的所有
本身都是
具体来说
任何取决于这些
的东西都不能依赖它们在刷新启动时被更新
除非它本身在
在其中将重新刷新并重新注入其依赖关系
那么它们将从刷新的
重新初始化
加密和解密
具有一个用于在本地解密属性值的
预处理器
它遵循与
相同的规则
并通过
具有相同的外部配置
因此
您可以使用
格式的加密值
只要有一个有效的密钥
那么在主应用程序上下文获取
之前
它们将被解密
要在应用程序中使用加密功能
您需要在您的类路径中包含
安全性
协调
并且还需要全面强大的
扩展你的
如果由于
非法密钥大小
而导致异常
并且您正在使用
的
则需要安装
加密扩展
无限强度管理策略文件
有关详细信息
请参阅以下链接
将文件解压缩到
文件夹
无论您使用的是哪个版本的
端点
对于
执行器应用程序
还有一些额外的管理端点
到
以更新
并重新绑定
和日志级别
重新加载引导带上下文并刷新
关闭
并重新启动
默认情况下禁用
和
调用
方法
和
普通抽象
诸如服务发现
负载平衡和断路器之类的模式适用于所有
客户端可以独立于实现
例如通过
或
发现
的消耗的共同抽象层
提供
注释
这通过
查找
接口的实现
的实现将在
键下的
中添加一个配置类
实现的示例是
发现
和
发现
默认情况下
的实现将使用远程发现服务器自动注册本地
服务器
可以通过在
中设置
来禁用此功能
现在提供了一个
接口
它提供了诸如
和
之类的方法
允许您提供定制的注册服务
是一个标记界面
每个
实现都有自己的
实现
服务部门自动注册
默认情况下
实现将自动注册正在运行的服务
要禁用该行为
有两种方法
您可以设置
永久禁用自动注册
您还可以设置
以通过配置禁用该行为
服务注册执行器端点
提供
致动器端点
该端点依赖于
应用程序上下文中的
通过
调用
将返回
的状态
具有
主体的同一端点的
将将当前
的状态更改为新值
请参阅您正在使用的
实现的文档
以获取更新状态的允许值和为状态获取的值
作为负载平衡器客户端
可以自动配置为使用功能区
要创建负载平衡
创建
并使用
限定符
警告
通过自动配置不再创建
它必须由单个应用程序创建
需要使用虚拟主机名
即服务名称
而不是主机名
客户端用于创建完整的物理地址
有关如何设置
的详细信息
请参阅
重试失败的请求
负载平衡
可以配置为重试失败的请求
默认情况下
该逻辑被禁用
您可以通过将
重试
添加到应用程序的类路径来启用它
负载平衡
将符合与重试失败请求相关的一些
配置值
如果要在类路径中使用
重试来禁用重试逻辑
则可以设置
您可以使用的属性是
和
请参阅
文档
了解属性的具体内容
注意
上述示例中的
应替换为您的
客户端名称
多个
对象
如果你想要一个没有负载平衡的
创建一个
并注入它
要创建
时
使用
限定符来访问负载平衡
重要
请注意下面示例中的普通
声明的
注释
以消除不合格的
注入
小费
如果您看到错误
请尝试注入
或设置
忽略网络接口
有时
忽略某些命名网络接口是有用的
因此可以将其从服务发现注册中排除
例如
在
容器中运行
可以设置正则表达式的列表
这将导致所需的网络接口被忽略
以下配置将忽略
接口和以
开头的所有接口
您还可以强制使用正则表达式列表中指定的网络地址
您也可以强制仅使用站点本地地址
有关更多详细信息
请参阅
是什么是站点本地地址
为分布式系统中的外部配置提供服务器和客户端支持
使用
您可以在所有环境中管理应用程序的外部属性
客户端和服务器上的概念映射与
和
抽象相同
因此它们与
应用程序非常契合
但可以与任何以任何语言运行的应用程序一起使用
随着应用程序通过从开发人员到测试和生产的部署流程
您可以管理这些环境之间的配置
并确定应用程序具有迁移时需要运行的一切
服务器存储后端的默认实现使用
因此它轻松支持标签版本的配置环境
以及可以访问用于管理内容的各种工具
很容易添加替代实现
并使用
配置将其插入
快速开始
启动服务器
该服务器是一个
应用程序
所以您可以从
运行它
而不是喜欢
主类是
然后尝试一个客户端
定位资源的默认策略是克隆一个
仓库
在
并使用它来初始化一个迷你
小应用程序的
用于枚举属性源并通过
端点发布
服务具有以下格式的资源
其中
应用程序
作为
中的
注入
即常规的
应用程序中通常是
应用程序
配置文件
是活动配置文件
或逗号分隔列表的属性
是可选的
标签
默认为
服务器从
存储库
必须提供
为远程客户端提供配置
客户端使用
要在应用程序中使用这些功能
只需将其构建为依赖于
的
引导应用程序
例如
查看配置客户端或示例应用程序的测试用例
添加依赖关系的最方便的方法是通过
启动器
还有一个
用户的父
和
和用于
和
用户的
版本管理属性文件
示例
配置
的
那么你可以创建一个标准的
应用程序
像这个简单的
服务器
当它运行它将从端口
上的默认本地配置服务器接收外部配置
如果它正在运行
要修改启动行为
您可以使用
如
更改配置服务器的位置
但用于应用程序上下文的引导阶段
例如
引导属性将在
端点中显示为高优先级属性源
例如
名为
远程存储库的
文件名
的属性源包含值为
的属性
是最高优先级
注意
属性源名称中的
是
存储库
而不是配置服务器
服务器
服务器为外部配置
名称值对或等效的
内容
提供了基于资源的
服务器可以使用
注释轻松嵌入到
应用程序中
所以这个应用程序是一个配置服务器
像所有的默认端口
上运行的所有
应用程序一样
但您可以通过各种方式将其切换到常规端口
最简单的也是设置一个默认配置库
它是通过启动它的
在
中有一个
另一个是使用你自己的
例如
其中
是包含
和属性文件的
仓库
注意
在
中
如果文件
为绝对驱动器前缀
例如
则需要额外的
小费
以下是上面示例中创建
仓库的方法
警告
使用本地文件系统进行
存储库仅用于测试
使用服务器在生产环境中托管配置库
警告
如果您只保留文本文件
则配置库的初始克隆将会快速有效
如果您开始存储二进制文件
尤其是较大的文件
则可能会遇到服务器中第一个配置请求和
或内存不足错误的延迟
环境库
您要在哪里存储配置服务器的配置数据
管理此行为的策略是
服务于
对象
此
是
包括
作为主要功能
的域的浅层副本
资源由三个变量参数化
映射到客户端的
映射到客户端上的
逗号分隔列表
和
这是一个服务器端功能
标记
版本
的配置文件集
存储库实现通常表现得像一个
应用程序从
等于
参数加载配置文件
等于
参数
配置文件的优先级规则也与常规启动应用程序相同
活动配置文件优先于默认配置
如果有多个配置文件
则最后一个获胜
例如向
添加条目
示例
客户端应用程序具有此引导配置
通常使用
应用程序
这些属性也可以设置为环境变量或命令行参数
如果存储库是基于文件的
则服务器将从
创建
在所有客户端之间共享
以
优先
如果
文件中有文件指向
配置文件
那么应用的优先级更高
按照列出的配置文件的顺序
并且如果存在特定于配置文件的
或属性
文件
那么这些文件也应用于优先级高于默认值
较高优先级转换为
之前列出的
这些规则与独立的
应用程序相同
后端
的默认实现使用
后端
这对于管理升级和物理环境以及审核更改非常方便
要更改存储库的位置
可以在
中设置
配置属性
例如
如果您使用
前缀进行设置
则应从本地存储库中工作
以便在没有服务器的情况下快速方便地启动
但在这种情况下
服务器将直接在本地存储库上进行操作
而不会克隆如果它不是裸机
因为配置服务器永远不会更改
远程
资源库
要扩展
并使其高度可用
您需要将服务器的所有实例指向同一个存储库
因此只有共享文件系统才能正常工作
即使在这种情况下
最好使用共享文件系统存储库的
协议
以便服务器可以将其克隆并使用本地工作副本作为缓存
该存储库实现将
资源的
参数映射到
标签
提交
分支名称或标签
如果
分支或标签名称包含斜杠
则应使用特殊字符串
指定
中的标签
以避免与其他
路径模糊
例如
如果标签为
则替换斜杠将导致标签看起来像
如果您使用像
这样的命令行客户端
例如使用引号将其从
中转出来
请小心
中的方括号
中的占位符
服务器支持一个
仓库
其中包含
和
以及
的占位符
如果需要
请记住标签应用为
标签
因此
您可以使用
例如
轻松支持
每个应用程序的一个
策略
或使用类似模式但使用
的
每个配置文件一个
策略
模式匹配和多个存储库
还可以通过应用程序和配置文件名称的模式匹配来支持更复杂的需求
模式格式是带有通配符的
名称的逗号分隔列表
可能需要引用以通配符开头的模式
例
如果
不匹配任何模式
它将使用在
下定义的默认
在上面的例子中
对于
简单
存储库
模式是
即所有配置文件中只匹配一个名为
简单
的应用程序
本地
存储库与所有配置文件中以
开头的所有应用程序名称匹配
将
后缀自动添加到任何没有配置文件匹配器的模式
注意
在上述
简单
示例中使用的
单行
快捷方式只能在唯一要设置的属性为
的情况下使用
如果您需要设置其他任何内容
凭据
模式等
则需要使用完整的表单
中的
属性实际上是一个数组
因此您可以使用属性文件中的
数组
或
等后缀
绑定到多个模式
如果要运行具有多个配置文件的应用程序
则可能需要执行此操作
例
注意
将猜测包含不在
中的配置文件的模式意味着您实际上要匹配从此模式开始的配置文件列表
因此
是
这是常见的
您需要在本地的
开发
配置文件中运行应用程序
但也可以远程运行
云
配置文件
每个存储库还可以选择将配置文件存储在子目录中
搜索这些目录的模式可以指定为
例如在顶层
在此示例中
服务器搜索顶级和
子目录以及名称以
开头的任何子目录中的配置文件
默认情况下
首次请求配置时
服务器克隆远程存储库
服务器可以配置为在启动时克隆存储库
例如在顶层
在此示例中
服务器在启动之前克隆了
的
然后它接受任何请求
所有其他存储库将不被克隆
直到请求从存储库配置
注意
在配置服务器启动时设置要克隆的存储库可以帮助在配置服务器启动时快速识别错误配置的源
例如
无效的存储库
配置源不启用
时
配置服务器可能会成功启动配置错误或无效的配置源
而不会检测到错误
直到应用程序从该配置源请求配置为止
认证
要在远程存储库上使用
基本身份验证
请分别添加
和
属性
不在
中
例如
如果您不使用
和用户凭据
当您将密钥存储在默认目录
中
并且
指向
位置时
也应该开箱即用
例如
配置
云配置
必须在
文件中存在
服务器的条目
并且它是
格式
其他格式
如
不受支持
为了避免意外
您应该确保
服务器的
文件中只有一个条目
并且与您提供给配置服务器的
匹配
如果您在
中使用了主机名
那么您希望在
文件中具有这一点
而不是
使用
访问存储库
因此您发现的任何文档都应适用
代理设置可以
设置
也可以通过系统属性
和
与任何其他
进程相同
小费
如果您不知道
目录使用
来处理设置的位置
例如
使用
进行认证
认证也可以完成
当从命令行使用
时
使用身份验证助手
该帮助器不与
库一起使用
因此如果
与
模式匹配
则将创建用于
的
始终看起来像
如果您使用
提供用户名和密码
那么这些
必须是用于访问存储库的
和
如果不指定用户名和密码
则将使用
默认凭据提供程序链
检索
和
如果您的
与
模式
上述
匹配
则必须在用户名和密码或默认凭据提供程序链支持的某个位置中提供有效的
凭据
实例可以使用
实例的
角色
注意
是一个可选的依赖关系
如果
不在您的类路径上
则无论
服务器
如何
都将不会创建
代码提交凭据提供程序
搜索路径中的占位符
服务器还支持具有
和
以及
如果需要
占位符的搜索路径
例
在资源库中搜索与目录
以及顶级
相同名称的文件
通配符在具有占位符的搜索路径中也是有效的
搜索中包含任何匹配的目录
力拉入
存储库
如前所述
服务器克隆远程
存储库
如果某种方式本地副本变脏
例如
通过操作系统进程更改文件夹内容
则
服务器无法从远程存储库更新本地副本
要解决这个问题
有一个
属性
如果本地副本是脏的
将使
强制从远程存储库拉
例
如果您有多个存储库配置
则可以为每个存储库配置
属性
例
注意
属性的默认值为
版本控制后端文件系统使用
警告
使用基于
的后端
文件被检出或克隆到本地文件系统
默认情况下
它们放在系统临时目录中
前缀为
在
上
例如可以是
一些操作系统会
定期清除
临时目录
这可能会导致意外的行为
例如缺少属性
为避免此问题
请通过将
或
设置为不驻留在系统临时结构中的目录来更改
使用的目录
文件系统后端
配置服务器中还有一个不使用
的
本机
配置文件
只是从本地类路径或文件系统加载配置文件
您想要指向的任何静态
要使用本机配置文件
只需使用
启动
注意
请记住使用
前缀的文件资源
缺省没有前缀通常是
与任何
配置一样
您可以嵌入
样式的环境占位符
但请记住
中的绝对路径需要额外的
例如
警告
的默认值与本地
应用程序
所以
相同
这不会将
从服务器暴露给所有客户端
因为在发送到客户端之前
服务器中存在的任何属性源都将被删除
小费
文件系统后端对于快速入门和测试是非常好的
要在生产中使用它
您需要确保文件系统是可靠的
并在配置服务器的所有实例中共享
搜索位置可以包含
和
的占位符
以这种方式
您可以隔离路径中的目录
并选择一个有用的策略
例如每个应用程序的子目录或每个配置文件的子目录
如果您不在搜索位置使用占位符
则该存储库还将
资源的
参数附加到搜索路径上的后缀
因此属性文件将从每个搜索位置加载
并
具有相同名称的子目录作为标签
标记的属性在
环境中优先
因此
没有占位符的默认行为与添加以
结尾的搜索位置与
相同
后端
服务器还支持
作为后端
是安全访问秘密的工具
一个秘密是你想要严格控制访问的任何东西
如
密钥
密码
证书等等
为任何秘密提供统一的界面
同时提供严格的访问控制和记录详细的审核日志
有关
的更多信息
请参阅
快速入门指南
要使配置服务器使用
后端
您必须使用
配置文件运行配置服务器
例如在配置服务器的
中
您可以添加
默认情况下
配置服务器将假定您的
服务器正在运行于
它还将假定后端名称为
密钥为
所有这些默认值都可以在配置服务器的
中配置
以下是可配置
属性的表
所有属性前缀为
名称默认值
秘密
应用
所有可配置的属性可以在
找到
运行配置服务器后
可以向服务器发出
请求
以从
后端检索值
为此
您需要为
服务器创建一个令牌
首先放置一些数据给你
例如
现在
将
请求发送给您的配置服务器以检索值
在提出上述要求后
您应该会看到类似的回复
多个
来源
使用
时
您可以为应用程序提供多个属性源
例如
假设您已将数据写入
中的以下路径
写入
的
可
用于使用配置服务器的所有应用程序
名称为
的应用程序将具有写入
和
的任何属性
当
启用
配置文件时
写入所有上述路径的属性将可用
列表中第一个路径中的属性优先于其他路径
与所有应用共享配置
基于文件的存储库
使用基于文件
即
和
的存储库
文件名为
的资源在所有客户端应用程序
所以
等
之间共享
您可以使用这些文件名的资源来配置全局默认值
并根据需要将其覆盖应用程序特定的文件
属性覆盖
功能也可用于设置全局默认值
并且允许占位符应用程序在本地覆盖它们
小费
使用
本机
配置文件
本地文件系统后端
建议您使用不属于服务器自身配置的显式搜索位置
否则
默认搜索位置中的
资源将被删除
因为它们是服务器的一部分
服务器
当使用
作为后端时
可以通过将配置放在
中与所有应用程序共享配置
例如
如果您运行此
命令
使用配置服务器的所有应用程序都可以使用属性
和
复合环境库
在某些情况下
您可能希望从多个环境存储库中提取配置数据
为此
只需在配置服务器的应用程序属性或
文件中启用多个配置文件即可
例如
如果您要从
存储库以及
存储库中提取配置数据
那么您将为配置服务器设置以下属性
除了指定
的每个
之外
还可以指定
属性
属性允许您指定所有存储库的优先级顺序
属性的数值越低
优先级越高
存储库的优先顺序将有助于解决包含相同属性的值的存储库之间的任何潜在冲突
注意
从环境仓库检索值时的任何类型的故障将导致整个复合环境的故障
注意
当使用复合环境时
重要的是所有
都包含相同的标签
如果您有类似于上述的环境
并且使用标签
请求配置数据
但是
不包含称为
的分支
则整个请求将失败
自定义复合环境库
除了使用来自
的环境存储库之外
还可以提供自己的
作为复合环境的一部分
要做到这一点
你的
必须实现
接口
如果要在复合环境中控制自定义
的优先级
您还应该实现
接口并覆盖
方法
如果您不实现
接口
那么您的
将被赋予最低优先级
属性覆盖
配置服务器具有
覆盖
功能
允许操作员为应用程序使用普通的
钩子不会意外更改的所有应用程序提供配置属性
要声明覆盖
只需将名称
值对的地图添加到
例如
将导致配置客户端的所有应用程序独立于自己的配置读取
当然
应用程序可以以任何方式使用
中的数据
因此覆盖不可强制执行
但如果它们是
客户端
则它们确实提供有用的默认行为
小费
通过使用反斜杠
来转义
或
例如
解析
可以转义正常的
具有
的环境占位符到
除非应用程序提供自己的
请注意
在
中
您不需要转义反斜杠本身
而是在您执行的属性文件中配置服务器上的覆盖
您可以通过在远程存储库中设置标志
默认为
将客户端中所有覆盖的优先级更改为更为默认值
允许应用程序在环境变量或系统属性中提供自己的值
健康指标
配置服务器附带运行状况指示器
检查配置的
是否正常工作
默认情况下
它要求
应用程序名称为
配置文件和
实现提供的默认标签
您可以配置运行状况指示器以检查更多应用程序以及自定义配置文件和自定义标签
例如
您可以通过设置
来禁用运行状况指示器
安全
您可以以任何对您有意义的方式
从物理网络安全性到
承载令牌
保护您的
并且
和
可以轻松做任何事情
要使用默认的
配置的
安全性
只需在类路径中包含
例如通过
默认值为
的用户名和随机生成的密码
这在实践中不会非常有用
因此建议您配置密码
通过
并对其进行加密
请参阅下文的说明怎么做
加密和解密
重要
先决条件
要使用加密和解密功能
您需要在
中安装全面的
默认情况下不存在
您可以从
下载
加密扩展
无限强度管理策略文件
并按照安装说明
实际上将
目录中的
个策略文件替换为您下载的文件
如果远程属性源包含加密内容
以
开头的值
则在通过
发送到客户端之前
它们将被解密
这种设置的主要优点是
当它们
静止
时
属性值不必是纯文本
例如在
仓库中
如果值无法解密
则从属性源中删除该值
并添加具有相同键的附加属性
但以
无效
作为前缀
和
不适用
的值
通常为
这主要是为了防止密码被用作密码并意外泄漏
如果要为
客户端应用程序设置远程配置存储库
可能会包含一个
例如
文件中的加密值不能用引号括起来
否则不会解密该值
您可以安全地将此纯文本推送到共享
存储库
并且保密密码
服务器还暴露了
和
端点
假设这些端点将被保护
并且只能由授权代理访问
如果您正在编辑远程配置文件
可以使用
通过
到
端点来加密值
例如
注意
如果要加密的值具有需要进行
编码的字符
则应使用
选项
来确保它们已正确编码
逆向操作也可通过
获得
如果服务器配置了对称密钥或全密钥对
小费
如果您使用
进行测试
则使用
而不是
或设置显式
以确保在有特殊字符时正确地对数据进行编码
特别是棘手
将加密的值添加到
前缀
然后再将其放入
或属性文件中
然后再提交并将其推送到远程可能不安全的存储区
和
端点也都接受
形式的路径
当客户端调用到主环境资源时
可以用于每个应用程序
名称
和配置文件控制密码
注意
为了以这种细微的方式控制密码
您还必须提供一种
类型的
可以为每个名称和配置文件创建不同的加密器
默认提供的不会这样做
所有加密使用相同的密钥
命令行客户端
安装了
扩展
也可以用于加密和解密
例如
要在文件中使用密钥
例如用于加密的
公钥
使用
键入键值
并提供文件路径
例如
关键参数是强制性的
尽管有一个
前缀
密钥管理
可以使用对称
共享
密钥或非对称密钥
密钥对
非对称选择在安全性方面是优越的
但是使用对称密钥往往更方便
因为它只是配置的一个属性值
要配置对称密钥
您只需要将
设置为一个秘密字符串
或使用环境变量
将其从纯文本配置文件中删除
要配置非对称密钥
您可以将密钥设置为
编码的文本值
也可以通过密钥库设置密钥
例如由
附带的
实用程序创建
密钥库属性为
等于
位置
解锁密钥库
和
以识别商店中使用的密钥
使用公钥进行加密
需要私钥进行解密
因此
原则上您只能在服务器中配置公钥
如果您只想进行加密
并准备使用私钥本地解密值
实际上
您可能不想这样做
因为它围绕所有客户端传播密钥管理流程
而不是将其集中在服务器中
另一方面
如果您的配置服务器真的相对不安全
并且只有少数客户端需要加密的属性
这是一个有用的选项
创建用于测试的密钥库
要创建一个密钥库进行测试
您可以执行以下操作
将
文件放在类路径
例如
中
然后在您的
中配置服务器
使用多个键和键旋转
除了加密属性值中的
前缀之外
配置服务器在
编码
密文开始前查找
前缀
零或多个
密钥被传递给
它可以执行找到密码的
所需的任何逻辑
如果配置了密钥库
默认定位器将使用
前缀提供的别名
即使用如下密码查找存储中的密钥
定位器将寻找一个名为
的键
也可以通过前缀中的
值提供一个秘密
但是如果不是默认值
则使用密钥库密码
这是您在构建密钥库时获得的
并且不指定密码
如果你
这样做
提供一个秘密建议你也加密使用自定义
的秘密
如果密钥只用于加密几个字节的配置数据
即它们没有在其他地方使用
则密码转换几乎不是必需的
但是如果存在安全漏洞
有时您可能需要更改密钥实例
在这种情况下
所有客户端都需要更改其源配置文件
例如
以
格式
并在所有密码中使用新的
前缀
当然事先检查密钥别名在配置服务器密钥库中是否可用
小费
如果要让
处理所有加密以及解密
也可以将
前缀添加到发布到
端点的明文中
服务加密
有时您希望客户端在本地解密配置
而不是在服务器中进行配置
在这种情况下
您仍然可以拥有
加密和解密端点
如果您提供
配置来定位密钥
但是您需要使用
明确地关闭传出属性的解密
如果您不关心端点
那么如果您既不配置密钥也不配置使能的标志
则应该起作用
服务替代格式
来自环境端点的默认
格式对于
应用程序的消费是完美的
因为它直接映射到
抽象
如果您喜欢
可以通过向资源路径
或
添加后缀来使用与
或
属性相同的数据
这对于不关心
端点的结构的应用程序或其提供的额外的元数据的应用程序来说可能是有用的
例如
不使用
的应用程序可能会受益于此方法的简单性
和属性表示有一个额外的标志
作为一个布尔查询参数
提供
以标示
形式的源文档中的占位符
应在输出中解析可能在渲染之前
对于不了解
占位符惯例的消费者来说
这是一个有用的功能
注意
使用
或属性格式存在局限性
主要是与元数据的丢失有关
被构造为属性源的有序列表
例如
名称与源相关联
即使源的起源具有多个源
并且原始源文件的名称丢失
和属性表也合并成一个映射
表示不一定是后台存储库中
源的忠实表示
它是由平面属性源的列表构建的
并且必须对键的形式进行假设
服务纯文本
您的应用程序可能需要通用的纯文本配置文件
而不是使用
抽象
或
中的其他替代表示形式或属性格式
配置服务器通过
附加的端点提供这些服务
其中
和
的含义与常规环境端点相同
但
是文件名
例如
此端点的源文件位于与环境端点相同的方式
与属性或
文件相同的搜索路径
而不是聚合所有匹配的资源
只返回匹配的第一个
找到资源后
使用正确格式
的占位符将使用有效的
解析为应用程序名称
配置文件和标签提供
以这种方式
资源端点与环境端点紧密集成
例如
如果您有一个
或
资源库的布局
其中
如下所示
和
这样
那么
资源如下所示
和
这样
注意
就像环境配置的源文件一样
配置文件
用于解析文件名
因此
如果您想要一个特定于配置文件的文件
则
将由一个名为
的文件解析
优先于
嵌入配置服务器
配置服务器最好作为独立应用程序运行
但如果需要
可以将其嵌入到另一个应用程序中
只需使用
注释
在这种情况下可以使用的可选属性是
它是一个标志
表示服务器应该从其自己的远程存储库配置自身
该标志默认关闭
因为它可能会延迟启动
但是当嵌入在另一个应用程序中时
以与其他应用程序相同的方式初始化是有意义的
注意
应该是显而易见的
但请记住
如果您使用引导标志
配置服务器将需要在
中配置其名称和存储库
要更改服务器端点的位置
您可以
可选
设置
例如
以提供前缀下的资源
前缀应该开始但不以
结尾
它被应用于配置服务器中的
即
前缀
和
之下
如果您想直接从后端存储库
而不是从配置服务器
读取应用程序的配置
这基本上是一个没有端点的嵌入式配置服务器
如果不使用
注释
仅设置
则可以完全关闭端点
推送通知和
许多源代码存储库提供程序
例如
或
将通过
通知您存储库中的更改
您可以通过提供商的用户界面将
配置为
和一组感兴趣的事件
例如
将使用包含提交列表的
主体和
等于
的头文件发送到
如果在
库中添加依赖关系并激活配置服务器中的
则启用
端点
当
被激活时
配置服务器将发送一个
针对他认为可能已经改变的应用程序
变更检测可以进行策略化
但默认情况下
它只是查找与应用程序名称匹配的文件的更改
例如
针对的是
应用程序
针对所有应用程序
如果要覆盖该行为的策略是
它接受
请求标头和正文作为参数
并返回更改的文件路径列表
默认配置与
或
配合使用
除了来自
或
的
通知之外
您还可以通过使用表单编码的身体参数
通过
为
来触发更改通知
这将广播到匹配
模式的应用程序
可以包含通配符
注意
只有在配置服务器和客户端应用程序中激活
时才会传送
注意
默认配置还检测本地
存储库中的文件系统更改
在这种情况下不使用
但是一旦编辑配置文件
将会播放刷新
客户端
应用程序可以立即利用
配置服务器
或应用程序开发人员提供的其他外部属性源
并且还将获取与
更改事件相关的一些其他有用功能
配置第一引导
这是在类路径上具有
的任何应用程序的默认行为
配置客户端启动时
它将通过配置服务器
通过引导配置属性
绑定
并使用远程属性源初始化
这样做的最终结果是所有想要使用
的客户端应用程序需要
或环境变量
服务器地址位于
默认为
发现第一个引导
如果您正在使用
实现
例如
和
服务发现或
不支持此功能
那么您可以使用
如果您想要发现服务注册
但在默认的
配置优先
模式下
客户端将无法利用注册
如果您希望使用
找到配置服务器
可以通过设置
默认为
来实现
最终的结果是
客户端应用程序都需要具有适当发现配置的
或环境变量
例如
使用
您需要定义
服务器地址
例如
使用此选项的价格是启动时额外的网络往返
以定位服务注册
好处是配置服务器可以更改其坐标
只要发现服务是一个固定点
默认的服务标识是
但您可以使用
在客户端进行更改
在服务器上以服务的通常方式更改
例如设置
发现客户端实现都支持某种元数据映射
例如
我们有
可能需要在其服务注册元数据中配置
的一些其他属性
以便客户端可以正确连接
如果使用
安全配置服务器
则可以将凭据配置为
用户名
和
密码
并且如果配置服务器具有上下文路径
您可以设置
例如
对于作为
客户端的配置服务器
配置客户端快速失败
在某些情况下
如果服务无法连接到配置服务器
则可能希望启动服务失败
如果这是所需的行为
请设置引导配置属性
客户端将以异常停止
配置客户端重试
如果您希望配置服务器在您的应用程序启动时可能偶尔不可用
您可以要求它在发生故障后继续尝试
首先
您需要设置
然后您需要添加
和
到您的类路径
默认行为是重试
次
初始退避间隔为
指数乘数为
用于后续退避
您可以使用
配置属性配置这些属性
和其他
小费
要完全控制重试
请使用
添加
类型的
重试有一个
可以轻松创建一个
查找远程配置资源
配置服务从
提供属性源
客户端应用程序中的默认绑定
实际上是
所有这些都可以通过设置
其中
是
或
来覆盖
标签
可用于回滚到以前版本的配置
使用默认的
实现
它可以是
标签
分支名称或提交
标签也可以以逗号分隔的列表形式提供
在这种情况下
列表中的项目会逐个尝试
直到成功
例如
当您可能希望将配置标签与您的分支对齐
但使其成为可选
例如
时
这对于在特征分支上工作时可能很有用
安全
如果您在服务器上使用
基本安全性
那么客户端只需要知道密码
如果不是默认用户名
您可以通过配置服务器
或通过单独的用户名和密码属性
例如
要么
和
值覆盖
中提供的任何内容
如果您在
部署应用程序
则提供密码的最佳方式是通过服务凭证
例如
因为它甚至不需要在配置文件中
在
上为本地工作的用户提供的服务的一个例子
名为
如果您使用另一种形式的安全性
则可能需要向
提供
例如
通过在引导上下文中获取它并注入一个
提供
例如通过在引导上下文中获取它并注入
健康指标
提供一个尝试从
加载配置的
运行状况指示器
可以通过设置
来禁用运行状况指示器
由于性能原因
响应也被缓存
默认缓存生存时间为
分钟
要更改该值
请设置
属性
以毫秒为单位
提供自定义
在某些情况下
您可能需要从客户端自定义对配置服务器的请求
通常这涉及传递特殊的
标头来对服务器的请求进行身份验证
要提供自定义
请按照以下步骤操作
设置
以禁用现有的配置服务器属性源
使用
实现创建一个新的配置
在
中创建一个名为
的文件
并指定您的自定义配置
当使用
作为配置服务器的后端时
客户端将需要为服务器提供一个令牌
以从
中检索值
可以通过在
中设置
在客户端中提供此令牌
中的嵌套密钥
支持将键嵌入存储在
中的值
例如
此命令将向您的
编写一个
对象
要在
中访问这些值
您将使用传统的点
注释
例如
上述代码将
变量设置为
该项目通过自动配置为
应用程序提供
集成
并绑定到
环境和其他
编程模型成语
通过几个简单的注释
您可以快速启用和配置应用程序中的常见模式
并通过经过测试的
组件构建大型分布式系统
提供的模式包括服务发现
断路器
智能路由
和客户端负载平衡
服务发现
客户端
服务发现是基于微服务架构的关键原则之一
尝试配置每个客户端或某种形式的约定可能非常困难
可以非常脆弱
服务发现服务器和客户端是
可以将服务器配置和部署为高可用性
每个服务器将注册服务的状态复制到其他服务器
如何包含
客户端
要在您的项目中包含
客户端
请使用组
和工件
的启动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
注册
当客户端注册
时
它提供关于自身的元数据
例如主机和端口
健康指示符
主页等
从属于服务的每个实例接收心跳消息
如果心跳失败超过可配置的时间表
则通常将该实例从注册表中删除
示例
客户端
即完全正常的
应用程序
在这个例子中
我们明确地使用
但只有
可用
你也可以使用
需要配置才能找到
服务器
例
其中
是一个魔术字符串后备值
为任何不表示首选项的客户端提供服务
即它是有用的默认值
从
获取的默认应用程序名称
服务
虚拟主机和非安全端口分别为
和
将应用程序同时进入一个
实例
即注册自己
和一个
客户端
即它可以查询注册表以查找其他服务
实例行为由
配置键驱动
但是如果您确保您的应用程序具有
这是
服务
或
的默认值
那么默认值将是正常的
有关可
配置
选项
的更多详细信息
请参阅
和
使用
服务器进行身份验证
如果其中一个
网址中包含一个凭据
如
基本身份验证将自动添加到您的
客户端
对于更复杂的需求
您可以创建
类型的
并将
实例注入到其中
所有这些都将应用于从客户端到服务器的调用
注意
由于
中的限制
不可能支持每个服务器的基本身份验证凭据
所以只能使用第一个找到的集合
状态页和健康指标
实例的状态页面和运行状况指示器分别默认为
和
它们是
执行器应用程序中有用端点的默认位置
如果您使用非默认上下文路径或
路径
例如
或管理端点路径
例如
则需要更改这些
即使是执行器应用程序
例
这些链接显示在客户端使用的元数据中
并在某些情况下用于决定是否将请求发送到应用程序
因此如果它们是准确的
这是有帮助的
注册安全应用程序
如果您的应用程序想通过
联系
则可以分别在
即
中设置两个标志
这将使
发布实例信息显示安全通信的明确偏好
将始终为以这种方式配置的服务返回一个
并且
本机
实例信息将具有安全的健康检查
由于
内部的工作方式
它仍然会发布状态和主页的非安全网址
除非您也明确地覆盖
您可以使用占位符来配置
实例
例如
请注意
是仅在稍后版本的
中可用的本地占位符
您也可以使用
占位符实现同样的功能
例如使用
注意
如果您的应用程序在代理服务器后面运行
并且
终止服务在代理中
例如
如果您运行在
或其他平台作为服务
则需要确保代理
转发
头部被截取并处理应用程序
应用程序中的嵌入式
容器会自动执行
标头的显式配置
你这个错误的一个迹象就是你的应用程序本身所呈现的链接是错误的
错误的主机
端口或协议
的健康检查
默认情况下
使用客户端心跳来确定客户端是否启动
除非另有规定
否则发现客户端将不会根据
执行器传播应用程序的当前运行状况检查状态
这意味着成功注册后
将永远宣布申请处于
状态
通过启用
运行状况检查可以改变此行为
从而将应用程序状态传播到
因此
每个其他应用程序将不会在
之外的状态下将流量发送到应用程序
警告
只能在
中设置
设置
中的值将导致不期望的副作用
例如在具有
状态的
中注册
如果您需要更多的控制健康检查
您可以考虑实施自己的
实例和客户端的元数据
值得花点时间了解
元数据的工作原理
以便您可以在平台上使用它
有主机名
地址
端口号
状态页和运行状况检查等标准元数据
这些发布在服务注册表中
由客户使用
以直接的方式联系服务
额外的元数据可以添加到
中的实例注册中
并且这将在远程客户端中可访问
但一般不会更改客户端的行为
除非意识到元数据的含义
下面描述了几个特殊情况
其中
已经为元数据映射指定了含义
在
上使用
有一个全局路由器
所以同一个应用程序的所有实例都具有相同的主机名
在具有相似架构的其他
解决方案中也是如此
这不一定是使用
的障碍
但如果您使用路由器
建议
甚至是强制性的
具体取决于您的平台的设置方式
则需要明确设置主机名和端口号
安全或非安全
以便他们使用路由器
您可能还需要使用实例元数据
以便您可以区分客户端上的实例
例如
在自定义负载平衡器中
默认情况下
为
例如
根据
实例中安全规则的设置方式
您可以注册并使用主机
的
地址进行直接的服务到服务调用
此功能尚未在
上提供
在
上使用
如果应用程序计划将部署到
云
那么
实例必须被配置为
意识到
这可以通过定制来完成
方式如下
更改
实例
香草
实例注册了与其主机名相同的
即每个主机只有一个服务
提供了一个明智的默认
如下所示
例如
使用
您可以通过在
中提供唯一的标识符来覆盖此
例如
使用这个元数据和在
上部署的多个服务实例
随机值将在那里进行
以使实例是唯一的
在
中
将在
应用程序中自动填充
因此不需要随机值
使用
一旦您拥有
或
的应用程序
您就可以使用它来从
服务器
发现服务实例
一种方法是使用本机
而不是
云
例如
小费
不要使用
方法或
方法
或
可能尚未启动的任何地方
它被初始化为
带有
所以最早可以依靠它可用的是另一个具有更高阶段的
本机
的替代方案
您不必使用原始的
通常在某种包装器后面使用它更为方便
支持
客户端构建器
还支持
使用逻辑
服务标识符
而不是物理
要使用固定的物理服务器列表配置
您可以将
设置为逗号分隔的物理地址
或主机名
列表
其中是客户端的
您还可以使用
它为
不具体的发现客户端提供简单的
例如
为什么注册服务这么慢
作为一个实例也包括定期心跳到注册表
通过客户端的
默认持续时间为
秒
在实例
服务器和客户端在其本地缓存中都具有相同的元数据
因此可能需要
个心跳
之前
客户端才能发现服务
您可以使用
更改期限
这将加快客户端连接到其他服务的过程
在生产中
最好坚持使用默认值
因为服务器内部有一些计算可以对租赁更新期进行假设
区
如果您已将
客户端部署到多个区域
您可能希望这些客户端在使用另一个区域中的服务之前
利用同一区域内的服务
为此
您需要正确配置您的
客户端
首先
您需要确保将
服务器部署到每个区域
并且它们是彼此的对等体
有关详细信息
请参阅
区域和区域
部分
接下来
您需要告知
您的服务所在的区域
您可以使用
属性来执行此操作
例如
如果
部署到
和
则需要在
中设置以下
属性
区服务
第
区的服务
服务发现
服务器
如何包含
服务器
要在项目中包含
服务器
请使用组
和工件
的启动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
如何运行
服务器
示例
服务器
服务器具有一个带有
的主页
并且根据
下的正常
功能的
端点
背景阅读
看
助焊剂电容
和
谷歌小组讨论
小费
由于
的依赖关系解决规则和父母的
功能缺乏
只要依靠
就可能导致应用程序启动失败
要解决这个问题
必须添加
插件
并且必须导入
云启动器父母
的
高可用性
区域和地区
服务器没有后端存储
但是注册表中的服务实例都必须发送心跳以保持其注册更新
因此可以在内存中完成
客户端还具有
注册的内存缓存
因此
他们不必为注册表提供每个服务请求
默认情况下
每个
服务器也是一个
客户端
并且需要
至少一个
服务
来定位对等体
如果您不提供该服务将运行和工作
但它将淋浴您的日志与大量的噪音无法注册对等体
关于区域和区域的客户端
支持的详细信息
请参见
下文
独立模式
只要存在某种监视器或弹性运行时间
例如
两个高速缓存
客户机和服务器
和心跳的组合使独立的
服务器对故障具有相当的弹性
在独立模式下
您可能更喜欢关闭客户端行为
因此不会继续尝试并且无法访问其对等体
例
请注意
指向与本地实例相同的主机
同行意识
通过运行多个实例并请求他们相互注册
可以使
更具弹性和可用性
事实上
这是默认的行为
所以你需要做的只是为对方添加一个有效的
例如
服务器
在这个例子中
我们有一个
文件
可以通过在不同的
配置文件中运行
在
台主机
和
上运行相同的服务器
您可以使用此配置来测试单个主机上的对等体感知
通过操作
来解析主机名
在生产中没有太多价值
事实上
如果您在一台知道自己的主机名的机器上运行
默认情况下使用
查找
则不需要
您可以向系统添加多个对等体
只要它们至少一个边缘彼此连接
则它们将在它们之间同步注册
如果对等体在物理上分离
在数据中心内或多个数据中心之间
则系统原则上可以分裂脑型故障
喜欢
地址
在某些情况下
优先发布服务的
地址而不是主机名
将
设置为
并且当应用程序向
注册时
它将使用其
地址而不是其主机名
断路器
客户端
的创造了一个调用的库
实现了
断路器图案
在微服务架构中
通常有多层服务调用
图
微服务图
较低级别的服务中的服务故障可能导致用户级联故障
当对特定服务的呼叫达到一定阈值时
中的默认值为
秒内的
次故障
电路打开
不进行通话
在错误和开路的情况下
开发人员可以提供后备
图
回退防止级联故障
开放式电路会停止级联故障
并允许不必要的或失败的服务时间来愈合
回退可以是另一个
保护的调用
静态数据或一个正常的空值
回退可能被链接
所以第一个回退使得一些其他业务电话又回到静态数据
如何加入
要在项目中包含
请使用组
和
的启动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
示例启动应用程序
由名为
的
库提供
在连接到
断路器的代理中使用该注释自动包装
断路器计算何时打开和关闭电路
以及在发生故障时应该做什么
要配置
您可以使用
属性列出
注释
请参阅
这里
了解更多详情
有关可用属性的详细信息
请参阅
维基
传播安全上下文或使用
范围
如果您希望某些线程本地上下文传播到
默认声明将不起作用
因为它在线程池中执行命令
超时
您可以使用某些配置或直接在注释中使用与使用相同的线程来调用
方法是要求使用不同的
隔离策略
例如
如果您使用
或
同样的事情也适用
您将知道何时需要执行此操作
因为运行时异常说它找不到范围的上下文
您还可以将
属性设置为
这样做会自动配置一个
并发策略插件钩子
他将
从主线程传送到
命令使用的钩子
不允许注册多个
并发策略
因此可以通过将自己的
声明为
来实现扩展机制
将在
上下文中查找您的实现
并将其包装在自己的插件中
健康指标
连接断路器的状态也暴露在呼叫应用程序的
端点中
指标流
要使
指标流包含对
的依赖
这将使
作为管理端点
断路器
仪表板
的主要优点之一是它收集关于每个
的一套指标
仪表板以有效的方式显示每个断路器的运行状况
图
仪表板
超时和
客户
当使用包含
客户端的
命令时
您需要确保您的
超时配置为长于配置的
超时
包括可能进行的任何潜在的重试
例如
如果您的
连接超时为一秒钟
并且
客户端可能会重试该请求三次
那么您的
超时应该略超过三秒钟
如何包含
仪表板
要在项目中包含
仪表板
请使用组
和工件
的启动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
要运行
仪表板使用
注释您的
主类
然后访问
并将仪表板指向
客户端应用程序中的单个实例
端点
从个人实例看
数据在系统整体健康方面不是非常有用
是将所有相关
端点聚合到
仪表板中使用的
的应用程序
个人实例位于
运行
就像使用
注释
例如使用
设置类路径
注释主类一样简单
来自
维基的
所有文档配置属性都适用
唯一的区别是
不需要预先添加的端口
除非
自动处理
注意
默认情况下
通过在
中查找其
条目
然后将
附加到注册的实例上查找
端点
这意味着如果
在自己的端口上运行
这是默认值
则对
的调用将失败
要使涡轮机找到正确端口的
流
您需要向实例的元数据中添加
配置密钥
是涡轮机将用于查找实例的尤里卡服务列表
涡轮流然后在
仪表板中使用如下
如果名称为
默认值
则可以省略群集参数
参数必须与
中的条目相匹配
从
返回的值是大写字母
因此如果有一个名为
的
注册了一个应用程序
我们预计此示例可以正常工作
可以通过
中的
表达式以
身份
进行自定义
默认值为
这意味着
最终作为集群密钥
即客户的
具有
一个不同的例子是
它将从
名称获取集群名称
另一个例子
在这种情况下
来自
个服务的集群名称从其元数据映射中提取
并且预期具有包含
和
的值
要为所有应用程序使用
默认
集群
您需要一个字符串文字表达式
带单引号
并且如果它在
中也使用双引号进行转义
提供了一个
它具有运行
服务器所需的所有依赖关系
只需创建一个
应用程序并用
注释它
注意
默认情况下
允许
使用主机和端口允许每个主机在每个群集中进行多个进程
如果你想建成
本地
的行为
它
不会
允许每个主机上的多个过程
每簇
关键实例
是主机名
然后将该属性设置
在某些环境中
例如
在
设置中
从所有分布式
命令中提取度量的经典
模型不起作用
在这种情况下
您可能希望让
命令将度量标准推送到
并且
可以使用消息传递
您需要在客户端上执行的所有操作都为您选择的
和
添加依赖关系
有关经纪人的详细信息
请参阅
文档
以及如何配置客户端凭据
但是应该为当地经纪人开箱即用
在服务器端只需创建一个
应用程序并使用
进行注释
默认情况下将在
端口
将您的
仪表板指向该端口
任何路径
您可以使用
或
自定义端口
如果类路径中还有
和
那么您可以通过提供不同的
在单独端口
默认情况下使用
打开
端点
然后
您可以将
仪表板指向
服务器
而不是单个
流
如果
在
上的端口
上运行
则将
放在
仪表板中的流输入字段中
电路将以各自的
为前缀
后跟一个点
然后是电路名称
提供了一个
它具有您需要的
服务器运行所需的所有依赖项
只需添加您选择的
例如
您需要
来运行应用程序
因为它是基于
的
客户端负载平衡器
是一个客户端负载均衡器
它可以很好地控制
和
客户端的行为
已经使用
所以如果您使用
则本节也适用
中的中心概念是指定客户端的概念
每个负载平衡器是组合的组合的一部分
它们一起工作以根据需要联系远程服务器
并且集合具有您将其作为应用程序开发人员
例如使用
注释
的名称
使用
为每个命名的客户端根据需要创建一个新的合奏作为
这包含
除其他外
和
如何加入
要在项目中包含
请使用组
和工件
的起始器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
自定义
客户端
您可以使用
中的外部属性来配置
客户端的某些位
这与使用
本身没有什么不同
只能使用
配置文件
本机选项可以在
功能区内核心部分
中作为静态字段进行检查
还允许您通过使用
声明其他配置
位于
之上
来完全控制客户端
例
在这种情况下
客户端由
中已经存在的组件与
中的任何组件组成
后者通常会覆盖前者
警告
必须是
但请注意
它不在主应用程序上下文的
中
否则将由所有
共享
如果您使用
或
则需要采取措施避免包含
例如将其放在一个单独的
不重叠的包中
或者指定要在
默认情况下为
提供以下
创建一个类型的
并将其放置在
配置
例如上面的
中
允许您覆盖所描述的每个
例
这用
代替
使用属性自定义
客户端
从版本
开始
现在支持使用属性与
文档兼容来自
定义
客户端
这允许您在不同环境中更改启动时的行为
支持的属性如下所示
应以
为前缀
应实施
应实施
应实施
应实施
应实施
注意
在这些属性中定义的类优先于使用
定义的
和由
提供的默认值
要设置服务名称
的
您可以设置以下内容
有关
提供的实现
请参阅
文档
在
中使用
当
与
结合使用
即两者都在类路径上
时
将被扩展为
扩展名为
的服务器列表
它还用
替换
接口
代理到
以确定服务器是否启动
默认情况下安装的
是一个
其目的是使物理元数据可用于负载平衡器
而不使用
元数据
这是
依赖的
默认情况下
服务器列表将使用实例元数据
如远程客户端集合
中提供的
区域
信息构建
如果缺少
则可以使用服务器主机名中的域名作为代理用于区域
如果设置了标志
一旦区域信息可用
它可以在
中使用
默认情况下
它将用于定位与客户端相同区域的服务器
因为默认值为
默认情况下
客户端的区域与远程实例的方式相同
即通过
注意
设置客户端区域的正统
方式是通过一个名为
的配置属性
如果可用
将优先使用所有其他设置
请注意
该键必须被引用
在
配置中
注意
如果没有其他的区域数据源
则基于客户端配置
与实例配置相反
进行猜测
我们将
从区域名称映射到区域列表
并将实例自己的区域的第一个区域
即
其默认为
为与本机
的兼容性
示例
如何使用
不使用
是一种方便的方式来抽象远程服务器的发现
因此您不必在客户端中对其
进行硬编码
但如果您不想使用它
和
仍然是适用的
假设您已经为
商店
申请了
并且
未被使用
甚至不在类路径上
客户端默认为已配置的服务器列表
您可以提供这样的配置
示例
在
中禁用
使用
设置属性
将明确禁用在
中使用
直接使用
您也可以直接使用
例
缓存
配置
每个
命名的客户端都有一个相应的子应用程序上下文
维护
这个应用程序上下文在第一个请求中被延迟加载到命名的客户端
可以通过指定
客户端的名称
在启动时
可以更改此延迟加载行为
从而热切加载这些子应用程序上下文
声明性
客户端
是一个声明式的
服务客户端
这使得
服务客户端的写入更加方便要使用
创建一个界面并对其进行注释
它具有可插入注释支持
包括
注释和
注释
还支持可插拔编码器和解码器
增加了对
注释的支持
并使用
中默认使用的
集成
和
以在使用
时提供负载均衡的
客户端
如何加入
要在您的项目中包含
请使用组
和工件
的启动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
示例
应用
在
注释中
值
以上
存储
是一个任意的客户端名称
用于创建
负载平衡器
有关
支持的详细信息
请参阅
下文
您还可以使用
属性
绝对值或只是主机名
指定
应用程序上下文中的
的名称是该接口的完全限定名称
要指定您自己的别名值
您可以使用
注释的
值
以上的
客户端将会发现
商店
服务的物理地址
如果您的应用程序是
客户端
那么它将解析
服务注册表中的服务
如果您不想使用
您可以简单地配置外部配置中的服务器列表
例如
参见
上文
覆盖
默认值
的
支持的中心概念是指定的客户端
每个假装客户端都是组合的组件的一部分
它们一起工作以根据需要联系远程服务器
并且该集合具有您将其作为应用程序开发人员使用
注释的名称
根据需要
使用
为每个已命名的客户端创建一个新的集合
这包含
除其他外
和
可以通过使用
声明额外的配置
来完全控制假客户端
例
在这种情况下
客户端由
中的组件与
中的任何组件组成
后者将覆盖前者
注意
不需要使用
注释
但是
如果是
则请注意将其从任何
中排除
否则将包含此配置
因为它将成为
等的默认来源
指定时
这可以通过将其放置在任何
或
的单独的不重叠的包中
或者可以在
中明确排除
注意
属性现在已被弃用
有利于
属性
警告
以前
使用
属性
不需要
属性
现在需要使用
和
属性支持占位符
默认为
提供以下
其中包含
如果
启用
则为
否则将使用默认的
客户端
可以通过将
或
设置为
并将它们放在类路径上来使用
和
客户端
默认情况下
不
提供以下
但是仍然从应用程序上下文中查找这些类型的
以创建假客户机
创建一个类型的
并将其放置在
配置
例如上面的
中
允许您覆盖所描述的每个
例
这将
替换为
并将
添加到
的集合中
可以在
属性
中以与上述相似的方式指定默认配置
不同之处在于
此配置将适用于
所有
假客户端
注意
如果您需要在
中使用
绑定变量
或在
中禁用
手动创建
客户端
在某些情况下
可能需要以上述方法不可能自定义您的
客户端
在这种情况下
您可以使用
创建客户端
下面是一个创建两个具有相同接口的
客户端的示例
但是使用单独的请求拦截器配置每个客户端
注意
在上面的例子中
是
提供的默认配置
注意
是客户端将要求的服务的名称
支持
如果
在类路径上
将用断路器包装所有方法
还可以返回
这样就可以使用无效模式
调用
或
或异步使用
调用
要在每个客户端基础上禁用
支持创建一个带有
原型
范围的香草
例如
警告
在
达尔斯顿发布之前
如果
在类路径
中默认将所有方法包装在断路器中
这种默认行为在
达尔斯顿改变了赞成选择加入的方式
回退
支持回退的概念
当电路断开或出现错误时执行的默认代码路径
要为给定的
启用回退
请将
属性设置为实现回退的类名
如果需要访问导致回退触发的原因
可以使用
内的
属性
警告
在
中执行回退以及
回退的工作方式存在局限性
当前返回
和
的方法目前不支持回退
和
当使用
与
回退时
在同一类型的
中有多个
这将导致
不起作用
因为没有一个
或者标记为主
要解决这个问题
将所有
实例标记为
所以
将知道要注入哪个
在某些情况下
这可能是不可取的
要关闭此行为
将
的
属性设置为
继承支持
通过单继承接口支持样板
这样就可以将常用操作分成方便的基本界面
注意
通常不建议在服务器和客户端之间共享接口
它引入了紧耦合
并且实际上并不适用于当前形式的
方法参数映射不被继承
请求
响应压缩
您可以考虑为
请求启用请求或响应
压缩
您可以通过启用其中一个属性来执行此操作
请求压缩为您提供与您为
服务器设置的设置相似的设置
这些属性可以让您对压缩介质类型和最小请求阈值长度有选择性
日志记录
为每个创建的
客户端创建一个记录器
默认情况下
记录器的名称是用于创建
客户端的接口的完整类名
日志记录仅响应
级别
您可以为每个客户端配置的
对象告诉
记录多少
选择是
无记录
只记录请求方法和
以及响应状态代码和执行时间
记录基本信息以及请求和响应标头
记录请求和响应的头文件
正文和元数据
例如
以下将
设置为
外部配置
客户端配置库
它是所有
组件用于配置的库
是
项目的
扩展
它允许通过轮询源进行更改或将源更改推送到客户端来进行配置更新
使用
类作为属性的句柄
示例
具有自己的一组配置文件和加载优先级
应用程序一般不应直接使用
但本地仍然需要配置
工具
具有
环境桥
所以
可以从
环境读取属性
这允许
项目使用正常的配置工具链
同时允许他们在文档中大部分配置
工具
路由器和过滤器
路由在微服务体系结构的一个组成部分
例如
可以映射到您的
应用程序
映射到用户服务
并将
映射到商店服务
是
的基于
的路由器和服务器端负载均衡器
使用
进行以下操作
认证
洞察
压力测试
金丝雀测试
动态路由
服务迁移
负载脱落
安全
静态响应处理
主动
主动流量管理
的规则引擎允许基本上写任何
语言编写规则和过滤器
内置
和
注意
配置属性
已被两个新属性
和
替换
分别默认为
和
注意
所有路由的默认
隔离模式
为
如果此隔离模式是首选
则
可以更改为
如何加入
要在您的项目中包含
请使用组
和
的启动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
嵌入式
反向代理
已经创建了一个嵌入式
代理
以简化
应用程序想要代理对一个或多个后端服务的呼叫的非常常见的用例的开发
此功能对于用户界面对其所需的后端服务进行代理是有用的
避免了对所有后端独立管理
和验证问题的需求
要启用它
使用
注释
主类
并将本地调用转发到相应的服务
按照惯例
具有
用户
的服务将接收来自位于
具有前缀
的代理的请求
代理使用
来定位一个通过发现转发的实例
并且所有请求都以
命令执行
所以故障将显示在
指标中
一旦电路打开
代理将不会尝试联系服务
注意
启动器不包括发现客户端
因此对于基于服务
的路由
您还需要在类路径中提供其中一个路由
例如
要跳过自动添加的服务
请将
设置为服务标识模式列表
如果一个服务匹配一个被忽略的模式
而且包含在明确配置的路由映射中
那么它将被无符号
例
在此示例中
除
用户
之外
所有服务都被忽略
要扩充或更改代理路由
可以添加如下所示的外部配置
这意味着对
的
呼叫转发到
用户
服务
例如
转发到
要获得对路由的更细粒度的控制
您可以独立地指定路径和
这意味着对
的
呼叫转发到
服务
路由必须有一个
路径
可以指定为蚂蚁样式模式
所以
只匹配一个级别
但
分层匹配
后端的位置可以被指定为
用于发现的服务
或
对于物理位置
例如
这些简单的
路由不会被执行为
也不能使用
对多个
进行负载平衡
为此
请指定
并为
配置
客户端
目前需要在
中禁用
支持
详见
上文
例如
您可以使用
在
和路由之间提供约定
它使用名为
的正则表达式从
中提取变量并将它们注入到路由模式中
这意味着
将被映射到路由
任何正则表达式都被接受
但所有命名组都必须存在于
和
中
如果
与
不匹配
则使用默认行为
在上面的示例中
将被映射到路由
检测不到版本
此功能默认禁用
仅适用于已发现的服务
要为所有映射添加前缀
请将
设置为一个值
例如
默认情况下
请求被转发之前
代理前缀被删除
使用
关闭此行为
您还可以关闭从各路线剥离服务特定的前缀
例如
注意
仅适用于
中设置的前缀
它对给定路由
中定义的前缀有影响
在本示例中
对
的请求将转发到
上的
服务
条目实际上绑定到类型为
的对象
如果您查看该对象的属性
您将看到它还具有
可重试
标志
将该标志设置为
使
客户端自动重试失败的请求
如果需要
可以使用
客户端配置修改重试操作的参数
默认情况下
将
标头添加到转发的请求中
关闭
默认情况下
前缀路径被删除
对后端的请求会拾取一个标题
上述示例中的
如果您设置默认路由
则
的应用程序可以作为独立服务器
例如
将路由所有流量
即
到
服务
如果需要更细粒度的忽略
可以指定要忽略的特定模式
在路由位置处理开始时评估这些模式
这意味着前缀应包含在模式中以保证匹配
忽略的模式跨越所有服务
并取代任何其他路由规范
这意味着诸如
的所有呼叫将被转发到
用户
服务上的
但是包含
的呼叫将无法解决
警告
如果您需要您的路由保留订单
则需要使用
文件
因为使用属性文件将会丢失订购
例如
如果要使用属性文件
则
路径可能会在
路径前面展开
从而使
路径不可达
客户端
使用的默认
客户端现在由
支持
而不是不推荐使用的
要分别使用
或使用
集合
或
和敏感标题
在同一个系统中的服务之间共享标题是可行的
但是您可能不希望敏感标头泄漏到外部服务器的下游
您可以在路由配置中指定被忽略头文件列表
起着特殊的作用
因为它们在浏览器中具有明确的语义
并且它们总是被视为敏感的
如果代理的消费者是浏览器
则下游服务的
也会导致用户出现问题
因为它们都被混淆
所有下游服务看起来都是来自同一个地方
如果您对服务的设计非常谨慎
例如
如果只有一个下游服务设置了
那么您可能可以让他们从后台一直到调用者
另外
如果您的代理设置
和所有后台服务都是同一系统的一部分
那么简单地共享它们就可以自然
例如使用
将它们链接到一些共享状态
除此之外
由下游服务设置的任何
可能对呼叫者来说都不是很有用
因此建议您将
至少
和
设置为不属于您的域名
即使
是
属于您域名的路线
请尝试仔细考虑允许
在代理之间流动的含义
灵敏头可以配置为每个路由的逗号分隔列表
例如
注意
这是
的默认值
因此您不需要设置它
除非您希望它不同
注意这是
中的新功能
中
用户无法控制标题
所有
都在两个方向上流动
是一个黑名单
默认值不为空
所以要使
发送所有标题
被忽略
除外
您必须将其显式设置为空列表
如果您要将
或授权标头传递到后端
这是必要的
例
也可以通过设置
来全局设置敏感标题
如果在路由上设置
则将覆盖全局
设置
被忽略的标题
除了每个路由的敏感标头
您还可以为与下游服务交互期间应该丢弃的值
请求和响应
设置全局值为
默认情况下
如果
安全性不在类路径上
则它们是空的
否则它们被初始化为由
指定的一组众所周知的
安全性
头
例如涉及缓存
在这种情况下的假设是下游服务可能也添加这些头
我们希望代理的值
为了不丢弃这些众所周知的安全标头
只要
安全性在类路径上
您可以将
设置为
如果您禁用
安全性中的
安全性响应头
并希望由下游服务提供的值
这可能很有用
路线端点
如果您在
执行器中使用
您将启用
默认情况下
另一个端点
通过
可用
到此端点的
将返回映射路由的列表
将强制刷新现有路由
例如
如果服务目录中有更改
您可以通过将
设置为
来禁用此端点
注意
路由应自动响应服务目录中的更改
但
到
路由是强制更改立即发生的一种方式
扼杀模式和本地前进
迁移现有应用程序或
时的常见模式是
扼杀
旧端点
用不同的实现慢慢替换它们
代理是一个有用的工具
因为您可以使用它来处理来自旧端点的客户端的所有流量
但将一些请求重定向到新端点
示例配置
在这个例子中
我们扼杀了
遗留
应用程序
该应用程序映射到所有与其他模式不匹配的请求
中的路径已被提取到具有外部
的新服务中
并且
中的路径被转发
以便它们可以在本地处理
例如具有正常的
中的路径也被转发
但具有不同的前缀
即
转发到
注意
被忽略的模式并不完全被忽略
它们只是不被代理处理
因此它们也被有效地转发到本地
通过
上传文件
如果您
您可以使用代理路径上传文件
只要文件很小
它就应该工作
对于大文件
有一个替代路径绕过
中的
以避免多部分处理
也就是说
如果
则可以将大文件发送到
路径通过
进行外部化
如果代理路由引导您通过
负载均衡器
例如
超大文件也将需要提升超时设置
请注意
要使用大型文件进行流式传输
您需要在请求中使用分块编码
某些浏览器默认情况下不会执行
例如在命令行
查询字符串编码
处理传入的请求时
查询参数被解码
因此可以在
过滤器中进行修改
然后在路由过滤器中构建后端请求时重新编码它们
如果使用
的
方法编码
结果可能与原始输入不同
虽然这在大多数情况下不会出现任何问题
但一些
服务器可以用复杂查询字符串的编码来挑选
要强制查询字符串的原始编码
可以将特殊标志传递给
以便查询字符串与
方法相同
注意
此特殊标志仅适用于
您可以使用
轻松覆盖查询参数
因为查询字符串现在直接在原始的
上获取
普通嵌入
如果您使用
而不是
您也可以运行不带代理的
服务器
或者有选择地切换代理平台的部分
您添加到
类型的应用程序的任何
都将自动安装
与
一样
但不会自动添加任何代理过滤器
在这种情况下
仍然通过配置
来指定进入
服务器的路由
但没有服务发现和代理
所以
和
设置将被忽略
例如
将
中的所有路径映射到
过滤器链
禁用
过滤器
的
在代理和服务器模式下默认启用了多个
有关启用的可能过滤器
请参阅
过滤器包
如果要禁用它
只需设置
按照惯例
之后的包是
过滤器类型
例如
禁用
设置
为路线提供
回退
当
中给定路由的电路跳闸时
您可以通过创建类型为
的
来提供回退响应
在这个
中
您需要指定回退的路由
并提供返回的
作为后备
这是一个非常简单的
实现
这里是路由配置的样子
如果您希望为所有路由提供默认的回退
您可以创建一个类型为
的
并且
方法返回
或
开发人员指南
有关
如何工作的一般概述
请参阅
维基
被实现为
对于一般情况
嵌入到
调度机制中
这允许
控制路由
在这种情况下
被配置为缓冲请求
如果需要通过
不缓冲请求
例如大文件上传
也将安装在
调度程序之外
默认情况下
它位于
可以使用
属性更改此路径
要在过滤器之间传递信息
使用
其数据按照每个请求的
进行
关于路由请求
错误以及实际
和
的路由信息
扩展
所以任何东西都可以存储在上下文中
包含由
安装的过滤器使用的密钥
稍后再安装
与
根据使用何种注释来启用
安装多个过滤器
是
的超集
换句话说
包含
安装的所有过滤器
代理
中的其他过滤器启用路由功能
如果你想要一个
空白
你应该使用
过滤器
创建从
配置文件加载路由定义的
安装了以下过滤器
正常
豆类
前置过滤器
检测请求是否通过
调度程序
使用键
设置布尔值
解析表单数据
并对下游请求进行重新编码
如果设置
请求参数
则此过滤器将
和
设置为
路由过滤器
此过滤器使用
转发请求
转发位置存储在
属性
中
这对于转发到当前应用程序中的端点很有用
过滤器
将代理请求的响应写入当前响应
错误过滤器
如果
不为
则转发到
错误
默认情况下
可以通过设置
属性来更改默认转发路径
过滤器
创建从
如
以及属性加载路由定义的
每个
从
创建路由
随着新服务的添加
路由将被刷新
除了上述过滤器之外
还安装了以下过滤器
正常
豆类
前置过滤器
此过滤器根据提供的
确定在哪里和如何路由
它还为下游请求设置各种与代理相关的头
路由过滤器
此过滤器使用
和可插拔
客户端发送请求
服务
位于
属性
中
此过滤器可以使用不同的
客户端
他们是
这是默认的客户端
通过在类路径上设置
库并设置
来启用此功能
客户端
这可以通过设置
来启用
这个客户端有限制
比如它不支持
方法
还有内置的重试
此过滤器通过
发送请求到预定的
位于
自定义
过滤示例
以下大部分以下
如何撰写
示例都包含
示例
过滤器
项目
还有一些操作该存储库中的请求或响应正文的例子
如何编写预过滤器
前置过滤器用于设置
中的数据
用于下游的过滤器
主要用例是设置路由过滤器所需的信息
上面的过滤器从
请求参数填充
实际上
做这种直接映射并不是一个好主意
而是从
的值来查看服务
现在填写
将不会运行
将会
如果您想要路由到完整的网址
请改用
要修改路由过滤器将转发的路径
请设置
如何编写路由过滤器
路由过滤器在预过滤器之后运行
并用于向其他服务发出请求
这里的大部分工作是将请求和响应数据转换到客户端所需的模型
上述过滤器将
请求信息转换为
请求信息
执行
请求
然后将
响应信息转换为
响应
警告
此过滤器可能有错误
但功能不正确
如何编写过滤器
后置过滤器通常操纵响应
在下面的过滤器中
我们添加一个随机
作为
头
其他操作
如转换响应体
要复杂得多
计算密集
错误如何工作
如果在
过滤器生命周期的任何部分抛出异常
则会执行错误过滤器
只有
不是
才会运行
然后在请求中设置特定的
属性
并将请求转发到
错误页面
渴望应用程序上下文加载
内部使用
调用远程
并且
客户端默认在第一次调用时由
加载
可以使用以下配置更改
的此行为
并将导致在应用程序启动时
子
相关的应用程序上下文正在加载
支持
你有没有非
的语言你想利用
和配置服务器
启发了
它包含一个简单的
来获取给定服务的所有实例
即主机和端口
您还可以通过从
获取其路由条目的嵌入式
代理来代理服务调用
可以通过主机查找或通过
代理访问
服务器
非
应用程序应该执行健康检查
以便
可以向应用程序启动或关闭时向
报告
要在项目中包含
使用组
和
的依赖关系
要启用
请使用
创建
应用程序
此注释包括
和
在与非
应用程序相同的主机上运行生成的应用程序
要配置侧车将
和
添加到
属性是非
应用程序正在侦听的端口
这样
可以使用
正确注册该应用
是可以在非
应用程序上访问的
可以模拟
健康指标
它应该返回一个
文档
如下所示
健康
文档
以下是
应用程序的
示例
方法的
为
以下是
在不同主机上返回两个实例的示例响应
这个
可以访问
的非
应用程序
如果侧面在端口
上
主机
客户
代理自动将
中已知的每个服务的路由添加到
因此客户服务可在
获得
非
应用程序可以通过
访问客户服务
假设边界正在侦听端口
如果配置服务器已注册到
则非
应用程序可以通过
代理访问它
如果
的
为
且端口
为
则可以在
非
应用程序可以利用
返回
文档的功能
例如
调用
可能会导致一个
文档
如下所示
与
包括
是
的
实现
用于通过使用
序列来构建异步和基于事件的程序的库
支持从
控制器返回
对象
它还支持对
服务器发送事件
使用
对象
如果您的内部
已经使用
构建
参见
支持
示例
这可能非常方便
以下是使用
的一些示例
如果您有
而不是单个
则可以使用
或
这里有些例子
如果您有流式端点和客户端
可以是一个选项
要将
转换为
使用
这里有些例子
指标
和
当一起使用时
和
提供了近乎实时的操作洞察平台
的度量收集库
和
是用于管理维度时间序列数据的
指标后端
为
服务了好几年
仍然可以使用
但逐渐被淘汰出局
这只适用于
提供了支持
但
鼓励基于应用的应用程序使用
维度与层次度量
执行器指标是层次结构
指标只能由名称分隔
这些名称通常遵循将密钥
值属性对
维
嵌入到以句点分隔的名称中的命名约定
考虑以下两个端点
和
的指标
第一个指标给出了每单位时间内针对根端点的成功请求的归一化计数
但是如果系统有
个端点
并且想要获得针对所有端点的成功请求计数呢
一些分级度量后端将允许您指定一个通配符
例如
它将读取所有
个指标并聚合结果
或者
您可以提供
拦截并记录所有成功请求的
等指标
而不考虑端点
但现在您必须编写
个不同的指标
同样
如果您想知道服务中所有端点的成功请求总数
您可以指定一个通配符
例如
即使在分级度量后端的通配符支持的情况下
命名一致性也是困难的
具体来说
这些标签在名称字符串中的位置可能会随着时间而滑落
从而导致查询错例如
假设我们为上述
方法添加了一个额外的维度
那么
成为
等等
我们的
突然不再具有相同的语义
此外
如果新的维度在整个代码库中不均匀地应用
某些查询可能会变得不可能
这可以很快失控
指标被标记
又称维度
每个指标都有一个名称
但是这个单一的命名度量可以包含多个统计信息和
标签
键
值对
这允许更多的查询灵活性
实际上统计本身就是记录在一个特殊的标签上
使用
或
记录
上述根端点的计时器包含每个状态码的
个统计信息
其中计数统计信息与
执行器计数器相同
如果到目前为止
我们遇到了
和
将有
个可用数据点
默认度量集合
没有任何附加依赖或配置
基于
的服务将自动配置
并开始收集每个
请求的指标
默认情况下
将为每个
请求记录名称为
的
定时器
其标记为
方法
状态
例如
如果
为空
则为
为
异常类名称
如果请求处理程序抛出异常
如果在请求上设置了匹配
的密钥的请求头
则呼叫者
没有默认键
如果您希望收集来电者信息
则必须将其添加到应用程序属性中
设置
属性将度量值的名称从
更改为您提供的名称
如果
已启用
并且
存在于您的运行时类路径上
则
还将收集每个使用
进行的客户端调用的指标
将为每个具有以下标签的
请求记录名称为
的
定时器
方法
状态
例如
如果响应返回为空
则为
如果在执行
方法期间发生
则为
为
客户名称
警告
避免在
内使用硬编码的
参数
定位动态端点时使用
变量
这将避免
将每个网址视为唯一密钥的潜在
覆盖限制达到
问题
指标集
要启用
指标
请在
上包含依赖关系
在
说明中
仪表是一个命名
打字和标记的配置
而指标表示给定仪表在某个时间点的值
米由注册表创建和控制
注册表目前有几个不同的实现
提供
米类型
计数器
定时器
量规和分配摘要
集成为您配置可注入的
实例
具体来说
它配置一个
实例
以统一
度量标准的集合
并将度量标准导出到
下的
后端
实际上
这意味着您的代码可能会使用
显示器和
米的混合
并且都将由
实例舀取
并将两者都发送到
后端
柜台
计数器用于测量某些事件发生的速率
计数器记录单个时间归一化统计量
计时器
一个计时器用于测量一些事件需要多长时间
自动记录
请求和有条件
请求的定时器
稍后可用于为请求相关指标创建仪表板
如延迟
图
请求延迟
计时器同时记录
个统计信息
和
如果您在每次记录时间时在计数器上调用了
一次
计数统计量将始终与计数器提供的单个归一化值相匹配
因此对于单个操作
不需要单独计数和分时
对于
长时间运行的操作
提供了一个特殊的
量规
量规用于确定一些当前值
如队列的大小或处于运行状态的线程数
由于仪表被采样
它们不提供关于这些值在样品之间如何波动的信息
仪器的正常使用包括在初始化中使用标识符注册仪表
对要采样的对象的引用
以及基于对象获取或计算数值的功能
对对象的引用被单独传递
注册表将保留对该对象的弱引用
如果对象被垃圾回收
则
将自动删除注册
见
注
是关于潜在的内存泄漏的文件中
如果这个
被滥用
分发摘要
分发摘要用于跟踪事件的分布情况
它类似于一个计时器
但更普遍的是
大小不一定是一段时间
例如
分发摘要可用于测量服务器的请求的有效载荷大小
指标集
警告
如果您的代码在
上编译
请使用
而不是
因为
注定要从长期来替换
在
语言中
监视器是一个命名
键入和标记的配置
而指标表示给定监视器在某个时间点的值
显示器在逻辑上相当于
米
显示器由
创建和控制
尽管有上述警告
确实具有比
有米的
更广泛
的监视器选项
集成为您配置可注入的
实例
在
中创建了相应的
类型后
记录数据的过程完全类似于
创建
显示器
如果您正在使用由
提供的
实例
具体来说是
的实例
则
提供了用于检索
计数器
和
计时器的
便利类
这些便利类确保每个唯一的名称和标签组合只注册一个
要在
中手动创建监视器类型
特别是对于不提供方便方法的异域监视器类型
通过提供
实例来实例化适当的类型
指标后端
开发了
来管理维度时间序列数据
实现近实时操作洞察
具有内存中数据存储功能
可以非常快速地收集和报告大量的指标
捕获操作情报
而商业智能是收集的数据
用于分析一段时间内的趋势
操作情报提供了系统中目前发生的情况
提供了一个
它具有您需要的所有依赖关系
然后只需使用
注释您的
应用程序
并为您运行的
服务器提供
属性的位置
全球标签
您可以通过
向发送到
后端的每个度量标准添加标签
全局标签可用于按应用程序名称
环境
区域等分隔度量
实现
的每个
将贡献全局标签列表
使用
要引导内存独立的
实例
小费
运行在
上的
独立节点可以在给定的
小时窗口内每分钟处理大约
万个度量值
一旦运行
您收集了少量指标
请通过在
服务器上列出代码来验证您的设置是否正确
小费
在针对您的服务执行多个请求后
您可以通过在浏览器中粘贴以下
来收集关于每个请求的请求延迟的一些非常基本的信息
包含各种场景
样本查询
的汇编
确保使用
双指数平滑
来查看
警报原理
和文档
以生成动态警报阈值
重试失败的请求
提供了多种方式来进行
请求
您可以使用负载平衡
或
无论您如何选择
请求
始终有可能失败的请求
当请求失败时
您可能希望自动重试该请求
要在使用
时完成此操作
您需要在应用程序的类路径中包含
重试
当
重试出现负载平衡
时
和
将自动重试任何失败的请求
假设配置允许
组态
随时
与
重试一起使用
您可以通过配置某些
属性来控制重试功能
您可以使用的属性是
和
请参阅
文档
了解属性的具体内容
此外
您可能希望在响应中返回某些状态代码时重试请求
您可以列出您希望
客户端使用属性
重试的响应代码
例如
您还可以创建一个类型为
的
并实现
方法来确定是否要重试发出状态代码的请求
您可以通过将
设置为
来关闭
的重试功能
您还可以通过将
设置为
以路由方式禁用重试功能
本节将详细介绍如何使用
它涵盖了创建和运行流应用程序等主题
介绍
是构建消息驱动的微服务应用程序的框架
基于
建立独立的生产级
应用程序
并使用
提供与消息代理的连接
它提供了来自几家供应商的中间件的意见配置
介绍了持久发布订阅语义
消费者组和分区的概念
您可以将
注释添加到应用程序
以便立即连接到消息代理
并且可以将
添加到方法中
以使其接收流处理的事件
以下是接收外部消息的简单接收器应用程序
注释需要一个或多个接口作为参数
在这种情况下
该参数是单个
接口
接口声明输入和
或输出通道
提供了接口
和
您还可以定义自己的界面
以下是
接口的定义
注释标识
输入通道
通过该
输入通道
接收到的消息进入应用程序
注释标识
输出通道
发布的消息将通过该
通道
离开应用程序
和
注释可以使用频道名称作为参数
如果未提供名称
将使用注释方法的名称
将为您创建一个界面的实现
您可以在应用程序中通过自动连接来使用它
如下面的测试用例示例
主要概念
提供了一些简化了消息驱动的微服务应用程序编写的抽象和原语
本节概述了以下内容
的应用模型
抽象
持续的发布
订阅支持
消费者群体支持
分区支持
一个可插拔的
应用模型
一个
应用程序由一个中间件中立的核心组成
该应用程序通过
注入到其中的输入和输出
通道
与外界进行通信
渠道通过中间件特定的
实现连接到外部经纪人
图
应用
胖
应用程序可以在独立模式下从
运行进行测试
要在生产中运行
应用程序
您可以使用为
或
提供的标准
工具创建可执行文件
或
胖
抽象
为
和
提供
实现
还包括一个
它保留了一个
未修改
的通道
以便测试可以直接和可靠地与通道进行交互
您可以使用可扩展
编写自己的
使用
进行配置
抽象使得
应用程序可以灵活地连接到中间件
例如
部署者可以在运行时动态地选择通道连接的目的地
例如
主题或
交换
可以通过外部配置属性和
包括应用程序参数
环境变量和
或
文件
支持的任何形式提供此类配置
在
引入
部分的接收器示例中
将应用程序属性
设置为
将使其从
主题或从绑定到
交换
自动检测并使用类路径中找到的
您可以使用相同的代码轻松使用不同类型的中间件
在构建时只包含不同的绑定器
对于更复杂的用例
您还可以在应用程序中打包多个绑定器
并在运行时选择绑定器
甚至是否为不同的通道使用不同的绑定器
持续发布
订阅支持
应用之间的通信遵循发布订阅模式
其中通过共享主题广播数据
这可以在下图中看到
它显示了一组交互式的
应用程序的典型部署
图
传感器向
端点报告的数据将发送到名为
的公共目标
从目的地
它由微服务应用程序独立处理
该应用程序计算时间窗口平均值
以及另一个将原始数据导入
的微服务应用程序
为了处理数据
两个应用程序在运行时将主题声明为它们的输入
发布订阅通信模型降低了生产者和消费者的复杂性
并允许将新应用程序添加到拓扑中
而不会中断现有流
例如
在平均计算应用程序的下游
您可以添加一个计算显示和监视的最高温度值的应用程序
然后
您可以添加另一个解释相同的故障检测平均流程的应用程序
通过共享主题而不是点对点队列进行所有通信可以减少微服务之间的耦合
虽然发布订阅消息的概念不是新的
但是
需要额外的步骤才能使其成为其应用模型的一个有意义的选择
通过使用本地中间件支持
还简化了在不同平台上使用发布订阅模型
消费群体
虽然发布订阅模型可以轻松地通过共享主题连接应用程序
但通过创建给定应用程序的多个实例来扩展的能力同样重要
当这样做时
应用程序的不同实例被放置在竞争的消费者关系中
其中只有一个实例预期处理给定消息
通过
消费者组
的概念来模拟此行为
消费者组与
消费者组相似并受到启发
每个消费者绑定可以使用
属性来指定组名称
对于下图所示的消费者
此属性将设置为
或
图
消费者组
订阅给定目标的所有组都会收到已发布数据的副本
但每个组中只有一个成员从该目的地接收给定的消息
默认情况下
当未指定组时
将应用程序分配给与所有其他消费者组发布
订阅关系的匿名独立单个成员消费者组
耐久力
符合
的有意义的应用模式
消费者群体订阅是
持久的
也就是说
绑定实现确保组预订是持久的
一旦已经创建了一个组的至少一个订阅
即使组中的所有应用程序都被停止
组也将接收消息
注意
匿名订阅本质上是不耐用的
对于某些
实现
例如
可以具有非持久组的订阅
通常
当将应用绑定到给定目的地时
最好始终指定消费者组
在扩展
应用程序时
必须为每个输入绑定指定一个使用者组
这样可以防止应用程序的实例收到重复的消息
除非需要这种行为
这是不寻常的
分区支持
提供对给定应用程序的多个实例之间的
分区
数据的支持
在分区场景中
物理通信介质
例如
代理主题
被视为被构造成多个分区
一个或多个生产者应用程序实例将数据发送到多个消费者应用程序实例
并确保由共同特征标识的数据由相同的消费者实例处理
提供了统一方式实现分区处理用例的通用抽象
因此
无论代理本身是否自然分区
例如
例如
分区可以被使用
图
分区
分区是状态处理中的一个关键概念
无论是性能还是一致性原因
它都是批评性的
以确保所有相关数据一起处理
例如
在时间平均计算示例中
重要的是所有给定传感器的所有测量都由相同的应用实例进行处理
注意
要设置分区处理方案
您必须同时配置数据生成和数据消耗结束
编程模型
本节介绍
的编程模型
提供了许多预定义的注释
用于声明绑定的输入和输出通道
以及如何收听频道
声明和绑定频道
触发绑定
您可以将
应用程序转换为
应用程序
将
注释应用于应用程序的配置类之一
注释本身使用
进行元注释
并触发
基础架构的配置
注释可以将一个或多个接口类作为参数
这些接口类包含表示可绑定组件
通常是消息通道
的方法
注意
在
中
唯一支持的可绑定组件是
消息传递
及其扩展名
和
未来版本应该使用相同的机制将此支持扩展到其他类型的组件
在本文档中
我们将继续参考渠道
和
应用程序可以在接口中定义任意数量的输入和输出通道为
和
方法
使用此接口作为参数
将分别触发三个绑定的通道名称为
和
自定义频道名称
使用
和
注释
您可以指定频道的自定义频道名称
如以下示例所示
在这个例子中
创建的绑定通道将被命名为
和
为了方便寻址最常见的用例
涉及输入通道
输出通道或两者
提供了开箱即用的三个预定义接口
可用于具有单个出站通道的应用程序
可用于具有单个入站通道的应用程序
可用于具有入站通道和出站通道的应用程序
不为任何这些接口提供特殊处理
它们只是开箱即用
访问绑定通道
注入绑定界面
对于每个绑定接口
将生成一个实现该接口的
调用其中一个
的
注释或
注释方法将返回相关的绑定通道
以下示例中的
在调用其
方法时在输出通道上发送消息
它在注入的
上调用
来检索目标通道
直接注入渠道
绑定通道也可以直接注入
如果在声明注释上定制了通道的名称
则应使用该名称而不是方法名称
给出以下声明
通道将被注入
如下例所示
生产和消费消息
您可以使用
注解或
的
注释编写
应用程序
注释在其他
消息传递注释
例如
等
之后建模
但添加内容类型管理和类型强制功能
本地
支持
由于
基于
完全继承了
的基础和基础架构以及组件本身
例如
您可以将
的输出通道附加到
或者您可以在变压器中使用处理器的通道
错误通道支持
支持发布
全局错误通道收到的错误消息
发送到
的错误消息可以通过为名为
的出站目标配置绑定
将其发布到代理的特定目标
例如
要将错误消息发布到名为
的代理目标
请提供以下属性
使用
进行自动内容类型处理
支持
提供自己的
注释
以其他
消息传递注释
例如
等
注释提供了一种更简单的处理入站邮件的模型
特别是在处理涉及内容类型管理和类型强制的用例时
提供了一种可扩展的
机制
用于通过绑定通道处理数据转换
并且在这种情况下
将调度到使用
注释的方法
以下是处理外部
事件的应用程序的示例
当考虑
有效载荷和
标题
的入站
时
可以看到
和
之间的区别
在
的情况下
机制将使用
标头将
有效载荷解析为
对象
与其他
消息传递方法一样
方法参数可以用
和
注释
注意
对于返回数据的方法
您必须使用
注释来指定方法返回的数据的输出绑定目的地
使用
将消息分派到多个方法
自
版本以来
支持根据条件向在输入通道上注册的多个
方法发送消息
为了有资格支持有条件的调度
一种方法必须满足以下条件
它不能返回值
它必须是一个单独的消息处理方法
不支持的反应
方法
条件通过注释的
属性中的
表达式指定
并为每个消息进行评估
匹配条件的所有处理程序将在同一个线程中被调用
并且不必对调用发生的顺序做出假设
使用
具有调度条件的示例可以在下面看到
在此示例中
带有值为
的标题
的所有消息将被分派到
方法
所有带有值为
的标题
的消息将被分派到
方法
注意
仅通过
条件进行调度仅对单个消息的处理程序支持
而不适用于无效编程支持
如下所述
反应式编程支持
还支持使用反应性
其中将传入和传出数据作为连续数据流处理
通过
提供对反应性
的支持
需要将其明确添加到您的项目中
具有反应性
的编程模型是声明式的
而不是指定如何处理每个单独的消息
您可以使用描述从入站到出站数据流的功能转换的运算符
支持以下反应性
反应堆
将来
它旨在支持基于活动流的更通用的模型
反应式编程模型还使用
注释来设置反应处理程序
差异在于
注释不能指定输入或输出
因为它们作为参数提供
并从方法返回值
必须使用
和
注释方法的参数
指示输入和分别输出的数据流连接到哪个输入或输出
方法的返回值
如果有的话
将用
注释
表示要发送数据的输入
注意
反应式编程支持需要
注意
截至
及更高版本
从布鲁克林发行版开始列出
反应式编程支持需要使用
和更高版本
不支持早期的
版本
包括
和
将会过渡地检索正确的版本
但项目结构有可能将
的版本管理到较早版本
特别是在使用
时
对于通过
生成的项目
这将覆盖
版本为
在这种情况下
您必须确保释放正确版本的工件
这可以通过在
上直接依赖于
或更高版本的项目来简单地实现
注意
术语
的使用目前指的是正在使用的反应性
而不是执行模型是无效的
即
绑定的端点仍然使用
推
而不是
拉
模型
虽然通过使用
提供了一些背压支持
但我们希望长期以来通过使用连接的中间件的本机反应客户端来支持完全无反应的管道
基于反应器的处理程序
基于反应器的处理程序可以具有以下参数类型
对于用
注释的参数
它支持反应器类型
入站通量的参数化遵循与单个消息处理相同的规则
它可以是整个
一个可以是
有效负载的
也可以是一个
基于
内容类型头的转换
提供多个输入
对于使用
注释的参数
它支持将方法生成的
与输出连接的类型
一般来说
仅当方法可以有多个输出时才建议指定输出作为参数
基于反应器的处理程序支持
的返回类型
其中必须使用
注释
当单个输出通量可用时
我们建议使用该方法的返回值
这是一个简单的基于反应器的处理器的例子
使用输出参数的同一个处理器如下所示
支持
处理程序遵循与基于反应器的规则相同的规则
但将使用
和
参数和返回类型
所以上面的第一个例子会变成
上面的第二个例子将会变成
聚合
支持将多个应用程序聚合在一起
直接连接其输入和输出通道
并避免通过代理交换消息的额外成本
从版本
的
开始
仅对以下类型的应用程序支持聚合
来源
具有名为
的单个输出通道的应用程序
通常具有类型为
的单个绑定
接收器
具有名为
的单个输入通道的应用程序
通常具有类型为
的单个绑定
处理器
具有名为
的单个输入通道和名为
的单个输出通道的应用程序
通常具有类型为
的单个绑定
它们可以通过创建一系列互连的应用程序来聚合在一起
其中序列中的元素的输出通道连接到下一个元素的输入通道
如果存在
序列可以从
源
或
处理器开始
它可以包含任意数量的
处理器
并且必须以
处理器
或
接收器
结束
根据起始和结束元素的性质
序列可以具有一个或多个可绑定的信道
如下所示
如果序列从源头开始并以
结束
则应用程序之间的所有通信都是直接的
并且不会绑定任何通道
如果序列以处理器开始
则其输入通道将成为聚合的
通道
并将相应地进行绑定
如果序列以处理器结束
则其输出通道将成为聚合的
通道
并将相应地进行绑定
使用
实用程序类执行聚合
如以下示例所示
我们考虑一个项目
我们有源
处理器和汇点
可以在项目中定义
或者可以包含在项目的依赖之一中
注意
如果配置类使用
聚合应用程序中的每个组件
源
宿或处理器
必须在单独的包中提供
这是为了避免应用程序之间的串扰
由于在同一个包内的配置类上由
执行的类路径扫描
在下面的示例中
可以看到
和
应用程序类分组在单独的包中
一个可能的替代方法是在单独的
类中提供源
宿或处理器配置
避免使用
并使用它们进行聚合
每个配置可以用于运行一个单独的组件
但在这种情况下
它们可以聚合在一起
如下所示
该序列的起始组件作为
方法的参数提供
序列的结尾部分作为
方法的参数提供
中间处理器作为
方法的参数提供
同一类型的多个处理器可以一起链接
例如
用于具有不同配置的流水线转换
对于每个组件
构建器可以为
配置提供运行时参数
配置聚合应用程序
支持使用
作为前缀向聚合应用程序内的各个应用程序传递属性
命名空间可以为应用程序设置如下
一旦为单个应用程序设置了
命名空间
则可以使用任何支持的属性源
命令行
环境属性等
将具有
作为前缀的应用程序属性传递到聚合应用程序
例如
要覆盖
和
应用程序的默认
和
属性
为非自包含聚合应用程序配置绑定服务属性
非自包含聚合应用程序通过聚合应用程序的入站
出站组件
通常为消息通道
中的一个或两者绑定到外部代理
而聚合应用程序内的应用程序是直接绑定的
例如
源应用程序的输出和处理器应用程序的输入是直接绑定的
而处理器的输出通道绑定到代理的外部目的地
当传递非自包含聚合应用程序的绑定服务属性时
需要将绑定服务属性传递给聚合应用程序
而不是将它们设置为单个子应用程序的
例如
需要将绑定属性
指定为外部配置属性
等
之一
提供了一个
抽象
用于连接到外部中间件的物理目标
本节提供有关
其主要组件和实现特定详细信息背后的主要概念的信息
生产者和消费者
图
生产者和消费者
甲
生产者
是将消息发送到信道的任何组分
该通道可以通过该代理的
实现绑定到外部消息代理
当调用
方法时
第一个参数是代理中目标的名称
第二个参数是生成器将发送消息的本地通道实例
第三个参数包含属性
如分区键表达式
在为该通道创建的适配器中使用
甲
消费者
的是
从一个信道接收的消息的任何组分
与生产者一样
消费者的频道可以绑定到外部消息代理
当调用
方法时
第一个参数是目标名称
第二个参数提供消费者逻辑组的名称
由给定目的地的消费者绑定表示的每个组接收生产者发送到该目的地的每个消息的副本
即
发布
订阅语义
如果有多个使用相同组名称的消费者实例绑定
那么消息将在这些消费者实例之间进行负载平衡
以便生产者发送的每个消息仅由每个组中的单个消费者实例消耗
即排队语义
包括许多接口
即插即用实用程序类和发现策略
提供可插拔机制连接到外部中间件
的关键点是
接口
它是将输入和输出连接到外部中间件的策略
界面参数化
提供多个扩展点
输入和输出绑定目标
从版本
开始
只支持
但是这个目标是将来用作扩展点
扩展的消费者和生产者属性
允许特定的
实现来添加可以以类型安全的方式支持的补充属性
典型的绑定实现包括以下内容
一个实现
接口的类
一个
类
与中间件连接基础架构一起创建上述类型的
在类路径中找到的包含一个或多个绑定器定义的
文件
例如
检测
依赖于
的实现来执行将通道连接到消息代理的任务
每个
实现通常连接到一种类型的消息系统
类路径检测
默认情况下
依赖于
的自动配置来配置绑定过程
如果在类路径中找到单个
实现
则
将自动使用
例如
一个旨在绑定到
的
项目可以简单地添加以下依赖项
对于其他绑定依赖关系的特定
坐标
请参阅该
实现的文档
上有多个
当类路径中存在多个绑定器时
应用程序必须指明每个通道绑定将使用哪个绑定器
每个
配置都包含一个
它是一个简单的属性文件
对于其他提供的绑定实现
例如
存在类似的文件
并且预期自定义绑定实现也可以提供它们
键代表
实现的标识名称
而该值是以逗号分隔的配置类列表
每个配置类都包含唯一的一个类型为
的
定义
可以使用
属性
例如
全局执行
选择
或通过在每个通道绑定上配置
来单独执行
例如
从
读取并写入
的处理器应用程序
分别具有用于读
写的名称为
和
的通道
可以指定以下配置
连接到多个系统
默认情况下
绑定器共享应用程序的
自动配置
以便在类路径中找到每个绑定器的一个实例
如果您的应用程序连接到同一类型的多个代理
则可以指定多个绑定器配置
每个具有不同的环境设置
注意
打开显式绑定器配置将完全禁用默认绑定器配置过程
如果这样做
所有使用的绑定器都必须包含在配置中
打算透明使用
的框架可能会创建可以通过名称引用的
配置
但不会影响默认的绑定器配置
为此
绑定器配置可能将其
标志设置为
例如
这表示将独立于默认
配置过程存在的配置
例如
这是连接到两个
代理实例的处理器应用程序的典型配置
配置属性
创建自定义绑定器配置时
以下属性可用
它们必须以
为前缀
类型
粘合剂类型
它通常引用在类路径中找到的绑定器之一
特别是
文件中的键
默认情况下
它具有与配置名称相同的值
配置是否会继承应用程序本身的环境
默认
环境
一组可用于自定义绑定环境的属性的根
配置此配置后
创建绑定器的上下文不是应用程序上下文的子级
这允许粘合剂组分和应用组分之间的完全分离
默认
粘合剂配置是否被认为是默认的粘合剂的候选者
或者仅在明确引用时才能使用
这允许添加
配置
而不会干扰默认处理
默认
配置选项
支持常规配置选项以及绑定和绑定器的配置
一些绑定器允许额外的绑定属性来支持中间件特定的功能
可以通过
支持的任何机制将配置选项提供给
应用程序
这包括应用程序参数
环境变量和
或
文件
应用程序部署实例的数量
必须设置分区
如果使用
默认值
应用程序的实例索引
从
到
的数字
用于分区和使用
在
中自动设置以匹配应用程序的实例索引
可以动态绑定的目标列表
例如
在动态路由方案中
如果设置
只能列出目的地
默认值
空
允许任何目的地绑定
如果配置了多个绑定器
则使用默认的
请参阅
上的
默认值
空
此属性仅适用于
配置文件激活且
连接器随应用程序一起提供
如果属性为
默认值
绑定器将检测适合的绑定服务
例如
在
中为
绑定器绑定的
服务
并将使用它来创建连接
通常通过
连接器
当设置为
时
此属性指示绑定器完全忽略绑定的服务
并依赖
属性
例如
依赖于
绑定器环境中提供的
属性
当连接到多个系统时
此属性的典型用法将嵌套在定制环境
中
默认值
绑定
绑定属性使用格式
提供
表示正在配置的通道的名称
例如
的
为了避免重复
支持所有通道的设置值
格式为
在下面的内容中
我们指出我们在哪里省略了
前缀
并且只关注属性名称
但有一个理解
前缀将被包含在运行时
使用
以下绑定属性可用于输入和输出绑定
并且必须以
为前缀
例如
可以使用前缀
设置默认值
例如
目的地
绑定中间件上的通道的目标目标
例如
交换或
主题
如果通道绑定为消费者
则可以将其绑定到多个目标
并且目标名称可以指定为逗号分隔的字符串值
如果未设置
则使用通道名称
此属性的默认值不能被覆盖
组
渠道的消费群体
仅适用于入站绑定
参见
消费者群体
默认值
表示匿名消费者
内容类型
频道的内容类型
默认值
以便不执行类型强制
粘合剂
这种绑定使用的粘合剂
有关详细信息
请参阅
上的
默认值
默认的
将被使用
如果存在
消费者物业
以下绑定属性仅适用于输入绑定
并且必须以
为前缀
例如
默认值可以使用前缀
设置
例如
并发
入站消费者的并发性
默认值
分区
消费者是否从分区生产者接收数据
默认值
设置为
时
禁用输入头文件解析
仅适用于不支持消息头的消息中间件
并且需要头部嵌入
入站数据来自外部
应用程序时很有用
默认值
如果处理失败
则尝试处理消息的次数
包括第一个
设置为
以禁用重试
默认值
退避初始间隔重试
默认值
最大回退间隔
默认值
退避倍数
默认值
当设置为大于等于零的值时
允许自定义此消费者的实例索引
如果与
不同
设置为负值时
它将默认为
默认值
当设置为大于等于零的值时
允许自定义此消费者的实例计数
如果与
不同
当设置为负值时
它将默认为
默认值
制作人
以下绑定属性仅可用于输出绑定
并且必须以
为前缀
例如
默认值可以使用前缀
设置
例如
一个确定如何分配出站数据的
表达式
如果设置
或者如果设置了
则该通道上的出站数据将被分区
并且
必须设置为大于
的值才能生效
这两个选项是相互排斥的
请参阅
分区支持
默认值
一个
实现
如果设置
或者如果设置了
则该通道上的出站数据将被分区
并且
必须设置为大于
的值才能生效
这两个选项是相互排斥的
请参阅
分区支持
默认值
一个
实现
与
相互排斥
如果没有设置
则分区将被选为
其中
通过
或
计算
默认值
用于自定义分区选择的
表达式
与
相互排斥
如果没有设置
则分区将被选为
其中
通过
或
计算
默认值
如果启用分区
则数据的目标分区数
如果生产者被分区
则必须设置为大于
的值
在
解释为提示
而是使用更大的和目标主题的分区计数
默认值
生成者必须确保消息传递的组合的逗号分隔列表
即使它们在创建之后启动
例如
通过在
中预先创建持久队列
设置为
时
禁用输出上的标题嵌入
仅适用于不支持消息头的消息中间件
并且需要头部嵌入
生成非
应用程序的数据时很有用
默认值
当设置为
时
出站消息由客户端库直接序列化
必须相应配置
例如设置适当的
生产者值序列化程序
当使用此配置时
出站消息编组不是基于绑定的
当使用本地编码时
消费者有责任使用适当的解码器
例如
消费者价值解串器
来对入站消息进行反序列化
此外
当使用本机编码
解码时
属性将被忽略
标题不会嵌入到消息中
默认值
使用动态绑定目的地
除了通过
定义的通道之外
允许应用程序将消息发送到动态绑定的目的地
这是有用的
例如
当目标目标需要在运行时确定
应用程序可以使用
注册自动注册的
属性
可用于将动态目标名称限制为预先已知的集合
白名单
如果属性未设置
任何目的地都可以动态绑定
可以直接使用
如以下示例所示
其中
控制器使用路径变量来确定目标通道
在默认端口
上启动应用程序后
发送以下数据时
目的地的客户和
订单
是在经纪人中创建的
例如
在
的情况下进行交换
或者在
的情况下为主题
其名称为
客户
和
订单
数据被发布到适当的目的地
是通用的
可以注入其他组件
例如
在使用基于传入
消息的
字段的
表达式的路由器中
内容类型和转换
要允许您传播关于已生成消息的内容类型的信息
默认情况下
附加
标头到出站消息
对于不直接支持头文件的中间件
提供了自己的自动将邮件包裹在自己的信封中的机制
对于支持头文件的中间件
应用程序可以从非
应用程序接收具有给定内容类型的消息
可以通过两种方式处理基于此信息的消息
通过其入站和出站渠道的
设置
通过对
注释的方法执行的参数映射
允许您使用绑定的
属性声明性地配置输入和输出的类型转换
请注意
一般类型转换也可以通过在应用程序中使用变压器轻松实现
目前
本机支持流中常用的以下类型转换
来自
从
的
从
对象
到
来自
用于远程传输的原始字节序列化
应用程序发出的字节
或使用
序列化转换为字节
要求对象为
字符串
到
来自
对象
到
纯文本
调用对象的
方法
其中
表示包含
的字节数组或字符串有效负载
目前
对象可以从
字节数组或字符串转换
转换为
总是产生一个
如果在出站通道上没有设置
属性
则
将使用基于
序列化框架的序列化程序对有效负载进行序列化
在目的地反序列化消息需要在接收者的类路径上存在有效载荷类
类型
值被解析为媒体类型
例如
或
类型对于指示如何转换为
或
内容特别有用
还使用
类型格式来表示
类型
使用具有
参数的一般类型
例如
或
可以设置为输入绑定的
属性
此外
提供自定义
类型
特别是
来指定元组
类型和
类型
类型转换
提供的开箱即用如下表所示
源有效载荷
是指转换前的有效载荷
目标有效载荷
是指转换后的
有效载荷
类型转换可以在
生产者
一侧
输出
或
消费者
一侧
输入
上进行
来源有效载荷目标有效载荷
标题
来源讯息
标题
转换后
注释
是为
量身定制的
将应用在
头中指定的任何
将应用在
头中指定的任何
注意
转换适用于需要类型转换的有效内容
例如
如果应用程序生成带有
的
字符串
则该有效载荷将不会从
转换为
这是因为发送到出站通道的有效载荷已经是一个
所以在运行时不会应用转换
同样重要的是要注意
当使用默认的序列化机制时
必须在发送和接收应用程序之间共享有效负载类
并且与二进制内容兼容
当应用程序代码在两个应用程序中独立更改时
这可能会产生问题
因为二进制格式和代码可能会变得不兼容
小费
虽然入站和出站渠道都支持转换
但特别推荐将其用于转发出站邮件
对于入站邮件的转换
特别是当目标是
时
支持将自动执行转换
自定义邮件转换
除了支持开箱即用的转换
还支持注册您自己的邮件转换实现
这允许您以各种自定义格式
包括二进制
发送和接收数据
并将其与特定的
关联
将所有类型为
的
注册为自定义消息转换器以及开箱即用消息转换器
如果您的消息转换器需要使用特定的
和目标类
用于输入和输出
则消息转换器需要扩展
对于使用
的转换
实现
的消息转换器就足够了
以下是在
应用程序中创建消息转换器
内容类型为
的示例
还为基于
的转换器和模式演进提供支持
详情请参阅
具体章节
和讯息转换
注释提供了一种方便的方式来转换传入的消息
而不需要指定输入通道的内容类型
在使用
注释的方法的调度过程中
如果参数需要转换
将自动应用转换
例如
让我们考虑一个带有
的
内容的消息
并且在输入通道上收到
的
标题
让我们考虑接收它的以下应用程序
该方法的参数将自动填充包含
字符串的未编组形式的
进化支持
通过其
模块为基于模式的消息转换器提供支持
目前
基于模式的消息转换器开箱即用的唯一序列化格式是
在将来的版本中可以添加更多的格式
讯息转换器
模块包含可用于
序列化的两种类型的消息转换器
使用序列化
反序列化对象的类信息的转换器
或者启动时已知位置的模式
转换器使用模式注册表
他们在运行时定位模式
以及随着域对象的发展动态注册新模式
具有模式支持的转换器
支持使用预定义模式或使用类中可用的模式信息
反射或包含在
中的序列化和反序列化消息
如果转换的目标类型是
则必须设置模式
对于使用它
您可以简单地将其添加到应用程序上下文中
可选地指定一个或多个
将其关联
默认
为
以下是在注册
的宿应用程序中进行配置的示例
而不需要预定义的模式
相反
这里是一个应用程序
注册一个具有预定义模式的转换器
可以在类路径中找到
为了了解模式注册表客户端转换器
我们将首先描述模式注册表支持
注册表支持
大多数序列化模型
特别是旨在跨不同平台和语言进行可移植性的序列化模型
依赖于描述数据如何在二进制有效载荷中被序列化的模式
为了序列化数据然后解释它
发送方和接收方都必须访问描述二进制格式的模式
在某些情况下
可以从序列化的有效载荷类型或从反序列化时的目标类型中推断出模式
但是在许多情况下
应用程序可以从访问描述二进制数据格式的显式模式中受益
模式注册表允许您以文本格式
通常为
存储模式信息
并使该信息可访问需要它的各种应用程序以二进制格式接收和发送数据
一个模式可以作为一个元组引用
它由
作为模式的逻辑名称的
主题
模式
版本
描述
数据
的二进制格式的模式
格式
注册服务器
提供了模式注册表服务器实现
为了使用它
您可以简单地将
工件添加到项目中
并使用
注释
将模式注册表服务器
控制器添加到应用程序中
此注释旨在与
应用程序一起使用
服务器的监听端口由
设置控制
设置可用于控制模式服务器的根路径
特别是嵌入其他应用程序时
布尔设置可以删除模式
默认情况下
这是禁用的
模式注册表服务器使用关系数据库来存储模式
默认情况下
它使用一个嵌入式数据库
您可以使用
数据库和
配置选项
自定义模式存储
启用模式注册表的
应用程序如下所示
注册服务器
注册服务器
由以下操作组成
注册一个新的架构
接受具有以下字段的
有效载荷
模式主题
模式格式
模式定义
响应是
格式的模式对象
包含以下字段
模式标识
模式主题
模式格式
模式版本
模式定义
根据其主题
格式和版本检索现有模式
响应是
格式的模式对象
包含以下字段
模式标识
模式主题
模式格式
模式版本
模式定义
根据其主题和格式检索现有模式的列表
响应是
格式的每个模式对象的模式列表
包含以下字段
模式标识
模式主题
模式格式
模式版本
模式定义
通过其
来检索现有的模式
响应是
格式的模式对象
包含以下字段
模式标识
模式主题
模式格式
模式版本
模式定义
按其主题
格式和版本删除现有模式
按其
删除现有模式
按其主题删除现有模式
注意
本说明仅适用于
的用户
使用表名
存储
对象
这是一些数据库实现中的关键字
为了避免将来发生任何冲突
从
开始
我们选择了存储表的名称
建议任何正在升级的
用户在升级之前将其现有模式迁移到新表
注册表客户端
与模式注册表服务器交互的客户端抽象是
接口
具有以下结构
提供了开箱即用的实现
用于与其自己的模式服务器交互
以及与
注册表进行交互
可以使用
配置
模式注册表的客户端
如下所示
注意
优化了默认转换器
以缓存来自远程服务器的模式
而且还会非常昂贵的
和
方法
因此
它使用不缓存响应的
如果您打算直接在代码上使用客户端
您可以请求一个也缓存要创建的响应的
为此
只需将属性
添加到应用程序属性中即可
注册表客户端属性
注册表客户端支持以下属性
模式服务器的位置
在设置时使用完整的
包括协议
或
端口和上下文路径
默认
客户端是否应缓存模式服务器响应
通常设置为
因为缓存发生在消息转换器中
使用模式注册表客户端的客户端应将其设置为
默认
注册表客户端消息转换器
对于在应用程序上下文中注册了
的
应用程序
将自动配置使用模式注册表客户端进行模式管理的
消息转换器
这简化了模式演进
因为接收消息的应用程序可以轻松访问可与自己的读取器模式进行协调的写入器模式
对于出站邮件
如果频道的内容类型设置为
将被激活
例如
在出站转换期间
消息转换器将尝试基于其类型推断出站消息的模式
并使用
根据有效载荷类型将其注册到主题
如果已经找到相同的模式
那么将会检索对它的引用
如果没有
则将注册模式并提供新的版本号
该消息将使用
的方案
头发送
其中
是可配置的
并且从有效载荷类型推导出
例如
类型为
的消息可以作为内容类型为
的二进制有效载荷发送
其中
是主题
是版本号
当接收到消息时
转换器将从传入消息的头部推断出模式引用
并尝试检索它
该模式将在反序列化过程中用作写入器模式
注册表消息转换器属性
如果您已通过设置
启用基于
的模式注册表客户端
则可以使用以下属性自定义注册的行为
如果您希望转换器使用反射从
推断
则启用
默认
通过查看编写器模式
源有效载荷
和读取器模式
应用程序有效负载
来比较模式版本
查看
文档以获取更多信息
如果设置
这将覆盖模式服务器上的任何查找
并将本地模式用作读取器模式
默认
使用
服务器注册此属性中列出的任何
文件
默认
要在
头上使用的前缀
默认
注册和解决
为了更好地了解
注册和解决新模式以及其使用
模式比较功能
我们将提供两个单独的子部分
一个用于注册
一个用于解析模式
注册流程
序列化
注册过程的第一部分是从通过信道发送的有效载荷中提取模式
类型
如
或
已经包含一个模式
可以从实例中立即检索
在
的情况下
如果属性
设置为
默认
则会推断出一个模式
图
一旦获得了架构
转换器就会从远程服务器加载其元数据
版本
首先
它查询本地缓存
如果没有找到它
则将数据提交到将使用版本控制信息回复的服务器
转换器将始终缓存结果
以避免为每个需要序列化的新消息查询
服务器的开销
图
注册流程
使用模式版本信息
转换器设置消息的
头
以携带版本信息
如
解析过程
反序列化
当读取包含版本信息的消息
即
具有上述方案的
标头
时
转换器将查询
服务器以获取消息的
写入器
架构
一旦找到传入消息的正确架构
它就会检索读取器架构
并使用
的架构解析支持将其读入读取器定义
设置默认值和缺少的属性
图
阅读决议程序
注意
了解编写器架构
写入消息的应用程序
和读取器架构
接收应用程序
之间的区别很重要
请花点时间阅读
术语
并了解此过程
将始终提取
模式以确定如何读取消息
如果您想要
的架构演进支持工作
您需要确保为您的应用程序正确设置了
应用间通信
连接多个应用程序实例
虽然
使个人
应用程序轻松连接到消息传递系统
但是
的典型场景是创建多应用程序管道
其中微服务应用程序将数据发送给彼此
您可以通过将相邻应用程序的输入和输出目标相关联来实现此场景
假设设计要求时间源应用程序将数据发送到日志接收应用程序
则可以在两个应用程序中使用名为
的公共目标进行绑定
时间来源
具有频道名称
将设置以下属性
日志接收器
通道名称为
将设置以下属性
实例索引和实例计数
当扩展
应用程序时
每个实例都可以接收有关同一个应用程序的其他实例数量以及自己的实例索引的信息
通过
和
属性执行此操作
例如
如果
宿应用程序有三个实例
则所有三个实例将
设置为
并且各个应用程序将
设置为
和
当通过
数据流部署
应用程序时
这些属性将自动配置
当
应用程序独立启动时
必须正确设置这些属性
默认情况下
为
为
在放大的情况下
这两个属性的正确配置对于解决分区行为
见下文
一般很重要
并且某些绑定器
例如
总是需要这两个属性
以确保该数据在多个消费者实例之间正确分割
分区
配置输出绑定进行分区
输出绑定被配置为通过设置其唯一的一个
或
属性以及其
属性来发送分区数据
例如
以下是一个有效和典型的配置
基于上述示例配置
使用以下逻辑将数据发送到目标分区
基于
为发送到分区输出通道的每个消息计算分区密钥的值
是一个
表达式
它根据出站消息进行评估
以提取分区键
如果
表达式不足以满足您的需要
您可以通过将属性
设置为实现
接口的类来计算分区键值
虽然
表达式通常足够
但更复杂的情况可能会使用自定义实现策略
在这种情况下
属性
可以设置如下
一旦计算了消息密钥
分区选择过程将确定目标分区为
和
之间的值
在大多数情况下
默认计算基于公式
这可以通过设置要针对
通过
属性
进行评估的
表达式或通过设置
实现
通过
属性
进行自定义
和
的绑定级属性可以类似于上述示例中指定的
和
属性的类型
可以为更高级的场景配置其他属性
如以下部分所述
管理的自定义
实现
在上面的示例中
之类的自定义策略由
直接实例化
在某些情况下
必须将这样的自定义策略实现创建为
以便能够由
管理
以便它可以执行依赖注入
属性绑定等
可以通过将其配置为应用程序上下文中的
并使用完全限定类名作为
的名称
如以下示例所示
作为
自定义策略从
的完整生命周期中受益
例如
如果实现需要直接访问应用程序上下文
则可以实现
配置输入绑定进行分区
输入绑定
通道名称为
被配置为通过在应用程序本身设置其
属性以及
和
属性来接收分区数据
如以下示例
值表示数据需要分区的应用程序实例的总数
必须是
和
之间的多个实例的唯一值
实例索引帮助每个应用程序实例识别从其接收数据的唯一分区
或者在
的分区集合的情况下
重要的是正确设置两个值
以确保所有数据都被使用
并且应用程序实例接收到互斥数据集
虽然使用多个实例进行分区数据处理的场景可能会在独立情况下进行复杂化
但是通过将输入和输出值正确填充并依赖于运行时基础架构
数据流可以显着简化流程
提供有关实例索引和实例计数的信息
测试
支持测试您的微服务应用程序
而无需连接到消息系统
您可以使用
库提供的
可以将其作为测试依赖项添加到应用程序中
注意
使用
自动配置机制取代类路径中找到的其他绑定
因此
添加
作为依赖关系时
请确保正在使用
范围
允许用户与绑定的频道进行交互
并检查应用程序发送和接收的消息
对于出站消息通道
注册单个订户
并将应用程序发送的消息保留在
中
它们可以在测试过程中被检索
并对它们做出断言
用户还可以将消息发送到入站消息通道
以便消费者应用程序可以使用消息
以下示例显示了如何在处理器上测试输入和输出通道
在上面的示例中
我们正在创建一个具有输入和输出通道的应用程序
通过
接口绑定
绑定的接口被注入测试
所以我们可以访问这两个通道
我们正在输入频道发送消息
我们使用
测试支持提供的
来捕获消息已经被发
送到输出通道
收到消息后
我们可以验证组件是否正常工作
健康指标
为粘合剂提供健康指标
它以
的名义注册
可以通过设置
属性启用或禁用
指标发射器
提供了一个名为
的模块
可以用来从
度量端点
到命名通道发出任何可用度量
该模块允许运营商从流应用收集指标
而不依赖轮询其端点
当您设置度量绑定的目标名称
例如
时
该模块将被激活
可以以与任何其他生成器绑定相似的方式配置
的
默认设置为
以下属性可用于自定义度量标准的排放
要发射的度量的名称
应该是每个应用程序的唯一值
默认
前缀字符串
以前缀到度量键
默认值
就像
选项一样
它允许将白名单应用程序属性添加到度量有效负载
默认值
有关度量导出过程的详细概述
请参见
参考文档
提供了一个名为
的指标导出器
可以通过常规
指标配置属性进行配置
可以通过使用出口商的全局
配置设置或使用特定于导出器的属性来配置导出器
要使用全局配置设置
属性应以
为前缀
例如
这些配置选项将适用于所有出口商
除非它们的配置不同
或者
如果要使用与其他出口商不同的配置设置
例如
限制发布的度量数量
则可以使用前缀
配置
提供的度量导出器
例如
注意
由于
的
轻松约束
所包含的属性的值可能与原始值稍有不同
作为经验法则
度量导出器将尝试使用点符号
例如
成为
以一致的格式标准化所有属性
规范化的目标是使下游用户能够始终如一地接收属性名称
无论它们如何设置在受监视的应用程序上
或
始终会生成
以下是通过以下命令以
格式发布到频道的数据的示例
得到的
是
样品
对于
示例
请参阅
上的
样本
存储库
入门
要开始创建
应用程序
请访问
并创建一个名为
的新
项目
在下拉菜单中选择
在
搜索依赖关系
文本框中键入
或
具体取决于您要使用的
接下来
在与
类相同的包中创建一个新类
给它以下代码
注释是触发
基础架构组件的创建
具体来说
它将创建一个
连接工厂
一个
出站通道适配器
并在
界面中定义消息通道
自动配置还创建一个默认轮询器
以便每秒调用
方法一次
标准的
注释使用返回值作为消息的有效内容向源的输出通道发送消息
要测试驱动此设置
请运行
消息代理
一个简单的方法是使用
镜像
构建应用程序
消费者应用程序以类似的方式进行编码
返回
并创建另一个名为
的项目
然后在与类
相同的包中创建一个新类
并使用以下代码
构建应用程序
要将
应用程序连接到
应用程序
每个应用程序必须共享相同的目标名称
启动这两个应用程序如下所示
您将看到消费者应用程序打印
和时间戳到控制台
不同的服务器端口可以防止两个应用程序中用于维护
执行器端点的
端口的冲突
应用程序的输出将如下所示
实施
用法
对于使用
绑定器
您只需要使用以下
坐标将其添加到您的
应用程序
或者
您也可以使用
概述
以下可以看到
绑定器操作的简化图
图
实现将每个目标映射到
主题
消费者组织直接映射到相同的
概念
分区也直接映射到
分区
配置选项
本节包含
绑定器使用的配置选项
有关
的常见配置选项和属性
请参阅
核心文档
活页夹将连接的经纪人列表
默认值
允许使用或不使用端口信息指定的主机
例如
当在代理列表中没有配置端口时
这将设置默认端口
默认值
绑定器可以连接的
节点列表
默认值
允许使用或不使用端口信息指定的主机
例如
当在节点列表中没有配置端口时
这将设置默认端口
默认值
客户端属性
生产者和消费者
的密钥
值映射传递给由绑定器创建的所有客户端
由于这些属性将被生产者和消费者使用
所以使用应该限于常见的属性
特别是安全设置
默认值
空地图
将由活页夹传送的自定义标题列表
默认值
空
以毫秒为单位的频率
以毫秒为单位
保存偏移量
忽略
默认值
频率
更新次数
哪些消耗的偏移量会持续存在
忽略
与
相互排斥
默认值
经纪人所需的
数量
默认值
只有设置
或
才有效
绑定器在其生成
消耗数据的主题上配置的全局最小分区数
它可以由生产者的
设置或生产者的
设置的值替代
如果更大
默认值
如果
处于活动状态
则自动创建主题的复制因子
默认值
如果设置为
绑定器将自动创建新主题
如果设置为
则绑定器将依赖于已配置的主题
在后一种情况下
如果主题不存在
则绑定器将无法启动
值得注意的是
此设置与代理的
设置无关
并不影响它
如果服务器设置为自动创建主题
则可以将其创建为元数据检索请求的一部分
并使用默认代理设置
默认值
如果设置为
则绑定器将根据需要创建新的分区
如果设置为
则绑定器将依赖于已配置的主题的分区大小
如果目标主题的分区计数小于预期值
则绑定器将无法启动
默认值
消费者使用的套接字缓冲区的大小
以字节为单位
默认值
消费者
以下属性仅适用于
消费者
必须以
为前缀
当
主题分区将在消费者组的成员之间自动重新平衡
当
根据
和
为每个消费者分配一组固定的分区
这需要在每个启动的实例上适当地设置
和
属性
在这种情况下
属性
通常必须大于
默认值
是否在处理邮件时自动提交偏移量
如果设置为
则入站消息中将显示带有
类型的密钥
的报头
应用程序可以使用此标头来确认消息
有关详细信息
请参阅示例部分
当此属性设置为
时
将
模式设置为
默认值
只有
设置为
才有效
如果设置为
它会禁止导致错误的邮件的自动提交
并且只会为成功的邮件执行提交
允许流在上次成功处理的邮件中自动重播
以防持续发生故障
如果设置为
它将始终自动提交
如果启用了自动提交
如果没有设置
默认
它实际上具有与
相同的值
如果它们被发送到
则自动提交错误的消息
否则不提交它们
默认值
未设置
连接恢复尝试之间的间隔
以毫秒为单位
默认值
是否将消费者的偏移量重置为
提供的值
默认值
开始偏移
新组的起始偏移量
或
为
时的起始偏移量
允许的值
如果消费者组被明确设置为消费者
绑定
通过
那么
设置为
否则对于
消费者组
设置为
默认值
相当于
当设置为
时
它将为消费者发送启用
行为
默认情况下
导致错误的邮件将转发到名为
的主题
主题名称可以通过属性
配置
对于错误数量相对较少并且重播整个原始主题可能太麻烦的情况
这为更常见的
重播场景提供了另一种选择
默认值
组态
使用包含通用
消费者属性的键
值对映射
默认值
空地图
接收错误消息的
主题的名称
默认值
如果未指定
将导致错误的消息将转发到名为
的主题
生产者
以下属性仅适用于
生产者
必须以
为前缀
缓冲区大小
上限
以字节为单位
生产者将在发送之前尝试批量的数据量
默认值
同步
生产者是否是同步的
默认值
生产者在发送之前等待多长时间
以便允许更多消息在同一批次中累积
通常
生产者根本不等待
并且简单地发送在先前发送进行中累积的所有消息
非零值可能会以延迟为代价增加吞吐量
默认值
组态
使用包含通用
生产者属性的键
值对映射
默认值
空地图
注意
绑定器将使用生产者的
设置作为提示
以创建具有给定分区计数的主题
与
一起使用
最多两个为正在使用的值
配置绑定器的
和应用程序的
时要小心
因为将使用较大的值
如果一个主题已经存在较小的分区计数
并且
被禁用
默认值
则绑定器将无法启动
如果一个主题已经存在较小的分区计数
并且启用了
则会添加新的分区
如果一个主题已经存在的分区数量大于
和
的最大值
则将使用现有的分区计数
用法示例
在本节中
我们举例说明了上述属性在具体情况下的使用
示例
设置
并依赖手动确认
该示例说明了如何在消费者应用程序中手动确认偏移量
此示例要求
设置为
使用相应的输入通道名称作为示例
示例
安全配置
支持客户端和代理商之间的安全连接
要充分利用此功能
请遵循汇编文档中的
文档
以及
安全性指导原则
使用
选项为绑定器创建的所有客户端设置安全属性
例如
要将
设置为
请设置
所有其他安全属性可以以类似的方式设置
使用
时
请按照参考文档中的
说明
创建和引用
配置
支持使用
配置文件并使用
属性将
配置信息传递到应用程序
使用
配置文件
可以通过使用系统属性为
应用程序设置
和
可选
文件位置
以下是使用
配置文件启动带有
和
的
应用程序的示例
使用
属性
作为使用
配置文件的替代方案
提供了一种使用
属性为
应用程序设置
配置的机制
以下属性可用于配置
客户端的登录上下文
登录模块名称
在正常情况下不需要设置
默认值
登录模块的控制标志
默认值
使用包含登录模块选项的键
值对映射
默认值
空地图
以下是使用
配置属性启动带有
和
的
应用程序的示例
这相当于以下
文件
如果所需的主题已经存在于代理上
或将由管理员创建
则自动创建可以被关闭
并且仅需要发送客户端
属性
作为设置
的替代方法
您可以简单地从应用程序中删除代理依赖关系
有关详细信息
请参阅
基于绑定器的应用程序的类路径中排除
代理
注意
不要在同一应用程序中混合
配置文件和
属性
如果
系统属性已存在
则
将忽略
属性
注意
使用
和
如果使用
请务必小心
通常应用程序可能使用
和
中没有管理权限的主体
并且依赖
创建
修改主题可能会失败
在安全环境中
我们强烈建议您使用
工具管理性地创建主题并管理
使用绑定器与
中的默认
支持是针对
版本
的
粘合剂还支持连接到其他
版本和
客户端
为了做到这一点
当你创建包含你的应用程序的项目时
包括
你通常会对默认的绑定器做
然后将这些依赖项添加到
文件中的部分的顶部以覆盖依赖关系
以下是将应用程序降级到
的示例
由于它仍在
行
因此可以保留默认的
和
版本
这是使用
版本的另一个例子
注意
以上版本仅为了举例而提供
为获得最佳效果
我们建议您使用最新的
兼容版本的项目
从基于绑定器的应用程序的类路径中排除
代理
使用作为
服务器库一部分的管理实用程序来创建和重新配置主题
如果在运行时不需要包含
服务器库及其依赖关系
因为应用程序将依赖于管理中配置的主题
允许排除
服务器依赖关系从应用程序
如果您使用上述建议的
依赖关系的非默认版本
则只需要包含
代理依赖项
如果您使用默认的
版本
请确保从
依赖关系中排除
如下所示
如果您排除
服务器依赖关系
并且该主题不在服务器上
那么如果在服务器上启用了自动主题创建
则
代理将创建该主题
请注意
如果您依赖此
则
服务器将使用默认数量的分区和复制因子
另一方面
如果在服务器上禁用自动主题创建
则在运行应用程序之前必须注意创建具有所需数量分区的主题
如果要完全控制分区的分配方式
请保留默认设置
即不要排除
代理程序
并确保将
设置为
这是默认设置
主题处理
因为不可能预料到用户如何处理死信消息
所以框架不提供任何标准的机制来处理它们
如果死刑的原因是短暂的
您可能希望将邮件路由到原始主题
但是
如果问题是一个永久性的问题
那可能会导致无限循环
以下
应用程序是如何将这些消息路由到原始主题的示例
但在三次尝试后将其移动到第三个
停车场
主题
该应用程序只是从死信主题中读取的另一个
应用程序
秒内没有收到消息时终止
这些示例假定原始目的地是
而消费者组是
有几个注意事项
当主应用程序未运行时
请考虑仅运行重新路由
否则
瞬态错误的重试将很快用尽
或者
使用两阶段方法
使用此应用程序路由到第三个主题
另一个则从那里路由到主题
由于这种技术使用消息标头来跟踪重试
所以它不会与
一起使用
在这种情况下
请考虑将一些数据添加到有效载荷
主应用程序可以忽略
必须将
添加到
属性
和主应用程序
以便标头在应用程序之间传输
由于
是发布
订阅
所以重播的消息将被发送给每个消费者组
即使是那些首次成功处理消息的消费者组
应用
用法
对于使用
绑定器
您只需要使用以下
坐标将其添加到您的
应用程序
或者
您也可以使用
入门
概述
以下可以看到
活页夹的操作简化图
图
实现将每个目的地映射到
对于每个消费者组
将绑定到该
每个消费者实例对其组的
具有相应的
实例
对于分区生成器
消费者
队列后缀为分区索引
并使用分区索引作为路由密钥
使用
选项
您可以选择配置绑定器来创建和配置死信队列
以及死信交换
死信队列具有目标名称
附有
如果重试启用
则会将失败的消息传递到
如果禁用重试
则应将
设置为
默认
以使失败的消息将路由到
而不是重新排队
此外
导致绑定器向
发布失败的消息
而不是拒绝它
这使得能够将标题中的附加信息添加到消息中
例如
头中的堆栈跟踪
此选项不需要重试启用
一次尝试后
您可以重新发布失败的消息
从
版本
开始
您可以配置重新发布的消息传递模式
见财产
重要
将
设置为
将导致消息被重新排序并重新发送
这可能不是您想要的
除非故障问题是短暂的
一般来说
最好通过将
设置为大于
或将
设置为
来启用
内的重试
有关这些属性的更多信息
请参阅
框架不提供消耗死信消息
或重新路由到主队列
的任何标准机制
队列处理
中描述了一些选项
注意
在
应用程序中使用
多个
绑定器时
禁用
以避免将
应用于两个绑定器的相同配置很重要
配置选项
本节包含特定于
和绑定频道的设置
有关通用绑定配置选项和属性
请参阅
核心文档
默认情况下
使用
的
因此它支持
的所有
配置选项
有关参考
请参阅
文档
配置选项使用
前缀
除
选项之外
还支持以下属性
管理插件网址的逗号分隔列表
仅在
包含多个条目时使用
此列表中的每个条目必须在
中具有相应的条目
默认值
空
节点名称的逗号分隔列表
当多个条目用于查找队列所在的服务器地址时
此列表中的每个条目必须在
中具有相应的条目
默认值
空
压缩绑定的压缩级别
见
默认值
消费者
以下属性仅适用于
消费者
并且必须以
为前缀
确认模式
默认值
是否自动声明
并将其绑定到绑定器
默认值
将队列绑定到交换机的路由密钥
如果
为
将附加分区目的地
默认值
是否将队列绑定到目的地交换机
如果您已经设置了自己的基础设施并且先前已经创建
绑定了队列
请设置为
默认值
的名称
默认值
分配给队列的
如果
为
默认值
一个死信路由密钥分配给队列
如果
为
默认值
是否为目的地申报交换
默认值
是否将交换声明为
需要在代理上延迟的消息交换插件
参数设置为
默认值
如果
被声明
则将
分配给该队列
默认值
如果
被声明
则会将一个死信路由密钥分配给该队列
默认无
默认值
未使用的死信队列被删除多久
默认值
死信队列中的最大消息数
默认值
来自所有消息的死信队列中的最大字节数
默认值
死信队列中消息的最大优先级
默认值
声明
时默认适用于死信队列的时间
默认值
订阅是否应该耐用
仅当
也被设置时才有效
默认值
如果
为真
则交换机是否应该自动删除
删除最后一个队列后删除
默认值
如果
为真
则交换应该是否持久
经纪人重新启动
默认值
交换类型
非分区目的地的
或
或
分区目的地
默认值
到期
未使用的队列被删除多久
默认值
要从入站邮件映射的头文件
默认值
所有标题
最大消费者人数
默认值
最长长度
队列中最大消息数
默认值
来自所有消息的队列中最大字节数
默认
队列中消息的最大优先级
默认
预取
预取计数
默认值
字首
要添加到
和队列名称的前缀
默认值
连接恢复尝试之间的间隔
以毫秒为单位
默认值
在重试禁用或重新发布
是否为
时
是否应重新发送传递失败
默认值
当
为
时
指定重新发布的邮件的传递模式
默认值
默认情况下
尝试重试后失败的消息将被拒绝
如果配置了死信队列
则
将将失败的消息
未更改
路由到
如果设置为
则绑定器将重新发布具有附加头的
的失败消息
包括最终失败的原因的异常消息和堆栈跟踪
默认值
交易
是否使用交易渠道
默认值
声明
时默认适用于队列的时间
默认值
阿克斯之间的交付次数
默认值
兔子生产者
以下属性仅适用于
生产者
必须以
为前缀
是否自动声明
并将其绑定到绑定器
默认值
是否启用生产者的消息批处理
默认值
批量启动时要缓冲的消息数
默认值
默认值
默认值
将队列绑定到交换机的路由密钥
如果
为
仅适用于非分区目的地
仅适用于
然后仅提供给这些组
默认值
是否将队列绑定到目的地交换机
如果您已经设置了自己的基础架构并且先前已经创建
绑定了队列
请设置为
仅适用于
然后仅提供给这些组
默认值
压缩
发送时是否应压缩数据
默认值
的名称仅适用于
仅适用于这些组
默认值
分配给队列的
如果
为
只适用于
然后只提供给这些组
默认值
一个死信路由密钥分配给队列
如果
为
只适用于
然后只提供给这些组
默认值
是否为目的地申报交换
默认值
延迟
评估应用于消息
头
的延迟的
表达式
如果交换不是延迟的消息交换
则不起作用
默认值
头设置
是否将交换声明为
需要经纪人上的延迟消息交换插件
参数设置为
默认值
交货方式
默认值
如果
被声明
则分配给该队列的
只适用于
然后仅提供给这些组
默认值
如果
被声明
则会将一个死信路由密钥分配给该队列
默认值
仅在提供
时才适用
然后仅适用于这些组
默认值
未使用的死信队列被删除之前多久
仅适用于
然后仅提供给这些组
默认值
死信队列中的最大消息数仅适用于
仅适用于这些组
默认值
来自所有消息的死信队列中的最大字节数仅适用于
然后仅提供给这些组
默认值
死信队列中消息的最大优先级
仅适用于
然后仅提供给这些组
默认值
声明
的默认时间适用于死信队列仅适用于
然后仅提供给这些组
默认值
如果
为真
则交换机是否应该自动删除
删除最后一个队列后删除
默认值
如果
为真
则交换应该是持久的
经纪人重新启动
默认值
交换类型
或
或
默认值
到期
在未使用的队列被删除之前多久
仅适用于
然后只提供给这些组
默认值
要将标头映射到出站邮件的模式
默认值
所有标题
最长长度
队列中最大消息数仅适用于
仅适用于这些组
默认值
来自所有消息的队列中最大字节数仅适用于
仅适用于这些组
默认值
队列中消息的最大优先级
仅适用于
仅适用于这些组
默认
字首
要添加到
交换机名称的前缀
默认值
一个
表达式来确定在发布消息时使用的路由密钥
默认值
或
分区目的地
交易
是否使用交易渠道
默认值
声明时默认适用于队列的时间
仅适用于
然后仅适用于这些组
默认值
注意
在
的情况下
内容类型头可以由外部应用程序设置
支持它们作为用于任何类型传输
包括通常不支持头文件的
的传输的扩展内部协议的一部分
重试
概观
在绑定器中启用重试时
侦听器容器线程将被挂起
以配置任何后退时段
在单个消费者需要严格排序时
这可能很重要
但是对于其他用例
它可以防止在该线程上处理其他消息
使用绑定器重试的另一种方法是设置死机字符随着时间生活在死信队列
上
以及
本身的死信配置
有关这里讨论的属性的更多信息
请参阅
启用此功能的示例配置
将
设置为
绑定器将创建一个
您可以选择在
中指定一个名称
将
设置为您要在重新投递之间等待的退出时间
将
设置为默认交换
的过期消息将被路由到原始队列
因为默认
是队列名称
要强制一个消息被填字
抛出一个
或设置
到
并抛出任何异常
循环将继续没有结束
这对于短暂的问题是很好的
但是您可能想在一些尝试后放弃
幸运的是
提供了
标题
允许您确定发生了多少个周期
在放弃之后确认一则消息
抛出一个
把它放在一起
此配置创建一个与通配符路由密钥
交换主题的队列
的交换
它创建一个绑定到具有路由密钥
的直接交换
的
当消息被拒绝时
它们被路由到
秒钟后
消息过期
并使用队列名称作为路由密钥路由到原始队列
申请
请注意
标题中的
属性是
队列处理
因为不可能预料到用户如何处理死信消息
所以框架不提供任何标准的机制来处理它们
如果死刑的原因是暂时的
您可能希望将邮件路由到原始队列
但是
如果问题是一个永久性的问题
那可能会导致无限循环
以下
应用程序是如何将这些消息路由到原始队列的示例
但是在三次尝试之后将其移动到第三个
停车场
队列
第二个例子使用
延迟消息交换
来向被重新排序的
消息
引入延迟
在这个例子中
每次尝试的延迟都会增加
这些示例使用
从
接收消息
您也可以在批处理过程中使用
这些示例假定原始目的地是
消费者组是
非分区目的地
前两个示例是目的地
未
分区
分区目的地
对于分区目的地
所有分区都有一个
我们从头部确定原始队列
当
为
时
将消息发布到
其中包含有关原始目的地信息的
标题
真
当
为
时
重新发布恢复器将原始交换和路由密钥添加到标题
将分布式系统的节点与轻量级消息代理链接
这可以用于广播状态更改
例如配置更改
或其他管理指令
一个关键的想法是
总线就像一个分布式执行器
用于扩展的
应用程序
但也可以用作应用程序之间的通信通道
目前唯一的实现是使用
代理作为传输
但是相同的基本功能集
还有一些取决于传输
在其他传输的路线图上
注意
根据非限制性
许可证发布
如果您想为文档的这一部分做出贡献
或者发现错误
请在
中找到项目中的源代码和问题跟踪器
快速开始
的工作原理是添加
自动配置
如果它在类路径中检测到自身
所有您需要做的是启用总线是将
或
添加到您的依赖关系管理中
并且
负责其余部分
确保代理
或
可用和配置
在本地主机上运行
您不应该做任何事情
但如果您远程运行使用
连接器或
定义经纪人凭据的约定
例如
总线当前支持向所有节点发送消息
用于特定服务的所有节点
由
定义
未来可能会添加更多的选择器标准
即
仅数据中心
中的服务
节点等
执行器命名空间下还有一些
端点
目前有两个实施
第一个
发送密钥
值对来更新每个节点的
环境
第二个
将重新加载每个应用程序的配置
就好像他们在他们的
端点上都被
过
注意
总线起动器覆盖了
和
因为这是两种最常用的实现方式
但是
非常灵活
绑定器将与
结合使用
处理实例
端点接受
目的地
参数
例如
其中目的地是
如果
由总线上的一个实例拥有
那么它将处理消息
所有其他实例将忽略它
将
中的
设置为
活动配置文件和
的组合
寻址服务的所有实例
参数用于
路径分隔符为冒号
以确定实例是否处理该消息
使用上述示例
将针对
客户
服务的所有实例
而不管配置文件和端口设置为
应用程序上下文
必须是唯一的
总线尝试从原始
一次消除处理事件两次
一次从队列中消除
为此
它会检查发送应用程序上下文
以重新显示当前的应用程序上下文
如果服务的多个实例具有相同的应用程序上下文
则不会处理事件
在本地机器上运行
每个服务将在不同的端口上
这将是应用程序上下文
的一部分
提供了区分的索引
要确保应用程序上下文
是唯一的
请将
设置为服务的每个实例唯一的值
例如
在
中
在
中设置
如果使用
请设置
自定义
使用
广播消息
以便获取消息流
只需要在类路径中包含您选择的
实现
有
和
的公共汽车专用起动方便
一般来说
依赖于用于配置中间件的
自动配置约定
因此例如
代理地址可以使用
配置属性更改
在
中具有少量本地配置属性
例如
是使用外部中间件的主题的名称
通常
默认值就足够了
要更多地了解如何自定义消息代理设置
请参阅
文档
跟踪
可以通过设置
来跟踪总线事件
的子类
如果这样做
那么
如果存在
将显示每个发送的事件和来自每个服务实例的所有
示例
来自
端点
该跟踪显示
从
发送到所有服务
并且已被
和
收到
为了处理信号
您可以向您的应用添加
和
类型的
并启用跟踪
或者您可以利用
并从中挖掘数据
注意
任何总线应用程序都可以跟踪
但有时在一个可以对数据进行更复杂查询的中央服务器中执行此操作是有用的
或者将其转发到专门的跟踪服务
广播自己的
总线可以携带任何类型为
的事件
但默认传输是
并且解串器需要知道哪些类型将提前使用
要注册一个新类型
它需要在
的子包中
要自定义事件名称
您可以在自定义类上使用
或者依赖默认策略来使用类的简单名称
请注意
生产者和消费者都需要访问类定义
在自定义包中注册事件
如果您不能或不想为自定义事件使用
的子包
则必须使用
指定要扫描类型为
的事件的包
使用
指定的软件包包括子包
例如
如果您有一个名为
的自定义事件
您可以通过以下方式与解串器注册此事件
没有指定一个值
使用
的类的包将被注册
在这个例子中
将使用
的包进行注册
您还可以使用
上的
或
属性明确指定要扫描的软件包
例如
以上
的所有示例都是等效的
因为
程序包将通过在
上明确指定程序包来注册
请注意
您可以指定要扫描的多个基本软件包
为
实现分布式跟踪解决方案
术语
借用了
的
术语
工作的基本单位例如
发送
是一个新的跨度
以及向
发送响应
由跨度的唯一
位
标识
跨度是其中一部分的跟踪的另一个
位
跨度还具有其他数据
例如描述
时间戳记事件
键值注释
标签
导致它们的跨度的
以及进程
通常是
地址
跨距开始和停止
他们跟踪他们的时间信息
创建跨度后
必须在将来的某个时刻停止
小费
启动跟踪的初始范围称为
该跨度的跨度
的值等于跟踪
跟踪
一组
形成树状结构
例如
如果您正在运行分布式大数据存储
则可能会由
请求形成跟踪
注释
用于及时记录事件的存在
用于定义请求的开始和停止的一些核心注释是
客户端发送
客户端已经发出请求
此注释描绘了跨度的开始
服务器接收
服务器端得到请求
并将开始处理它
如果从此时间戳中减去
时间戳
则会收到网络延迟
服务器发送
在完成请求处理后
响应发送回客户端时
注释
如果从此时间戳中减去
时间戳
则会收到服务器端处理请求所需的时间
客户端接收
表示跨度的结束
客户端已成功接收到服务器端的响应
如果从此时间戳中减去
时间戳
则会收到客户端从服务器接收响应所需的整个时间
可视化
和
将与
注释一起查看系统
一个音符的每个颜色表示跨度
从
到
如果您在笔记中有这样的信息
这意味着
当前的跨度
痕量
设置为
编号
设置为
ð
它也发出了
客户端发送的
事件
这样
的父
子关系的可视化将如下所示
目的
在以下部分中
将考虑上述图像中的示例
分布式跟踪与
共有
个
如果您在
中查看痕迹
您将在第二个曲目中看到这个数字
但是
如果您选择特定的跟踪
那么您将看到
注意
当选择特定的跟踪时
您将看到合并的
这意味着如果发送到服务器接收和服务器发送
接收客户端和客户端发送注释的
有
个
那么它们将被显示为一个跨度
为什么在这种情况下
和
之间有区别
来自
范围
它具有服务器接收
和服务器发送
注释
来自
到
到
端点的
呼叫
它在
方面具有客户端发送
和客户端接收
注释
它还在
方面具有服务器接收
和服务器发送
注释
在物理上有
个
但它们形成与
调用相关的
个逻辑跨度
来自
到
到
端点的
呼叫
它在
方面具有客户端发送
和客户接收
注释
它还具有
端的服务器接收
和服务器发送
注释
在物理上有
个
但它们形成与
调用相关的
个逻辑跨度
来自
到
到
端点的
呼叫
它在
方面具有客户端发送
和客户接收
注释
它还在
侧具有服务器接收
和服务器发送
注释
在物理上有
个
但它们形成与
调用相关的
个逻辑跨度
因此
如果我们计算
中有
个
来自
的呼叫
呼叫
和
共
个
逻辑上
我们看到
的信息
因为我们有
个
跨度与传入请求相关的
和
与
调用相关
可视化错误
允许您可视化跟踪中的错误
当异常被抛出并且没有被捕获时
我们在
可以正确着色的跨度上设置适当的标签
您可以在痕迹列表中看到一条是红色的痕迹
这是因为抛出了一个异常
如果您点击该轨迹
您将看到类似的图片
然后
如果您点击其中一个
您将看到以下内容
你可以看到
你可以很容易的看到错误的原因和整个
相关的
实例
点击
图标即可实时查看
点击
图标直播
中的依赖图将如下所示
点击
图标即可实时查看
点击
图标直播
对数相关
当通过跟踪
等于例如
来对这四个应用程序的日志进行灰名单时
将会得到以下内容
如果你使用像一个日志聚合工具
的
等您可以订购所发生的事件
基巴纳的例子如下所示
如果你想使用
这里是
的
模式
注意
如果您想将
与
的日志一起使用
则必须使用此模式
使用
进行
回溯
通常
您不希望将日志存储在文本文件中
而不是将
可以立即选择的
文件中存储
为此
您必须执行以下操作
为了可读性
我们将依赖关系传递给
符号
依赖关系设置
确保
位于类路径
添加
编码
版本
的示例
回读设置
您可以在下面找到一个
配置
名为
的示例
将来自应用程序的信息以
格式记录到
文件
已经评论了两个额外的追加者
控制台和标准日志文件
具有与上一节所述相同的记录模式
注意
如果您使用自定义
则必须通过
而不是
属性文件传递
否则您的自定义
文件将不会正确读取该属性
传播
上下文
跨度上下文是必须传播到任何子进程跨越进程边界的状态
背景的一部分是行李
跟踪和跨度
是跨度上下文的必需部分
行李是可选的部分
行李是一组密钥
存储在范围上下文中的值对
行李与痕迹一起旅行
并附在每一个跨度上
如果
标头以
为前缀
并且以
开头的消息传递
将会明白标题是行李相关的
重要
行李物品的数量或大小目前没有限制
但是
请记住
太多可能会降低系统吞吐量或增加
延迟
在极端情况下
由于超出了传输级消息或报头容量
可能会使应用程序崩溃
在跨度上设置行李的示例
行李与
标签
行李随行旅行
即每个孩子跨度都包含其父母的行李
不了解行李
甚至不会收到这些信息
标签附加到特定的跨度
它们仅针对该特定跨度呈现
但是
您可以通过标签搜索查找跟踪
其中存在具有搜索标签值的跨度
如果您希望能够根据行李查找跨度
则应在根跨度中添加相应的条目作为标签
添加到项目中
只有
对数相关
如果您只想从
中获利
而没有
集成
只需将
模块添加到您的项目中即可
的
为了不自己选择版本
如果您通过
添加依赖关系管理
会更好
将依赖关系添加到
摇篮
为了不自己选择版本
如果您通过
添加依赖关系管理
会更好
将依赖关系添加到
通过
访问
如果你想要
和
只需添加
依赖关系
的
为了不自己选择版本
如果您通过
添加依赖关系管理
会更好
将依赖关系添加到
摇篮
为了不自己选择版本
如果您通过
添加依赖关系管理
会更好
将依赖关系添加到
通过
使用
的
如果你想要
和
只需添加
依赖关系
的
为了不自己选择版本
如果您通过
添加依赖关系管理
会更好
将依赖关系添加到
将依赖关系添加到
中
这样就可以下载依赖关系
添加一个粘合剂
例如
来告诉
应该绑定什么
摇篮
为了不自己选择版本
如果您通过
添加依赖关系管理
会更好
将依赖关系添加到
将依赖关系添加到
中
这样就可以下载所有依赖关系
添加一个粘合剂
例如
来告诉
应该绑定什么
收藏家
如果要启动
收藏夹
只需添加
依赖关系即可
的
为了不自己选择版本
如果您通过
添加依赖关系管理
会更好
将依赖关系添加到
将依赖关系添加到
这样一来
所有的依赖依赖将被下载
添加一个粘合剂
例如
来告诉
应该绑定什么
摇篮
为了不自己选择版本
如果您通过
添加依赖关系管理
会更好
将依赖关系添加到
将依赖关系添加到
这样将依赖关系依赖下载
添加一个粘合剂
例如
来告诉
应该绑定什么
然后使用
注释注释你的主类
额外的资源
谈论
和
点击此处查看视频
特征
将跟踪和跨度添加到
以便您可以从日志聚合器中的给定跟踪或跨度中提取所有日志
示例日志
注意
中的
条目
发生特定操作的
记录跨度的应用程序的名称
包含跨度的延迟图的
导出
日志是否应该被导出到
与否
你什么时候希望跨度不能出口
在这种情况下
你想在
中包装一些操作
并将它写入日志
提供对共同分布式跟踪数据模型的抽象
形成
注释
键值注释
松散地基于
但
兼容
记录定时信息以辅助延迟分析
使用窃贼
您可以精确定位应用程序中的延迟原因
被写入不会记录太多
并且不会导致您的生产应用程序崩溃
传播有关您的呼叫图表带内的结构数据
其余的是带外
包括有意见的层次测试
如
包括采样策略来管理卷
可以向
系统报告查询和可视化
仪器来自
应用程序
过滤器
异步终结点
休息模板
调度操作
消息通道
过滤器
假客户端
的通用入口和出口点
包括在
或消息传递边界上加入跟踪的默认逻辑
例如
传播通过
兼容的请求标头工作
该传播逻辑是通过
和
实现来定义和定制的
可以在进程之间传播上下文
也称为行李
这意味着如果您设置了
行李元素
那么它将通过
或消息传递到其他进程发送到下游
提供创建
继续
并通过注释添加标签和日志的方法
提供接受
删除
的简单指标
如果
则应用程序将生成并收集
兼容的跟踪
默认情况下
它通过
将其发送到
上的
服务器
端口
使用
配置服务的位置
如果
则该应用将通过
生成和收集跟踪
您的应用程序自动成为通过您的代理商发送的跟踪消息的生产者
例如
重要
如果使用
或
请使用
默认
即
配置
的百分比
否则你可能认为
不工作
因为它省略了一些
注意
始终设置
并且
用户将立即按照上述示例查看日志中的跟踪和跨度
其他日志记录系统必须配置自己的格式化程序以获得相同的结果
默认值为
设置为
这是回访用户的
功能
这意味着如果您不使用
则不会自动应用此模式
采样
在分布式跟踪中
数据量可能非常高
因此采样可能很重要
您通常不需要导出所有
以获得正在发生的情况
具有
策略
您可以实现该策略来控制采样算法
采样器不会停止生成跨度
相关
但是它们确实阻止了附加和导出的标签和事件
默认情况下
您将获得一个策略
如果跨度已经处于活动状态
则会继续跟踪
但新策略始终被标记为不可导出
如果您的所有应用程序都使用此采样器运行
您将看到日志中的跟踪
但不会在任何远程存储中
对于测试
默认值通常是足够的
如果您仅使用日志
例如使用
聚合器
则可能是您需要的
如果要将
数据导出到
或
则还有一个
导出所有内容
并且
对
的固定分数进行采样
注意
如果您使用
或
则默认为
您可以使用
配置导出
通过的价值需要从
到
的双倍
所以不是百分比
为了向后兼容性原因
我们不会更改属性名称
可以通过创建一个
定义来安装采样器
例如
小费
您可以将
标头
设置为
或者在进行消息传递时
您可以将
标题设置为
然后
无论采样决定如何
当前跨度都将被强制输出
仪表
自动为您的所有
应用程序设备
因此您不必执行任何操作即可激活它
根据可用的堆栈
例如对于我们使用
的
应用程序
以及
我们使用
可以使用各种技术添加仪器
您可以自定义
标签中使用的键
为了限制跨度数据量
默认情况下
请求只会被标记为少量的元数据
如状态码
主机和
您可以通过配置
头名称列表
来添加请求头
注意
记住
如果有一个
允许它
默认情况下没有
所以没有意外收集太多数据而没有配置东西的危险
那么只会收集和导出标签
注意
目前
中的测试仪器是渴望的
这意味着我们正在积极地尝试在线程之间传递跟踪上下文
即使在没有将数据导出到跟踪系统的情况下
也会捕获定时事件
这种做法在将来可能会改变为在这件事上懒惰
生命周期
您可以通过
接口在
上
执行
以下操作
开始
当您启动一个
时
它的名称被分配
并且记录开始时间戳
关闭
跨度完成
记录跨度的结束时间
如果跨度可
导出
则它将有资格收集到
该跨度也从当前线程中移除
继续
将创建一个新的跨度实例
而它将是它继续的一个副本
分离
跨度不会停止或关闭
它只从当前线程中删除
使用显式父项创建
您可以创建一个新的跨度
并为其设置一个显式父级
小费
为您创建了一个
的实例
为了使用它
你需要的只是自动连接它
创建和关闭
您可以使用
界面手动创建
在这个例子中
我们可以看到如何创建一个新的跨度实例
假设这个线程中已经存在跨度
那么它将成为该跨度的父代
重要
创建跨度后始终清洁
如果要将其发送到
请不要忘记关闭跨度
重要
如果您的
包含的名称大于
个字符
则该名称将被截断为
个字符
你的名字必须是明确而具体的
大名称导致延迟问题
有时甚至引发异常
继续
有时你不想创建一个新的跨度
但你想继续
这种情况的例子可能是
当然这取决于用例
如果在达到方面之前已经创建了一个跨度
则可能不想创建一个新的跨度
执行
命令很可能是当前处理的逻辑部分
实际上
它只是一个技术实现细节
你不一定要反映在跟踪中作为一个单独的存在
持续的跨度实例等于它继续的范围
要继续跨度
您可以使用
界面
重要
创建跨度后始终清洁
如果在一个线程
例如线程
中开始了某些工作
并且正在等待其他线程
例如
完成
请不要忘记分离跨距
那么线程
中的
在工作结束时应该被分离
当收集结果时
螺纹
中的跨度应该被关闭
用明确的父代创建
您可能想要开始一个新的跨度
并提供该跨度的显式父级
假设跨度的父项在一个线程中
并且要在另一个线程中启动一个新的跨度
接口的
方法是您要查找的方法
重要
创建这样一个跨度后
记得关闭它
否则
您将在您的日志中看到很多警告
其中有一个事实
即您在当前线程中存在一个跨度
而不是您要关闭的线程
更糟糕的是
您的
不会正确关闭
因此不会收集到
命名
选择一个跨度名称不是一件小事
名称应该描述一个操作名称
名称应该是低基数
例如不包括标识符
由于有很多仪器仪表在一些跨度名称将是人为的
当控制器以方法名
接收时
通过包装
和
完成异步操作
注释方法将返回类的简单名称
幸运的是
对于异步处理
您可以提供明确的命名
注释
您可以通过
注释显式指定该跨度
在这种情况下
以下列方式处理时
该范围将被命名为
方法
为
或
创建单独的课程很少见
通常
创建这些类的匿名实例
如果没有
注释
我们将检查该类是否具有
方法的自定义实现
所以执行这样的代码
将导致创建一个名为
的跨度
管理
注释
合理
这个功能的主要论据是
意味着与跨度进行合作
使用注释允许用户添加到跨度
没有库依赖的跨度
这允许
将其核心
的影响改变为对用户代码的影响较小
减少基础跨度作业的表面积
没有这个功能
必须使用
它具有不正确使用的生命周期命令
通过仅显示范围
标签和日志功能
用户可以协作
而不会意外中断跨度生命周期
与运行时生成的代码协作
使用诸如
的库
在运行时生成接口的实现
从而跨越对象的包装是乏味的
现在
您可以通过这些接口的接口和参数提供注释
创建新的
如果您真的不想手动创建本地
您可以从
注释中获利
此外
我们还提供
注释
以自动方式添加标签
我们来看一些使用的例子
注释没有任何参数的方法将导致创建名称将等于注释方法名称的新跨度
如果您在注释中提供值
直接或通过
参数
则创建的范围将具有提供的值的名称
您可以组合名称和标签
我们来关注后者
在这种情况下
无论注释方法的参数运行时值的值如何
这将是标记的值
在我们的示例中
标签密钥将为
标签值为
您可以将
注释放在类和接口上
如果覆盖接口的方法并提供不同的
注释值
则最具体的一个获胜
在这种情况下
将被设置
继续
如果您只想添加标签和注释到现有的跨度
就可以使用如下所示的
注释
请注意
与
注释相反
您还可以通过
参数添加日志
这样
跨越将继续下去
将创建名称为
和
的日志
如果抛出异常
也将创建一个日志
将创建密钥
和值
的标签
更高级的标签设置
有三种不同的方法可以将标签添加到跨度
所有这些都由
注释控制
优先级是
尝试使用
类型的
并提供名称
如果没有提供
名称
请尝试评估一个表达式
我们正在搜索一个
默认实现使用
表达式解析
如果没有提供任何表达式来评估只返回参数的
值
自定义提取器
以下方法的标签值将由
接口的实现来计算
其类名必须作为
属性的值传递
有这样一个注释的方法
和这样一个
实现
将导致标签值的设置等于
解决表达式的价值
有这样一个注释的方法
并且没有自定义的
实现将导致对
表达式的评估
并且将在
上设置值为
的标签
如果要使用其他表达式解析机制
您可以创建自己的
实现
使用
方法
有这样一个注释的方法
如果使用值为
执行
则将导致设置
值为
的标记
自定义
感谢
和
您可以自定义
的创建和传播方式
目前有两种在进程之间传递跟踪信息的内置方式
通过
通过
从
兼容
头
或
头
中提取
以启动或加入现有跟踪
跟踪信息被注入到任何出站请求中
所以下一跳可以提取它们
与以前版本的
相比
重要的变化是
正在实施
的
概念
在
它被称为
基本上这个想法是通过
可以抽象出任何通信手段
例如消息
请求等
这个抽象定义了如何将数据插入到载体中以及如何从那里检索数据
感谢这样
如果您想要使用一个使用
作为发送
请求的平均值的新
库
那么您必须创建一个
的实现
它将调用委托给
检索和插入
标头
对于
有
个接口负责从
创建
这些是
您可以通过提供自己的实现来覆盖它们
对于
有
个接口负责从
创建
这些是
您可以通过提供自己的实现来覆盖它们
例
我们假设
而不是标准的
兼容的跟踪
头名称
这是
的一个例子
你可以这样注册
为了安全起见
不会将跟踪
跨度相关的标头添加到
响应
如果您需要标题
那么将标题注入
响应的自定义
并且可以使用以下方式添加一个使用此标签的
过滤器
你可以这样注册
中的自定义
标签
有时你想创建一个手动
将一个电话包裹到一个没有被检测的外部服务
您可以做的是创建一个带有
标签的跨度
其中包含要调用的服务的值
下面你可以看到一个调用
的例子
它被包装在这样一个跨度里
重要
记住不要添加
标签和
标签
您只需添加
自定义服务名称
默认情况下
假设当您将跨度发送到
时
您希望跨度的服务名称等于
值
这并不总是这样
在某些情况下
您希望为您应用程序中的所有
提供不同的服务名称
要实现这一点
只需将以下属性传递给应用程序即可覆盖该值
服务名称的示例
主机定位器
为了定义与特定跨度对应的主机
我们需要解析主机名和端口
默认方法是从服务器属性中获取它
如果由于某些原因没有设置
那么我们正在尝试从网络接口检索主机名
如果您启用了发现客户端
并且更愿意从服务注册表中注册的实例检索主机地址
那么您必须设置属性
适用于基于
和
的跨度报告
作为消息
您可以通过将
作为依赖关系来累加并发送跨越
的数据
并为
或
添加通道
实现
例如
为
通过将
作为依赖关系
并添加
或
的
通道
来实现
的累积和发送范围数据
这将自动将您的应用程序转换为有效载荷类型为
的邮件的制作者
消费者
有一个特殊的便利注释
用于为
数据设置消息使用者
并将其推入
这个应用程序
将通过
例如
包含
来收听您提供的任何运输的
数据
和
的类似起始者
如果添加以下
依赖关系
然后
您将有一个
服务器
您的应用程序在端口
上承载
和
默认
是内存中的
适合演示
快速入门
对于更强大的解决方案
您可以将
和
添加到类路径中
并通过配置启用
例如
注意
还用
注释
因此该过程还将公开标准的
服务器端点
以通过
收集
并在
中进行查询
定制消费者
也可以使用
并绑定到
来轻松实现自定义消费者
例
注意
上面的示例消费者应用程序明确排除
因此它不会向其自己发送消息
但这是可选的
您可能实际上想要将消息跟踪到消费者应用程序中
为了自定义轮询机制
您可以创建名称等于
的
类型的
在这里可以找到这样一个配置的例子
度量
目前
注册了与
相关的简单指标
它使用
的指标支持
来计算接受和删除的数量
每次发送到
时
接受的
的数量将增加
如果出现错误
那么删除的数字
将会增加
集成
可运行和可调用
如果你在
或
中包含你的逻辑
就可以将这些类包装在他们的
代表中
的示例
的示例
这样
您将确保为每次执行创建并关闭新的
自定义并发策略
我们正在注册
将所有
实例包装到他们的
代表
中的定制
该策略是启动或继续跨越
这取决于调用
命令之前跟踪是否已经进行的事实
要禁用自定义
并发策略
将
设置为
手动命令设置
假设您有以下
为了传递跟踪信息
您必须在
的
的
版本中包装相同的逻辑
我们正在注册
将所有
实例包装到他们的
代表
中的定制
钩子起动或继续一个跨度取决于跟踪在
被安排之前是否已经进行的事实
要禁用自定义
将
设置为
您可以定义线程名称的正则表达式列表
您不希望创建一个
只需在
属性中提供逗号分隔的正则表达式列表
集成
可以通过提供值等于
的
属性来禁用此部分的功能
过滤器
通过
所有采样的进入请求导致创建
的名称是
发送请求的路径
例如
如果请求已发送到
则该名称将为
您可以通过
属性配置要跳过的
如果您在类路径上有
则其值
将附加到提供的跳过模式
的
由于我们希望跨度名称是精确的
我们使用的
包装现有的
或直接添加到现有的
列表中
向给定的
添加了一个特殊请求属性
如果
没有看到此属性集
它将创建一个
后备
跨度
这是在服务器端创建的一个额外的跨度
以便在
中正确显示跟踪
看到最有可能意味着有一个缺失的仪器
在这种情况下
请在
中提出问题
异步
支持
如果您的控制器返回
或
将继续现有的跨度
而不是创建一个新的跨度
客户端集成
同步休息模板
我们注入一个
拦截器
确保所有跟踪信息都传递给请求
每次呼叫都会创建一个新的
收到回应后关闭
为了阻止将
设置为
的同步
功能
重要
你必须注册
作为一个
以便拦截器被注入
如果您使用
关键字创建
实例
那么该工具将不工作
异步休息模板
重要
一个
的跟踪版本是为您开箱即用的
如果你有自己的
你必须用
表示来包装它
最好的解决方案是只定制
和
或
如果您有自己的
并且您不要包装您的电话将不会被追踪
定制仪器设置为在发送和接收请求时创建和关闭跨度
您可以通过注册您的
来自定义
和
记住使用跟踪兼容的实现
例如
不要忘记在
中包装
自定义请求工厂示例
将
功能集
阻止为
禁用
设置
设置为
如果您不想将所有
的
创建为
默认情况下
通过
提供与
的集成
您可以通过将
设置为
来完全禁用它
如果这样做
那么不会发生
相关的仪器
仪器的一部分是通过
完成的
您可以通过提供
等于
来禁用它
如果你这样设置
那么
不会调整你的任何自定义
组件
然而
所有默认的工具仍然存在
异步通信
注释方法
在
中
我们正在调用异步相关组件
以便跟踪信息在线程之间传递
您可以通过将
的值设置为
来禁用此行为
如果您使用
注释方法
那么我们将自动创建一个具有以下特征的新的
名称将是注释方法名称
将被该方法的类名称和方法名称标记
注释方法
在
中
我们正在调试计划的方法执行
以便跟踪信息在线程之间传递
您可以通过将
的值设置为
来禁用此行为
如果您使用
注释方法
那么我们将自动创建一个具有以下特征的新的
名称将是注释方法名称
将被该方法的类名称和方法名称标记
如果要跳过某些
注释类的
创建
您可以使用与
注释类的完全限定名称匹配的正则表达式来设置
小费
如果您一起使用
和
将为每个
指标创建
并发送到
这可能是恼人的
您可以设置
和
我们提供
和
每次提交
调用或调度新任务时
这些实现都将创建
在这里
您可以看到使用
使用
传递跟踪信息的示例
消息
与
集成
它创建
发布和订阅事件
要禁用
检测
请将
设置为
您可以提供
模式
以明确提供要包括的用于跟踪的通道的名称
默认情况下
所有通道都包含在内
重要
当使用
构建
时
请记住使用
的
未跟踪
版本
用
装饰
执行者频道将导致
被关闭
我们正在注册
过滤器来传播跟踪信息
请求标头丰富了跟踪数据
要禁用
支持
请将
属性设置为
运行示例
您可以在
中找到部署的运行示例
在以下链接中查看它们
表示样品中的应用程序到顶部
为啤酒厂在
其
代码
该项目通过自动配置并绑定到
环境和其他
编程模型成语
为
应用程序提供
集成
通过几个简单的注释
您可以快速启用和配置应用程序中的常见模式
并使用基于
的组件构建大型分布式系统
提供的模式包括服务发现
控制总线和配置
智能路由
和客户端负载平衡
断路器
通过与
的集成提供
安装
请参阅
安装文档
获取有关如何安装
指令
所有
应用程序必须可以使用
客户端
默认情况下
代理客户端预计位于
有关如何启动代理客户端以及如何连接到
服务器集群的详细信息
请参阅
代理文档
对于开发
安装领事后
您可以使用以下命令启动
这将启动端口
上的服务器模式的代理
其中
可以在
上找到
服务发现与
服务发现是基于微服务架构的关键原则之一
尝试配置每个客户端或某种形式的约定可能非常困难
可以非常脆弱
通过
和
提供服务发现服务
利用
进行服务注册和发现
这不会阻止非
应用程序利用
界面
代理服务器在通过
八卦协议进行通信
的
集群
中运行
并使用
协议协议
如何激活
要激活
服务发现
请使用组
和
的启动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
注册
当客户端注册
时
它提供有关自身的元数据
如主机和端口
名称和标签
默认情况下会创建一个
检查
每隔
秒
命中
端点
如果健康检查失败
则服务实例被标记为关键
示例
客户端
即完全正常的
应用程序
如果
客户端位于
以外的位置
则需要配置来定位客户端
例
警告
如果您使用
上述值将需要放在
而不是
中
来自
的默认服务名称
实例
和端口分别为
上下文
和
将应用程序设为
服务
即注册自己
和
客户端
即可以查询
查找其他服务
健康检查
实例的运行状况检查默认为
这是
执行器应用程序中有用端点的默认位置
如果您使用非默认上下文路径或
路径
例如
或管理端点路径
例如
则需要更改这些
即使是执行器应用程序
也可以配置
用于检查运行状况端点的间隔
和
分别表示
秒和
分钟
例
元数据和
标签
尚未支持服务元数据
的
有一个
字段
使用
标签来近似元数据
直到
正式支持元数据
使用
形式的标签将被分割并分别用作
键和值
标签没有相同的
符号
将被用作键和值两者
上述配置将导致具有
和
的映射
使
实例
唯一
默认情况下
一个领事实体注册了一个等于其
应用程序上下文
的
默认情况下
应用程序上下文
为
在大多数情况下
这将允许一个服务的多个实例在一台机器上运行
如果需要进一步的唯一性
使用
您可以通过在
中提供唯一的标识来覆盖此
例如
使用这个元数据和在
上部署的多个服务实例
随机值将在那里进行
以使实例是唯一的
在
中
将在
应用程序中自动填充
因此不需要随机值
使用
支持
客户端构建器
使用逻辑服务名称而不是物理
您还可以使用
它为
不特定的发现客户端提供了一个简单的
例如
具有
的分布式配置
提供了一个用于存储配置和其他元数据的
键
值存储
是
和
的替代方案
在特殊的
引导
阶段
配置被加载到
环境中
默认情况下
配置存储在
文件夹中
基于应用程序的名称和模拟解析属性的
顺序的活动配置文件创建多个
实例
例如
名为
的应用程序和
配置文件将创建以下属性源
最具体的物业来源位于顶部
底部最不具体
是
文件夹适用于使用
进行配置的所有应用程序
文件夹中的
仅适用于名为
的服务实例
配置当前在应用程序启动时被读取
发送
到
将导致配置被重新加载
观看关键价值商店
支持
目前不可能
但将来将是此项目的补充
如何激活
要开始使用
配置
请使用组
和
的启动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
这将启用自动配置
将设置
配置
定制
可以使用以下属性定制配置
将此值设置为
禁用
配置
设置配置值的基本文件夹
设置所有应用程序使用的文件夹名称
设置用于使用配置文件在属性源中分隔配置文件名称的分隔符的值
配置观察
配置观察功能可以利用领事
看守钥匙前缀
的能力
会阻止
调用
以确定当前应用程序是否有任何相关配置数据发生更改
如果有新的配置数据
则会发布刷新事件
这相当于调用
执行器端点
要更改
调用的频率
默认值为
以毫秒为单位
禁用配置观察集
或
配置
与单个键
值对相反
可以更方便地将
或
格式的属性块存储起来
将
属性设置为
或
例如使用
必须在合适的
键中设置
使用键上面的默认值将如下所示
您可以将
文档存储在上述任何键中
您可以使用
更改数据密钥
与配置
是一个
社区项目
将文件从
存储库加载到各个密钥到
默认情况下
密钥的名称是文件的名称
和
文件分别支持
和
的文件扩展名
将
属性设置为
例如
给定
中的以下密钥
配置文件和应用程序名称为
将创建以下属性来源
每个键的值需要是一个格式正确的
或
文件
快速失败
在某些情况下
如本地开发或某些测试场景
可能会方便
如果不能配置领事
则不会失败
在
中设置
将导致配置模块记录一个警告而不是抛出异常
这将允许应用程序继续正常启动
重试
如果您希望您的应用程序启动时可能偶尔无法使用代理商
则可以要求您在发生故障后继续尝试
您需要在您的类路径中添加
和
默认行为是重试
次
初始退避间隔为
指数乘数为
用于后续退避
您可以使用
配置属性配置这些属性
和其他
这适用于
配置和发现注册
小费
要完全控制重试
请使用
为
添加
类型的
重试有一个
可以轻松创建一个
与
如何激活
要开始使用
总线
使用组
和工件
的起动器
有关使用当前的
发布列表设置构建系统的详细信息
请参阅
项目页面
有关可用的执行机构端点以及如何发送自定义消息
请参阅
文档
断路器与
应用程序可以使用
项目提供的
断路器将这个启动器包含在项目
中
不依赖于
注释应放置在配置类
通常是主类
上
那么方法可以用
注释来被断路器保护
有关详细信息
请参阅
文档
使用
和
指标聚合
由
项目提供
聚合多个实例
指标流
因此仪表板可以显示聚合视图
使用
接口查找相关实例
要将
与
结合使用
请按以下示例配置
应用程序
的
请注意
依赖不是起始者
涡轮启动器包括对
的支持
和
部分必须匹配
因此将逗号分隔的服务标识列表放在单独的配置属性中是有用的
的
该项目通过自动配置并绑定到
环境和其他
编程模型成语
为
应用程序提供
集成
通过几个简单的注释
您可以快速启用和配置应用程序中的常见模式
并使用基于
的组件构建大型分布式系统
提供的模式包括服务发现和配置
智能路由
和客户端负载平衡
断路器
通过与
的集成提供
安装
请参阅
安装文档
获取有关如何安装
指令
服务发现与
服务发现是基于微服务架构的关键原则之一
尝试配置每个客户端或某种形式的约定可能非常困难
可以非常脆弱
策展人
一个用于
的
库
通过
服务发现扩展
提供服务发现服务
利用此扩展功能进行服务注册和发现
如何激活
包括对
的依赖将启用将设置
发现的自动配置
注意
您仍然需要包含
的网页功能
注册
当客户端注册
时
它提供有关自身的元数据
如主机和端口
和名称
示例
客户端
即完全正常的
应用程序
如果
位于
以外的地方
则需要配置来定位服务器
例
警告
如果您使用
配置
上述值将需要放置在
而不是
中
来自
的默认服务名称
实例
和端口分别为
上下文
和
将应用程序同时进入
服务
即注册自己
和
客户端
即可以查询
查找其他服务
使用
支持
客户端构建器
还支持
使用逻辑服务名称而不是物理
您还可以使用
它为
不具体的发现客户端提供简单的
例如
使用
与
组件
提供有用的工具
无论使用哪种
实现
和
均与
合作
与
提供
的
的实现
当使用
时
默认情况下自动配置为使用
和服务注册表
实现
接口
允许开发人员以编程方式注册任意服务
类提供
方法来创建可以由
使用的
对象
实例状态
支持在服务器上注册的实例是
而不是作为活动服务实例返回
这对于诸如蓝色
绿色部署之类的行为非常有用
策展人服务发现配方不支持此行为
利用灵活的有效载荷
让
通过更新一些特定的元数据
然后对
中的元数据进行过滤来实现
过滤出不等于
的所有非空实例状态
如果实例状态字段为空
则向后兼容性被认为是
将实例
的状态更改为
实例状态执行器端点
依赖关系
使用
依赖关系
可以让您提供应用程序的依赖关系作为属性
作为依赖关系
您可以了解
中注册的其他应用程序
您可以通过
客户端构建器
以及
呼叫
您还可以从
依赖关系观察者功能中受益
这些功能可让您控制和监视依赖关系的状态
并决定如何处理
如何激活
依赖关系
包括对
的依赖将启用将自动配置
依赖关系的自动配置
如果您必须正确设置
部分
请查看后续部分以获取更多详细信息
然后该功能处于活动状态
即使您在属性中提供依赖关系
也可以关闭依赖关系
只需将属性
设置为
默认为
设置
依赖关系
我们来仔细看一下依赖关系表示的例子
现在让我们一个接一个地遍历依赖的每个部分
根属性名称为
别名
在根属性下面
由于
的限制
必须通过别名来表示每个依赖关系
应用程序
必须放在
中
因此您不能传递任何复杂的路径
如
别名将是您将使用的名称
而不是
或
的
在上述例子中
别名是
和
使用
的
使用示例为
路径
代表
属性
是根据
注册依赖关系的路径
像
之前提交的
因此这个路径不符合其要求
这就是为什么
将别名映射到正确的路径
负载平衡器类型
代表
属性
如果您知道在调用此特定依赖关系时必须应用什么样的负载平衡策略
那么您可以在
文件中提供它
并将自动应用
您可以选择以下负载平衡策略之一
一旦选择了该实例将始终被调用
随机
随机选择一个实例
一遍又一遍地迭代实例
模板和版本
代表
和
属性
如果您通过
标题版本您的
那么您不想将此标头添加到您的每个请求中
另外如果你想调用一个新版本的
你不想漫游你的代码
以增加
版本
这就是为什么您可以提供
特殊
占位符的原因
该占位符将由
属性的值填充
我们来看一个例子
拥有以下
和以下
将导致为每个请求设置
标题
默认标题
由
代表
映射
有时每次调用依赖关系都需要设置一些默认标头
为了不在代码中这样做
您可以在
文件中设置它们
拥有以下
部分
结果在您的
请求中添加适当的值列表的
和
标头
强制依赖
在
中由
属性表示
如果您的一个依赖关系在您的应用程序启动时需要启动并运行
则可以在
文件中设置
属性
如果您的应用程序无法在引导期间本地化所需的依赖关系
则会抛出异常
并且
上下文将无法设置
换句话说
如果
中没有注册所需的依赖关系
则您的应用程序将无法启动
您可以在以下部分阅读有关
存在检查器的更多信息
存根
您可以为包含依赖关系的存根的
提供冒号分隔路径
例
意味着对于特定的依赖关系可以在下面找到
分类器
这是默认值
这实际上等于
因为
是默认分类器
配置
依赖关系
有一些属性可以设置为启用
禁用
依赖关系功能的部分
如果您不设置此属性
则不会从
依赖关系中受益
默认情况下启用
需要显式的全局配置或特定的依赖关系
通过打开此属性
运行时负载平衡策略解决是可能的
您可以从
依赖关系的
部分获利
需要此属性的配置具有
的实现
委托给下一个子弹中的
默认情况下启用
感谢这个属性
自定义
知道传递给
的
部分实际上可能是必须被解析为
没有此属性
您将无法在嵌套路径下注册应用程序
默认情况下启用
此属性注册这样的一个
它会自动附加适当的头文件和内容类型
其中包含依赖关系配置中显示的版本
没有这两个参数的设置将不会运行
默认情况下启用
启用时将修改
注释的
的请求标头
以便它通过依赖关系配置中设置的版本的标题和内容类型
这两个参数的设置将无法运行
依赖关系观察者
依赖关系观察器机制允许您将侦听器注册到依赖关系中
功能实际上是
模式的实现
当依赖关系改变其状态
或
时
可以应用一些自定义逻辑
如何激活
依赖关系功能需要启用从依赖关系观察器机制中获利
注册听众
为了注册一个监听器
你必须实现一个接口
并将其注册为一个
该界面为您提供了一种方法
如果要为特定的依赖关系注册一个侦听器
那么
将是具体实现的鉴别器
将提供您的依赖关系是否已更改为
或
的信息
存在检查
绑定与依赖关系观察器是称为存在检查器的功能
它允许您在启动应用程序时提供自定义行为
以根据您的依赖关系的状态作出反应
抽象
类的默认实现是
它以以下方式工作
如果依赖关系标记为我们
并且不在
中
则在引导时
您的应用程序将抛出异
常并关闭
如果依赖关系不是
将在
级别上记录该应用程序
功能可以被覆盖
因为只有当没有
的
时才会注册
分布式配置与
提供了一个
分层命名空间
允许客户端存储任意数据
如配置数据
是
和
的替代方案
在特殊的
引导
阶段
配置被加载到
环境中
默认情况下
配置存储在
命名空间中
根据应用程序的名称和模拟解析属性的
顺序的活动配置文件
创建多个
实例
例如
名为
的应用程序和
配置文件将创建以下属性源
最具体的物业来源位于顶部
底部最不具体
是
命名空间适用于使用
进行配置的所有应用程序
命名空间中的
仅适用于名为
的服务实例
配置当前在应用程序启动时被读取
发送
到
将导致重新加载配置
观看配置命名空间
支持
目前尚未实现
但将来将会添加到此项目中
如何激活
包括对
的依赖将启用将配置
配置的自动配置
定制
可以使用以下属性自定义配置
将此值设置为
将禁用
配置
设置配置值的基本命名空间
设置所有应用程序使用的名称
设置用于使用配置文件在属性源中分隔配置文件名称的分隔符的值
中的未解决的指令
提供了一组用于构建安全应用程序和服务的原语
最小化
可以从外部
或集中
高度配置的声明式模型适用于通常使用中央契约管理服务的大型合作远程组件系统的实现
在像
这样的服务平台上也很容易使用
基于
和
安全性
我们可以快速创建实现常见模式的系统
如单点登录
令牌中继和令牌交换
注意
根据非限制性
许可证发布
如果您想为文档的这一部分做出贡献
或者发现错误
请在
中找到项目中的源代码和问题跟踪器
快速开始
单一登录
这是一个具有
基本身份验证和单个用户帐户的
应用程序
您可以使用
运行它
并观察日志的密码
用户名为
用户
到目前为止
这只是一个
应用程序的默认设置
这是一个使用
的
应用程序
指出不同
这个应用程序的行为实际上与之前的一样
因为它不知道它是
的信誉
您可以很容易地在
注册一个应用程序
所以如果你想要一个生产应用程序在你自己的域上尝试
如果您很乐意在
上测试
那么请在应用程序配置中设置这些属性
运行上面的应用程序
它将重定向到
进行授权
如果您已经登录
您甚至不会注意到它已经通过身份验证
只有您的应用程序在
端口上运行
这些凭据才会起作用
要限制客户端在获取访问令牌时要求的范围
您可以设置
逗号分隔或
中的数组
默认情况下
作用域为空
由授权服务器确定默认值是什么
通常取决于客户端注册中的设置
注意
上面的例子都是
脚本
如果要在
或
中编写相同的代码
则需要将
添加到类路径中
例如
请参阅
此处
的
示例
受保护资源
您要使用
令牌保护
资源
这是一个简单的例子
与上面的客户端配对
和
更多详情
单点登录
注意
所有
和资源服务器功能在版本
中移动到
您可以在
用户指南
中找到文档
令牌中继
令牌中继是
消费者充当客户端
并将传入令牌转发到外发资源请求
消费者可以是纯客户端
如
应用程序
或资源服务器
客户端令牌中继
如果您的应用是面向
客户端的用户
即声明为
或
那么它的请求范围为
的
您可以从此上下文和自动连线
创建自己的
然后上下文将始终向下转发访问令牌
如果过期则自动刷新访问令牌
这些是
安全和
的功能
注意
如果您使用
令牌
则
不会自动创建
在这种情况下
您需要创建自己的
并使用
进行配置
客户端令牌中继在
代理
如果您的应用程式还有
嵌入式反向代理
使用
那么您可以要求将
访问令牌转发到其正在代理的服务
因此
上述的
应用程序可以简单地增强
并且
除了将用户登录并抓取令牌之外
将下载的身份验证令牌传递到
服务
如果这些服务是用
实现的
那么他们将在正确的标题中获得一个有效的标记
它是如何工作的
注释引入
您可以在传统应用程序中手动执行
而这又会触发一个
的自动配置
该属性本身被激活
因为
在
通过
该
过滤器
仅从当前已认证的用户提取访问令牌
并将其放入下游请求的请求头中
资源服务器令牌中继
如果您的应用有
您可能希望将传入令牌下载到其他服务
如果您使用
联系下游服务
那么这只是如何使用正确的上下文创建模板的问题
如果您的服务使用
验证传入令牌
即正在使用
配置
则可以使用自动连线
创建
将由身份验证过程之前它遇到后端代码
相等
使用
您可以在配置中注入
并抓取其中的
例如
然后
此休息模板将具有由身份验证过滤器使用的
请求作用域
相同
因此您可以使用它来发送具有相同访问令牌的请求
如果您的应用没有使用
但仍然是客户端
即声明
或
则使用
安全云任何
用户从
也会转发令牌
此功能默认实现为
处理程序拦截器
因此它仅适用于
如果您不使用
可以使用包含
的自定义过滤器或
拦截器来提供相同的功能
以下是一个基本示例
显示了使用其他地方创建的自动连线休息模板
是一个资源服务器
接受与周围应用程序相同的令牌
如果您不想转发令牌
这是一个有效的选择
因为您可能希望以自己的身份而不是向您发送令牌的客户端
那么您只需要创建自己的
的自动装配默认值
客户端也会选择使用
的拦截器
如果它是可用的
那么他们还应该在
将要执行的令牌中继
配置
代理下游的认证
您可以通过
设置控制
下游的授权行为
例
在此示例中
客户
服务获取
令牌中继
存储
服务获取传递
授权头只是通过下游
建议
服务已删除其授权头
如果有令牌可用
则默认行为是执行令牌中继
否则为
有关详细信息
请参阅
为
的
可以轻松地在
平台即服务
中运行
应用程序
有一个
服务
的概念
它是
绑定
到应用程序的中间件
本质上为其提供包含凭据的环境变量
例如
用于服务的位置和用户名
项目为
中的
的一些增强功能提供基本支持
自动绑定到单点登录服务
并可选择启用粘性路由进行发现
项目提供
的实施
因此您可以
并将您的凭据提供为
然后直接或通过
使用
如果您没有连接到
则也为
第一次使用它时
发现客户端可能很慢
因为它必须从
获取访问令牌
发现
以下是
发现的
应用程序
如果您运行它没有任何服务绑定
它将在主页中显示其应用程序名称
可以根据身份验证的凭据列出空间中的所有应用程序
其中的空间默认为客户端运行的空间
如果有的话
如果组织和空间都不配置
则它们将根据
中的用户配置文件进行默认
单点登录
注意
所有
和资源服务器功能在版本
中移动到
您可以在
用户指南
中找到文档
该项目提供从
服务凭据到
功能的自动绑定
如果您有一个称为
的
服务
例如
使用包含
和
的凭据
它将自动绑定到您使用
启用的
客户端来自
可以使用
对服务的名称进行参数化
文献作者
ü
ö
ń
ł
您始终需要的是将新功能推向分布式系统中的新应用程序或服务的信心
该项目为
应用程序中的消费者驱动
和服务架构提供支持
涵盖了一系列用于编写测试的选项
将其作为资产发布
声称生产者和消费者保留合同用于
和消息的交互
模块让您有可能使用
使用嵌入在
应用的
环境
服务器不同的服务器
查看
样品
了解更多详情
重要
发布列表
导入
这反过来又排除了
所需的依赖关系
这可能导致一种情况
即使你不使用
那么你的依赖将会受到影响
如果您有一个使用
作为嵌入式服务器的
应用程序
默认为
那么您可以简单地将
添加到类路径中并添加
以便可以在测试中使用
作为存根服务器运行
您可以使用
或通过静态
声明来注册存根行为
作为测试的一部分
这是一个简单的例子
要使用
例如
启动不同端口上的存根服务器
并且对于随机端口使用值
存根服务器端口将在测试应用程序上下文中绑定为
使用
将一个类型为
的
添加到测试应用程序上下文中
它将被缓存在具有相同上下文的方法和类之间
就像一般的
集成测试一样
自动注册存根
如果您使用
则它将从文件系统或类路径注册
存根
默认情况下为
您可以使用注释中的
属性自定义位置
这可以是资源模式
或目录
在这种情况下
附加
例
注意
实际上
总是从
中
加载映射
以及
属性
中
的自定义位置
要更改此行为
您还必须如下所述指定文件根
使用文件指定存根体
可以从类路径或文件系统上的文件读取响应体
在这种情况下
您将在
中看到响应具有
而不是
文字
默认情况下
相对于根目录
解析文件
要自定义此位置
您可以将
注释中的
属性设置为父目录的位置
即
位置
是子目录
您可以使用
资源符号来引用
或
位置
但不支持通用
可以给出值列表
并且
将在需要查找响应体时解析存在的第一个文件
注意
当配置
根时
它会影响自动加载存根
它们来自称为
映射
的子目录中的根位置
的值对从
属性明确加载的存根没有影响
替代方法
使用
规则
对于更常规的
体验
使用
启动和停止服务器
只需使用
便利类来获取
实例
使用
表示服务器将在此类中的所有方法后关闭
和
模拟器
提供了一个方便的类
可以将
存根加载到
中
以下是一个例子
前面是所有模拟调用
方法将一个存根路径资源模式作为参数
所以在这个例子中
定义的存根被加载到模拟服务器中
所以如果
被要求访问
那么它将得到所声明的响应
可以指定多个存根模式
每个可以是一个目录
对于所有
的递归列表
或一个固定的文件名
如上例所示
或一个蚂蚁样式模式
格式是通常的
格式
您可以在
网站上阅读
目前
我们支持
和
作为
嵌入式服务器
而
本身对特定版本的
目前为
具有
本机
支持
要使用本地
您需要添加本机线程依赖关系
并排除
容器
如果有的话
使用
生成存根
可用于为具有
或
的
生成文档
例如
格式
在生成
文档的同时
还可以使用
生成
存根
只需编写正常的
测试用例
并使用
在
输出目录中自动存储存根
例如
从此测试将在
上生成一个
存根
它将所有
请求与
路径相匹配
没有任何其他配置
这将创建一个存根与
方法的请求匹配器和除
主机
和
内容长度
之外的所有头
为了更准确地匹配请求
例如要匹配
或
的正文
我们需要明确创建一个请求匹配器
这将做两件事情
创建一个只匹配您指定的方式的存根
断言测试用例中的请求也匹配相同的条件
主要的入口点是
可以替代
便利方法
例如
所以这个合同是说
任何有效的
与
字段将得到与本测试相同的响应
您可以将来电链接到
以添加其他匹配器
如果您不
熟悉
文档
可以帮助您加快
路径的速度
您也可以使用
来验证请求是否与创建的存根匹配
而不是使用
和
方法
例
是丰富的
您可以通过正则表达式以及
路径来匹配头文件
查询参数和请求正文
因此这可以用于创建具有更广泛参数的存根
上面的例子会生成一个这样的
后
注意
您可以使用
方法或
和
方法创建请求匹配器
但不能同时使用两者
在消费方面
假设上面生成的
可以在类路径中使用
您可以使用
以多种不同的方式创建一个存根
其中包括上述使用
的描述
使用
生成
可以使用
生成的另一件事是
文件和文档
如果您将其与
相结合
那么您将获得合同和存根
小费
您可能会想知道为什么该功能在
模块中
来想一想
它确实有道理
因为只生成合同并且不生成存根就没有意义
这就是为什么我们建议做这两个
我们来想象下面的测试
这将导致在上一节中介绍的存根的创建
合同将被生成和文档文件
合同将被称为
看起来更像是这样
生成的文档
的示例
将包含格式化的合同
此文件的位置将为
验证者
介绍
重要
版中已弃用的
项目的文档可在此处获取
小费
项目最初是由
和
只是为了简短说明
验证程序是一种能够启用消费者驱动合同
开发基于
的应用程序的工具
它与
合同定义语言
一起提供
合同定义用于生成以下资源
在客户端代码
客户端测试
上进行集成测试时
将使用
存根定义
测试代码仍然需要手动编写
测试数据由
验证器生成
消息传递路由
如果你使用一个
我们正在与
和
进行整合
然而
您可以设置自己的集成
如果你想
验收测试
在
或
中
用于验证
的服务器端实现是否符合合同
服务器测试
完全测试由
验证器生成
验证者将
移动到软件体系结构的层次
视频
您可以查看华沙
关于
的视频
点击此处查看视频
为什么
让我们假设我们有一个由多个微服务组成的系统
测试问题
如果我们想测试应用程序在左上角
如果它可以与其他服务通信
那么我们可以做两件事之一
部署所有微服务器并执行端到端测试
模拟其他微型服务单元
集成测试
两者都有其优点
但也有很多缺点
我们来关注后者
部署所有微服务器并执行端到端测试
优点
模拟生产
测试服务之间的真实沟通
缺点
要测试一个微服务器
我们将不得不部署
个微服务器
几个数据库等
将进行测试的环境将被锁定用于一套测试
即没有人能够在此期间运行测试
长跑
非常迟的反馈
非常难调试
模拟其他微型服务单元
集成测试
优点
非常快的反馈
没有基础架构要求
缺点
服务的实现者创建存根
因此它们可能与现实无关
您可以通过测试和生产不合格进行生产
为了解决上述问题
的验证器被创建
他们的主要思想是给你非常快的反馈
而不需要建立整个微服务的世界
如果您在存根上工作
那么您需要的唯一应用是应用程序直接使用的应用程序
验证者确定您使用的存根是由您正在调用的服务创建的
此外
如果您可以使用它们
这意味着它们是针对生产者的一方进行测试的
换句话说
你可以信任这些存根
目的
验证器与
的主要目的是
确保
存根
在开发客户端时使用
正在完全实际执行服务器端实现
推广
方法和微服务架构风格
提供一种发布双方立即可见的合同变更的方法
生成服务器端使用的样板测试代码
重要
验证者的目的不是开始在合同中编写业务功能
我们假设我们有一个欺诈检查的商业用例
如果一个用户因为
个不同的原因而被欺骗
我们假设你会创建
个合同
一个为正面
一个为负面欺诈案
合同测试用于测试应用程序之间的合同
而不是模拟完整行为
客户端
在测试期间
您希望启动并运行一个模拟服务
的
实例
消息传递路由
您希望为该实例提供适当的存根定义
该存根定义将需要有效
并且也应在服务器端可重用
总结
在这方面
在存根定义中
您可以使用模式进行请求存根
并需要确切的响应值
服务器端
作为开发您的存根的服务
您需要确保它实际上类似于您的具体实现
您不能以某种方式存在您的存根行为
并且您的生产应用程序以不同的方式运行
这就是为什么会生成提供的存根验收测试
这将确保您的应用程序的行为与您在存根中定义的相同
总结
在这方面
在存根定义中
您需要精确的值作为请求
并可以使用模式
方法进行响应验证
逐步向
指导
举一个欺诈检测和贷款发行流程的例子
业务情景是这样的
我们想向人们发放贷款
但不希望他们从我们那里偷钱
目前我们的系统实施给大家贷款
假设
是
服务器的客户端
在目前的冲刺中
我们需要开发一个新的功能
如果客户想要借到太多的钱
那么我们将他们标记为欺诈
技术说明
欺诈检测将具有工件
贷款发行
两者都具有组
社会声明
客户端和服务器开发团队都需要直接沟通
并在整个过程中讨论变更
是关于沟通的
在
服务器端代码可以在这里
和
这里的客户端代码
小费
在这种情况下
合同的所有权在生产者方面
这意味着物理上所有的合同都存在于生产者存储库中
技术说明
如果使用
里程碑
版本候选
版本
请将以下部分添加到您的
的
摇篮
消费方
贷款发行
作为贷款发行服务
欺诈检测服务器的消费者
的开发人员
通过对您的功能进行测试开始做
我们刚刚写了一个关于我们新功能的测试
如果收到大额的贷款申请
我们应该拒绝有一些描述的贷款申请
写入缺少的实现
在某些时间点
您需要向欺诈检测服务发送请求
我们假设我们要发送包含客户端
和要从我们借款的金额的请求
我们想通过
方法将其发送到
网址
为了简单起见
我们已将
的欺诈检测服务端口硬编码
我们的应用程序正在
上运行
如果我们开始写测试
显然会因为端口
上没有运行而打断
在本地克隆欺诈检测服务存储库
我们将开始玩服务器端的合同
这就是为什么我们需要先克隆它
在欺诈检测服务的回购中本地定义合同
作为消费者
我们需要确定我们想要实现的目标
我们需要制定我们的期望
这就是为什么我们写下面的合同
重要
我们将合同放在
下
文件夹是重要的
因为我们将在生产者的测试基类中引用该文件夹
合同使用静态类型的
编写
你可能想知道这些
部分是什么
通过使用这种符号
您可以定义动态的
等的部分
在标识符或时间戳的情况下
您不想硬编码一个值
你想允许一些不同的值范围
这就是为什么对于消费者端
您可以设置与这些值匹配的正则表达式
您可以通过地图符号或带插值的
来提供身体
有关更多信息
请参阅文档
我们强烈推荐使用地图符号
小费
了解地图符号设置合同非常重要
请阅读有关
的
文档
上述合同是双方达成的协议
如果发送了
请求
端点
上的方法
与
的正则表达式
和
等于
的
体
并且标题
等于
那么
响应将被发送给消费者
状态为
包含
体
其中包含值为
的
字段和值为
的
字段
和一个值为
的
标头
一旦我们准备好在集成测试中实际检查
我们需要在本地安装存根
添加
验证程序插件
我们可以添加
或
插件
在这个例子中
我们将展示如何添加
首先我们需要添加
接下来
插件
自添加插件后
我们将从提供的合同中获得
功能
生成并运行测试
生产并安装存根
我们不想生成测试
因为我们作为消费者
只想玩短线
这就是为什么我们需要跳过测试生成和执行
当我们执行
在日志中
我们将看到如下
这条线是非常重要的
确认
的存根已安装在本地存储库中
运行集成测试
为了从自动存根下载的
功能中获利
您必须在我们的消费者端项目
中执行以下操作
添加
将依赖关系添加到
用
标注你的测试课程
在注释中
提供
下载协作者存根的组
和工件
离线工作开关还可以离线使用协作者
可选步骤
现在如果你运行测试你会看到这样的
这意味着
找到了您的存根
并为具有组
为
版本为
的存根和
分类器的端口
档案公关
我们到现在为止是一个迭代的过程
我们可以玩合同
安装在本地
在消费者身边工作
直到我们对合同感到满意
一旦我们对结果感到满意
测试通过将
发布到服务器端
目前消费者方面的工作已经完成
生产者方
欺诈检测服务器
作为欺诈检测服务器
贷款发行服务的服务器
的开发人员
初步实施
作为提醒
您可以看到初始实现
接管公关
您必须添加自动生成测试所需的依赖关系
在
插件的配置中
我们传递了
属性
重要
我们决定使用
约定
命名
方法是设置
属性
这意味着最后的两个包将被组合成基本测试类的名称
在我们这个例子中
这些合约是
由于我们没有从
文件夹开始有
个包
我们只挑选一个是
我们正在添加
后缀
我们正在大写
这给了我们
测试类名称
这是因为所有生成的测试都会扩展该类
在那里你可以设置你的
上下文或任何必要的
在我们的例子中
我们使用
来启动服务器端
现在
如果你运行
你会得到这样的
这是因为您有一个新的合同
从中生成测试
并且由于您尚未实现该功能而失败
自动生成测试将如下所示
您可以看到
块中存在的所有
部分合同注入测试
重要的是在生产者方面
我们也在做
我们有一个测试形式的期望
此测试正在向我们自己的应用程序拍摄一个在合同中定义的
标题和主体的请求
它也期待响应中非常精确地定义的值
换句话说
您是
和
的
部分
将
转换为
的时间
写入缺少的实现
现在
由于我们现在预期的输入和预期的输出是什么
我们来写这个缺少的实现
如果再次执行
测试将通过
由于
插件将测试添加到
您可以从
中实际运行这些测试
部署你的应用程序
完成工作后
现在是部署变更的时候了
首先合并分支
那么我们假设你的
将像
一样运行
它将发布应用程序和存根工件
消费方
贷款发行
最后一步
作为贷款发行服务
欺诈检测服务器的消费者
的开发人员
合并分支到主
在线工作
现在
您可以禁用
广告的离线工作
以提供存储库与存根的位置
此时
服务器端的存根将自动从
下载
您可以关闭注释中的
参数的值
在下面你可以看到一个通过改变属性实现相同的例子
就是这样
依赖
添加依赖关系的最佳方法是使用正确的
依赖关系
对于
使用
当您使用插件时
只需添加
附加链接
以下可以找到与
验证器和
相关的一些资源
注意
有些可以过时
因为
验证程序项目正在不断发展
阅读
来自
关于
的演讲
来自
的博客的
相关文章
来自
博客的
相关文章
关于
的文档
样品
在这里可以找到一些
样品
常问问题
为什么使用
验证器而不是
目前
验证器是基于
的工具
因此
当您已经为
创建软件时
可能是您的第一选择
这个项目有很多非常有趣的功能
但特别是其中一些绝对让
在消费者驱动合同
工具的
市场
上脱颖而出
许多最有趣的是
可以通过消息传递
清晰易用
静态
可以将当前的
文件粘贴到合同中
并且仅编辑其元素
从定义的合同自动生成测试
功能
存根在运行时自动从
下载
集成
集成测试不需要发现服务
这个值是
与存根相关的最大挑战之一是可重用性
只有如果他们能够被广泛使用
他们是否会服务于他们的目的
通常使得难点是请求
响应元素的硬编码值
例如日期或
想象下面的
请求
和
响应
想象一下
通过更改系统中的时钟或提供数据提供者的存根实现
设置
字段的正确值
我们假设这个内容是由数据库生成的
所需的痛苦
这同样涉及到称为
的字段
你会创建一个
发生器的
实现
没有意义
所以作为一个消费者
你想发送一个匹配任何形式的时间或任何
的请求
这样
您的系统将照常工作
将生成数据
您不必将任何东西存入
假设在上述
的情况下
最重要的部分是
字段
您可以专注于其他领域
并提供匹配
换句话说
你想要的存根是这样工作的
就响应作为消费者而言
您需要具有可操作性的具体价值
所以这样的
是有效的
从前面的部分可以看出
我们从合同中产生测试
所以从生产者的角度看
情况看起来差别很大
我们正在解析提供的合同
在测试中我们想向您的端点发送一个真正的请求
因此
对于请求的生产者来说
我们不能进行任何匹配
我们需要具体的价值观
使制片人的后台能够工作
这样的
将是一个有效的
另一方面
从合同的有效性的角度来看
响应不一定必须包含
或
的具体值
假设您在生产者方面产生这些
再次
您必须做很多桩
以确保始终返回相同的值
这就是为什么从生产者那边你可能想要的是以下回应
那么您如何才能为消费者提供一次匹配
并为生产者提供具体的价值
反之亦然
在
中
我们允许您提供
动态值
这意味着通信双方可能有所不同
你可以传递值
可以通过
方法
或使用
方法
您可以在
部分
阅读更多信息
调用
或
告诉
您将传递一个动态值
在
方法中
传递消费者端
在生成的存根
中应该使用的值
在
方法中
传递应在生产者端使用的值
在生成的测试中
小费
如果一方面你已经通过了正则表达式
而你没有通过另一方
那么对方就会自动生成
大多数情况下
您将使用该方法与
辅助方法
例如
总而言之
上述情景的合同看起来或多或少是这样的
正则表达式的时间和
被简化
很可能是无效的
但是我们希望在这个例子中保持很简单
重要
请阅读
与
相关
的
文档
以了解如何正确构建请求
响应实体
如何做
版本控制
版本控制
让我们尝试回答一个真正意义上的版本控制的问题
如果你指的是
版本
那么有不同的方法
使用超媒体
链接
不要通过任何方式版本您的
通过标题
网址传递版本
我不会试图回答一个方法更好的问题
无论适合您的需求
并允许您创造商业价值应被挑选
假设你做你的
版本
在这种情况下
您应该提供与您支持的许多版本一样多的合同
您可以为每个版本创建一个子文件夹
或将其附加到合同名称
无论如何适合您
版本控制
如果通过版本控制是指包含存根的
的版本
那么基本上有两种主要方法
假设您正在进行连续交付
部署
这意味着您每次通过管道生成新版本的
时
该
可以随时进行生产
例如你的
版本看起来像这样
它建立在
在
在这种情况下
您生成的存根
将看起来像这样
在这种情况下
您应该在
或
内引用存根提供最新版本的存根
您可以通过传递
号来做到这一点
例
如果版本控制是固定的
例如
或
则必须设置
版本的具体值
示例
开发者或生产者存根
您可以操作分类器
以针对其他服务的存根或部署到生产的存根的当前开发版本来运行测试
如果您在构建生产部署之后
使用
分类器来更改构建部署
那么您可以在一个案例中使用
运行测试
另一个则使用
进行测试
使用开发版存根的测试示例
使用生产版本的存根的测试示例
您也可以通过部署管道中的属性传递这些值
共同回购合同
存储合同以外的另一种方法是将它们保存在一个共同的地方
它可能与消费者无法克隆生产者代码的安全问题相关
另外
如果您在一个地方保留合约
那么作为生产者
您将知道有多少消费者
以及您的本地变更会消费哪些消费者
回购结构
假设我们有一个坐标为
和
个消费者的生产者
然后在具有常见合同的存储库中
您将具有以下设置
您可以
在此处查看
您可以看到下面的斜线分隔的
工件
文件夹
您对
个消费者
和
有期望
期望是本文档中描述的标准
合同文件
该存储库必须生成一个将一对一映射到回收内容的
文件
文件夹内的
示例
你可以看到除了
插件之外没有依赖关系
这些垃圾是消费者运行
来本地安装生产者项目的存根的必要条件
根文件夹中的
可以如下所示
它正在使用程序集插件来构建所有合同的
此类设置的示例如下
工作流程
工作流程将与
中提供的工作流程类似
唯一的区别是生产者不再拥有合同
所以消费者和生产者必须在共同的仓库中处理共同的合同
消费者
当
消费者
希望脱机工作
而不是克隆生产者代码时
消费者团队克隆了公用存储库
转到所需的生产者的文件夹
例如
并运行
在本地安装存根从合同转换
小费
您需要在
本地
安装
制片人
作为一个
生产者
足以改变
验证器来提供包含合同的
和依赖关系
使用此设置
将从
下载具有
和
的
然后将在本地临时文件夹中解压缩
并将
下的合同作为用于生成测试和存根的选择
由于这个惯例
生产者团队将会知道当一些不兼容的更改完成时
哪些消费者团队将被破坏
其余的流程看起来是一样的
我可以有多个基类进行测试吗
是
查看
或
插件的
合同
部分的
不同基类
如何调试生成的测试客户端发送的请求
响应
生成的测试都以某种形式或时尚的方式依赖于
进行
有一个名为
的工具
它将整个请求和响应记录到
有一个日志记录
通用应用程序属性
来做这种事情
只需将其添加到应用程序属性中即可
可以从响应中引用请求吗
是
使用版本
我们添加了这样一种可能性
在
存根服务器端
我们正在为
提供支持
在其他
服务器存根的情况下
您必须自己实现该方法
验证者
毕业项目
先决条件
为了在
中使用
验证器
您必须使用
或
插件
警告
如果您想在项目中使用
则必须单独添加
和
模块
检查
文档以获取更多信息
添加具有依赖关系的渐变插件
的快照版本
将其他快照存储库添加到您的
以使用快照版本
每次成功构建后都会自动上传
添加存根
默认情况下
验证器正在
目录中查找存根
包含存根定义的目录被视为一个类名称
每个存根定义被视为单个测试
我们假设它至少包含一个用作测试类名称的目录
如果有多个级别的嵌套目录
除了最后一个级别将被用作包名称
所以具有以下结构
验证程序将使用两种方法创建测试类
运行插件
插件注册自己在
任务之前被调用
只要您希望它成为构建过程的一部分
您就无所事事
如果您只想生成测试
请调用
任务
默认设置
默认的
插件设置创建了以下
部分的构建
它是一个伪代码
配置插件
要更改默认配置
只需在您的
配置中添加
代码段即可
配置选项
定义接受测试的模式
默认的基于
的
的
也可以将其更改为
或
显式
为真实的
调用
导入
应包含在生成的测试中的
导入的
数组
例如
默认为空数组
应该包含在生成的测试中的静态导入的数组
例如
默认为空数组
为所有生成的测试指定基础包
默认设置为
所有生成的测试的基类
如果使用
测试
默认为
而不是为基类提供固定值
您可以提供一个所有基类放置的包
优先于
明确地将合约包映射到基类的
优先于
和
指定应该添加到生成的测试类的规则
匹配器
允许定义要跳过哪些处理的存根文件
默认为空数组
包含使用
编写的合同的目录
默认
应该放置从
生成
测试的测试源目录
默认
应该放置从
生成的
存根的目录
要使用的目标测试框架
作为默认框架
目前支持
和
当您希望提供合同所在
的位置时
将使用以下属性
提供
坐标的依赖关系
您可以使用
关闭来设置它
如果下载合同部分将默认为
其中
将被分隔
否则将扫描提供的目录下的合同
为了不下载依赖关系
每次下载一次
然后离线工作
重用本地
所有测试的单一基类
在默认的
中使用
验证器时
您需要为所有生成的验收测试创建一个基本规范
在这个类中
您需要指向应验证的端点
在使用
模式的情况下
您可以像普通集成测试一样使用基类来初始化整个测试的应用程序
在
模式的情况下
这个基类也应该包含
字段
现在测试
的唯一选项是启动
服务器
不同的基础类别的合同
如果您的基类在合同之间不同
您可以告诉
插件哪个类应该由自动生成测试扩展
你有两个选择
遵循约定
提供
通过
提供显式映射
惯例
约定是这样的
如果你有合同
例如
并将
属性的值提供给
那么我们将假设
下有一个
类包
换句话说
如果它们存在并且形成具有
后缀的类
那么我们将使用最后两个包的部分
优先于
关闭中的使用示例
制图
您可以手动将合同包的正则表达式映射为匹配合同的基类的完全限定名称
我们来看看下面的例子
我们假设你有合同
通过提供
我们有一个后备案例
如果映射没有成功
您也可以提供
作为备用
这样
从
合同产生的测试将扩展
而其余的测试将扩展
调用生成的测试
为确保提供方对定义的合同进行投诉
您需要调用
消费者验证者
在消费者服务中
您需要以与提供商相同的方式配置
验证器插件
如果您不想使用
则需要复制存储在
中的合同
并使用以下命令生成
存根
请注意
必须为存根生成设置
选项才能正常工作
当存在时
存根可用于消费者自动测试
在
下面调用
服务
此请求由使用由
验证器生成的存根配置的
服务器处理
在您的
项目中使用
添加
插件
添加
接下来
插件
您可以在
插件文档
中阅读更多内容
的快照版本
对于快照
里程碑版本
您必须将以下部分添加到您的
添加存根
默认情况下
验证器正在
目录中查找存根
包含存根定义的目录被视为一个类名称
每个存根定义被视为单个测试
我们假设它至少包含一个用作测试类名称的目录
如果有多个级别的嵌套目录
除了最后一个级别将被用作包名称
所以具有以下结构
验证者将使用两种方法创建测试类
运行插件
插件目标
被分配为阶段
只要您希望它成为构建过程的一部分
您就无所事事
如果您只想生成测试
请调用
目标
配置插件
要更改默认配置
只需将
部分添加到插件定义或
定义
重要配置选项
定义接受测试的模式
默认
它基于
的
对于真正的
呼叫
它也可以更改为
或
为所有生成的测试指定基础包
默认设置为
指定应该添加到生成的测试类的规则
生成测试的基类
如果使用
测试
默认为
包含使用
编写的合同的目录
默认
要使用的目标测试框架
作为默认框架
目前支持
和
而不是为基类提供固定值
您可以提供一个所有基类放置的包
约定是这样的
如果你有合同
并提供这个属性的值到
那么我们将假设
包含
类
优先于
您必须提供
的基类映射列表
该列表根据合同所在的包进行检查
并且
映射到匹配合同的基类的完全限定名称
如果您有合同
并映射了属性
则从这些合同生成的测试类将扩展
优先于
和
如果要从
存储库中下载合同定义
可以使用
具有合同的工件的
的
如果没有提供
应使用当前的
包含所有打包合同的合同依赖关系
通过打包合同在
中具体合同的路径
默认为
其中
被斜杠分隔
如果依赖关系应该被下载
或者本地
只能被重用
有关完整信息
请参阅
插件文档
所有测试的单一基类
在默认的
中使用
验证器时
您需要为所有生成的验收测试创建一个基本规范
在这个类中
您需要指向应验证的端点
在使用
模式的情况下
您可以像常规集成测试一样使用基类来初始化整个测试的应用程序
在
模式的情况下
这个基类也应该包含
字段
现在测试
的唯一选项是启动
服务器
不同的基础类别的合同
如果您的基类在合同之间不同
您可以告诉
插件哪个类应该由自动生成测试扩展
你有两个选择
遵循约定
提供
通过
提供显式映射
惯例
约定是这样的
如果你有合同
例如
并将
属性的值提供给
那么我们将假设在
下有一个
类包
换句话说
如果它们存在并且形成具有
后缀的类
那么我们将使用最后两个包的部分
优先于
使用示例
制图
您可以手动将合同包的正则表达式映射为匹配合同的基类的完全限定名称
您必须提供
的
列表
到
映射
我们来看看下面的例子
我们假设你有合同
通过提供
我们有一个后备程序
如果映射没有成功
你也可以提供
作为备用
这样
从
合同生成的测试将扩展
而其余的测试将扩展
调用生成的测试
插件将验证码生成到目录
中
并将此目录附加到
目标
对于
代码使用
为了确保提供方对定义的合同进行投诉
您需要调用
插件常见问题
插件和
如果在使用
时看到以下异常
当您点击标记时
您应该看到这样的
为了解决这个问题
请在
中提供以下部分
消费者验证者
您实际上也可以为消费者使用
验证器
您可以使用插件
以便只转换合同并生成存根
要实现这一点
您需要以与提供程序相同的方式配置
验证程序插件
您需要复制存储在
中的合同
并使用以下命令生成
存根
命令
默认生成的
映射存储在目录
中
您的项目应该从此生成的映射创建附加工件与分类器
以便轻松部署到
存储库
样品配置
当存在时
存根可用于消费者自动测试
下方致电
服务
此请求由使用
验证器生成的存根配置的
服务器进行处理
方案
可以使用
验证程序处理场景
所有您需要做的是在创建合同时坚持正确的命名约定
公约要求包括后面是下划线的订单号
这样的树将导致
验证器生成名为
的
场景和三个步骤
登录标记为
指向
标记为
指向
注销标记为
这将关闭场景
有关
场景的更多详细信息
请参见
验证者还将生成具有保证执行顺序的测试
存根和传递依赖
我们创建的
和
插件是为您添加创建存根
的任务
可能有问题的是
当重用存根时
您可以错误地导入所有这些存根依赖关系
即使你有几个不同的罐子
建造一个
的工件
他们都有一个
使用这些依赖关系有三种可能性
以便不会对传递依赖性产生任何问题
将所有应用程序依赖项标记为可选
如果在
应用程序中
我们将所有的依赖项标记为可选的
当您将
存根包含在另一个应用程序中
或者当依赖关系由
下载
时
因为所有的依赖关系是可选的
它们不会被下载
为存根创建一个单独的
如果你创建一个单独的
那么你可以设置任何你想要的方式
例如通过没有依赖关系
排除消费者方面的依赖关系
作为消费者
如果将
依赖关系添加到类路径中
则可以显式排除不需要的依赖关系
验证器消息
验证器允许您验证使用消息传递作为通信方式的应用程序
我们所有的集成都使用
但您也可以自己创建并使用它
集成
您可以使用四种集成配置之一
由于我们使用
因此如果您已经将上述的一个库添加到类路径中
那么将自动设置所有的消息传递配置
重要
记住将
放在生成的测试的基类上
否则
验证器的消息传递部分将无法正常工作
手动集成测试
测试使用的主界面是
它定义了如何发送和接收消息
您可以创建自己的实现来实现相同的目标
在测试中
您可以注册
发送和接收遵循合同的消息
然后将
添加到您的测试中
例如
注意
如果您的测试也需要存根
则
包括消息传递配置
因此您只需要一个注释
发行人端测试一代
在您的
中拥有
或
部分将导致在发布商方面创建测试
默认情况下
将创建
测试
但是也可以创建
测试
我们应该考虑三个主要场景
情况
没有输入消息产生输出消息
输出消息由应用程序内部的组件触发
例如调度程序
情况
输入消息触发输出消息
方案
输入消息被消耗
没有输出消息
情景
无输入讯息
对于给定的合同
将创建以下
测试
并且将创建以下
测试
情景
输入触发输出
对于给定的合同
将创建以下
测试
并且将创建以下
测试
情景
无输出讯息
对于给定的合同
将创建以下
测试
并且将创建以下
测试
消费者存根侧代
与
部分不同
在消息传递中
我们需要使用存根发布
中的
然后在消费者端进行解析
创建适当的
路由
有关更多信息
请参阅
消息部分
的
摇篮
使用
验证程序时可能遇到的一个问题是将生成的
存根从服务器端传递到客户端
或各种客户端
在消息传递的客户端生成方面也是如此
复制
文件
手动设置客户端进行消息传递是不成问题的
这就是为什么我们会介绍可以为您自动下载和运行存根的
快照版本
将其他快照存储库添加到您的
以使用快照版本
每次成功构建后都会自动上传
的
摇篮
将存根发布为
最简单的方法是集中保留存根的方式
例如
您可以将它们作为
存储在
存储库中
小费
对于
和
来说
安装程序都是开箱即用的
但是如果你想要的话可
以自定义它
的
摇篮
模块
核心
为服务合作者运行存根
作为服务合同处理存根允许使用
作为
的实现
允许您自动下载提供的依赖项的存根
为其启动
服务器
并为其提供适当的存根定义
对于消息传递
定义了特殊的存根路由
运行存根
限制
重要
可能会在测试之间关闭端口时出现问题
您可能会遇到您遇到端口冲突的情况
只要您在测试中使用相同的上下文
一切正常
但是当上下文不同
例如不同的存根或不同的配置文件
时
您必须使用
关闭存根服务器
否则在每个测试的不同端口上运行它们
运行使用主应用程序
您可以将以下选项设置为主类
存根
存根在
文档中定义
其语法在
文档
中定义
例
查看注册的映射
每个
协作者公开
端点下定义的映射列表
消息存根
根据提供的
依赖关系和
消息路由将自动设置
规则
附带一个
规则
感谢您可以轻松地下载和运行给定组和工件
的存根
该规则执行后
连接到您的
存储库
给定的依赖关系列表尝试
下载它们
在本地缓存
将它们解压缩到临时文件夹
从提供的端口
提供的端口范围的随机端口上为每个
依赖关系启动
服务器
为
服务器提供所有具有有效
定义的
文件
使用
机制下载
依赖关系
查看他们的
文档
了解更多信息
由于
实现了
它允许您找到已启动的存根
测试中使用示例
测试中的使用示例
有关如何应用
的全局配置的更多信息
请查看
和
的
公共属性
设置
存根下载器为不同的本地存储库文件夹授予
设置
目前没有考虑存储库和配置文件的身份验证详细信息
因此您需要使用上述属性进行指定
提供固定端口
您还可以在固定端口上运行您的存根
你可以通过两种不同的方法来实现
一个是在属性中传递它
另一个是通过
规则的流畅
流畅的
使用
时
您可以添加一个存根下载
然后通过上次下载的存根的端口
您可以看到
对于此示例
以下测试是有效的
与
设置
项目的
配置
通过在配置文件中提供存根列表
自动下载并注册
中所选择的存根
如果要查找
依赖关系的
您可以自动连接
接口并使用其方法
如下所示
对于以下配置文件
您也可以使用
内的属性代替使用属性
下面您可以通过设置注释的值来找到实现相同结果的示例
为每个注册的
服务器以以下方式注册环境变量
的示例
你可以在你的代码中引用它
可以与
整合
对于现实生活中的例子
你可以检查
制作人应用程式样本
消费者应用程序样本
服务发现
的最重要的特征就是它的存在
这意味着无论您是否使用
或其他任何事情
您都不需要在测试中
我们正在启动您的依赖项的
实例
只要您直接使用
负载平衡
或
我们会告诉您的应用程序来调用这些
服务器
而不是调用真实的服务发现工具
例如这个测试将通过
对于以下配置文件
测试配置文件和服务发现
在集成测试中
您通常不想既不调用发现服务
例如
或调用服务器
这就是为什么你创建一个额外的测试配置
你要禁用这些功能
由于
实现这一点的某些限制
您可以通过下面的静态块来禁用这些属性
例如
附加配置
您可以使用
地图将存根的
与应用程序的名称进行匹配
提供
等于
您可以禁用
支持
您可以通过提供
等于
来禁用
支持
小费
默认情况下
所有服务发现都将被删除
这意味着不管事实如果你有一个现有的
它的结果将被忽略
但是
如果要重用它
只需将
设置为
然后将现有的
结果与已存在的结果合并
启动应用程序
验证者
是一个
应用程序
它暴露了
端点来触发邮件标签并访问启动的
服务器
其中一个用例是在部署的应用程序上运行一些烟雾
端到端
测试
您可以
在
博客
的
部署
文章中
阅读更多信息
如何使用它
只需添加
用
注释一个课程
建一个胖子
你准备好了
对于属性
请检查
部分
端点
返回
表示法中所有运行存根的列表
返回给定的
符号的端口
当调用端点
也可以是
消息
消息传递
返回
表示法中所有正在运行的标签的列表
执行
的触发器
对于给定的
符号
当调用端点
也可以是
时
执行具有
的触发器
例
启动服务发现
使用
的可能性之一就是将其用作
烟雾测试
的存根
这是什么意思
假设您不想将
个微服务部署到测试环境中
以检查您的应用程序是否正常工作
您在构建过程中已经执行了一系列测试
但您也希望确保应用程序的打包正常
您可以做的是将应用程序部署到环境中
启动并运行一些测试
以确定它是否正常工作
我们可以将这些测试称为烟雾测试
因为他们的想法只是检查一些测试场景
这种方法的问题是
如果您正在执行微服务
则很可能您正在使用服务发现工具
引导允许您通过启动所需的存根并将其注册到服务发现工具中来解决此问题
让我们来看看一个这样一个设置的例子
假设
已经在运行
如您所见
我们希望启动一个
引导服务器
启用
客户端
并且我们想要使存根转移功能打开
现在我们假设我们要启动这个应用程序
以便自动注册存根
我们可以通过运行应用程序
来执行此操作
其中
将包含以下属性列表
这样您的部署应用程序可以通过服务发现将请求发送到启动的
服务器
默认情况下
可能会设置
因为它们不太可能改变
这样
只要您启动
引导
您只能提供要下载的存根列表
和
的常用属性
可以使用系统属性或配置属性
对于
设置重复的某些属性
以下是他们的名称及其默认值
物业名称默认值描述
具有存根的起始
端口的最小值
具有存根的起始
端口的最小值
网址如果空白
那么将调用本地的
工件的默认分类器
如果为
则不会联系任何远程存储库以下载存根
数组的常春藤符号存根下载
可选的用户名访问使用存根存储
的工具
访问使用存根存储
的工具的可选密码
存根运动员短桩
您可以通过
系统属性提供存根下载
他们遵循以下模式
和
是可选的
如果您不提供
则会选择一个随机的
如果您不提供
那么将采用默认值
注意
你可以传递这样一个空的分类器
如果您不提供
则将通过
最新的将被下载
其中
表示
服务器的端口
重要
从版本
开始
您可以提供一系列您希望
考虑的版本
您可以
在这里
阅读有关
版本控制范围的
更多信息
取自
文件
该方案接受任何形式的版本
将版本解释为数字和字母段的序列
字符
和
以及从数字到字母的转换
反之亦然分隔版本段
分隔符被视为等同物
数字段在数学上进行比较
字母段被字典和区分大小写比较
但是
以下限定字符串被特别识别和处理
所有这些知名的限定词被认为比其他字符串更小
更老
空的段
字符串等于
除了上述限定符之外
令牌
和
可以用作最终版本段
以表示具有给定前缀的最小
最大版本
例如
表示
行中的最小版本
表示
行中最大的版本
形式
的版本范围是
的缩写
数字和字符串被认为是无法比拟的
在不同类型的版本段会相互冲突的情况下
比较将假定以前的段分别以
或
段的形式进行填充
直到种类不一致被解决为止
例如
用于消息传递
具有在内存中运行已发布存根的功能
它可以与开箱即用的以下框架集成
它还提供了与市场上任何其他解决方案集成的入口点
存根触发
要触发消息
只需使用
接口即可
为了方便起见
接口扩展了
所以只需要在你的测试中使用一个
提供以下选项来触发邮件
按标签触发
按组和人工制品
触发
通过人工制品
触发
触发所有消息
验证器
的消息传递模块为您提供了与
集成的简单方法
对于提供的工件
它将自动下载存根并注册所需的路由
将其添加到项目中
在类路径上同时拥有
和
就足够了
记住使用
注释你的测试类
例子
桩结构
让我们假设我们拥有以下
资源库
并为
应用程序配置了一个存根
并且存根包含以下结构
让我们考虑以下合同
让我们用
来表示
和
号
情景
无输入讯息
为了通过
标签触发消息
我们将使用
接口
如下所示
接下来
我们将要收听发送到
的消息的输出
接收到的消息将通过以下断言
情景
输入触发输出
由于路由是为您设置的
只需向
目的地发送消息即可
接下来我们将要收听发送到
的消息的输出
接收到的消息将通过以下断言
情景
无输出输入
由于路由是为您设置的
只需向
目的地发送消息即可
整合
验证器
的消息传递模块为您提供了一种简单的与
集成的方法
对于提供的工件
它将自动下载存根并注册所需的路由
将其添加到项目中
在类路径上同时拥有
和
就足够了
记住使用
注释测试类
例子
桩结构
让我们假设我们拥有以下
仓库
并为
应用程序配置了一个存根
并且存根包含以下结构
让我们考虑以下合同
让我们用
来表示
和
号
和以下
路由
情景
无输入讯息
为了通过
标签触发一条消息
我们将使用
接口
如下所示
接下来我们将要收听发送到
的消息的输出
接收到的消息将通过以下断言
情景
输入触发输出
由于路由是为您设置的
只需向
目的地发送一条消息即可
接下来
我们将要收听发送到
的消息的输出
接收到的消息将通过以下断言
情景
无输出输入
由于路由是为您设置的
只需向
目的地发送消息即可
流
验证器
的消息传递模块为您提供了与
集成的简单方式
对于提供的工件
它将自动下载存根并注册所需的路由
警告
在
与
的集成中
或
字符串首先被解析为一个
的频道
然后如果没有这样的
它被解析为频道名称
将其添加到项目中
在类路径上同时拥有
和
就足够了
记住用
注释你的测试类
例子
桩结构
让我们假设我们拥有以下
仓库
并为
应用程序配置了一个存根
并且存根包含以下结构
让我们考虑以下合同
让我们用
来表示
和
号
和以下
配置
情景
无输入讯息
为了通过
标签触发一条消息
我们将使用
接口
如下所示
接下来
我们将要收听发送到
为
的频道的消息的输出
接收到的消息将通过以下断言
情景
输入触发输出
由于路由是为您设置的
只需向
发送消息即可
接下来我们将要收听发送到
的消息的输出
接收到的消息将通过以下断言
情景
无输出输入
由于路由是为您设置的
只需向
目的地发送消息即可
验证器
的消息传递模块提供了一种简单的方法来与
的
模板集成
对于提供的工件
它将自动下载存根并注册所需的路由
集成尝试独立运行
即不与运行的
消息代理交互
它期望在应用程序上下文中使用
并将其用作
测试
因此
它可以使用
间谍功能来验证和内省应用程序发送的消息
在消费消费者方面
它考虑了所有
注释端点以及应用程序上下文中的所有
由于消息通常发送到
中的交换机
消息合同中包含交换机名称作为目标
另一方的消息侦听器绑定到队列
绑定将交换机连接到队列
如果触发消息合约
存根转移器集成将在与该交换机匹配的应用程序上下文中查找绑定
然后它从
交换机收集队列
并尝试查找绑定到这些队列的消息侦听器
消息被触发到所有匹配的消息监听器
将其添加到项目中
在类路径上同时拥有
和
就足够了
并设置属性
记住用
注释你的测试类
例子
桩结构
让我们假设我们拥有以下
资源库
并为
应用程序配置了一个存根
并且存根包含以下结构
让我们考虑下列合约
和以下
配置
触发消息
因此
为了触发使用上述合同的消息
我们将使用
界面如下
消息的目的地为
所以
存根转移器集成查找与此交换相关的绑定
绑定定义绑定队列
因此
以下监听器定义是一个匹配
并使用合同消息进行调用
此外
以下注释的监听器表示一个匹配并将被调用
注意
该消息直接交给
与
匹配的
方法
测试配置
为了避免
在测试期间尝试连接到运行的代理
我们配置了一个模拟
要禁用嘲弄的
设置属性
重要
请记住
在合同文件中
您必须向
类和
静态导入
提供完全限定名称
您还可以向
类
提供导入
然后调用
是用
写的
但是如果以前没有使用
不要惊慌
语言的知识并不是真正需要的
因为我们的
只使用它的一小部分
即文字
方法调用和闭包
还被设计为程序员可读
而不需要
本身的知识
它是静态类型的
小费
支持在单个文件中定义多个合同
合同存在于
验证器存储库的
模块中
我们来看一下合同定义的完整例子
不是
的所有功能都在上面的例子中使用
如果您找不到您想要的内容
请查看本页下面的段落
您可以使用独立的
命令
轻松地将
编译为
存根映射
限制
警告
验证器不正确支持
请使用
或帮助我们实现此功能
警告
对
数组的大小的验证的支持是实验性的
如果要打开它
请提供等于
的系统属性
的值
默认情况下
此功能设置为
您还可以在插件配置中提供
属性
警告
由于
结构可以有任何形式
因此在
中使用时使用
符号时
有时无法正确解析它
这就是为什么我们强烈推荐使用
符号
常见的顶级元素
描述
您可以添加一个
到您的合同
除了一个任意的文本
例
名称
您可以提供您的合同名称
假设您提供了一个名称
如果这样做
则自动生成测试的名称将等于
如果是
存根
存根的名称也将为
重要
请确保该名称不包含任何会使生成的测试无法编译的字符
还要记住
如果您为多个合同提供相同的名称
那么您的自动生成测试将无法编译
并且生成的存根将会相互覆盖
忽略合同
如果您想忽略合同
您可以在插件配置中设置忽略合同的值
或者仅在合同本身设置
属性
顶级元素
可以在合同定义的顶层关闭中调用以下方法
请求和响应是强制性的
优先级是可选的
请求
协议只需要在请求中指定
方法和地址
在合同的请求定义中
相同的信息是强制性的
可以指定整个
而不是路径
但是
是测试与
主机无关的推荐方法
请求可能包含
查询参数
这些参数在嵌套在
或
的调用中的闭包中指定
它可能包含其他
请求标头
和
请求机构
响应
最小响应必须包含
状态代码
除了状态响应可能包含
标头
和
正文
之外
它们与请求中的方式相同
参见前一段
动态属性
合同可以包含一些动态属性
时间戳
等
您不想强制使用者将其时钟保留为始终返回相同的时间值
以便与存根匹配
这就是为什么我们允许您以两种方式在合同中提供动态部分
一个是将它们直接传递到体内
一个将它们设置在另一部分
称为
和
体内动态属性
您可以通过
方法设置体内的属性
或者如果您正在使用
地图符号
您可以使用
方法
所有上述方法都是相同的
这意味着
和
方法是
方法的别名
我们来仔细看看我们可以在后续章节中对这些值做些什么
正则表达式
您可以使用正则表达式在
中写入请求
当您想要指出给定的响应应该被提供给遵循给定模式的请求时
这是特别有用的
此外
当您需要使用模式
而不是测试和服务器端测试时
您可以使用它
请看下面的例子
您还可以使用正则表达式仅提供通信的一方
如果这样做
那么我们将自动提供与提供的正则表达式匹配的生成的字符串
例如
在该示例中
对于请求和响应
通信的相对侧将具有生成的相应数据
附带一系列预定义的正则表达式
您可以在合同中使用
所以在你的合同中你可以这样使用它
传递可选参数
可以在您的合同中提供可选参数
只能有可选参数
侧请求
响应的
侧
例
通过使用
方法包装身体的一部分
您实际上正在创建一个应该存在
次或更多次的正则表达式
如果您选择
那么上述示例将会生成以下测试
和以下存根
在服务器端执行自定义方法
也可以在测试期间定义要在服务器端执行的方法调用
这样的方法可以添加到在配置中定义为
的类中
例
合同
基础班
重要
您不能同时使用
和
来执行连接
例如呼叫
将导致不正确的结果
要使此工作只需调用
并确保
方法返回您需要的所有内容
从响应引用请求
最好的情况是提供固定值
但有时您需要在响应中引用请求
为了做到这一点
您可以从
方法中获利
从而允许您从
请求中引用一堆元素
您可以使用以下选项
返回请求
返回具有给定名称的第一个查询参数
返回具有给定名称的第
个查询参数
返回具有给定名称的第一个标题
返回具有给定名称的第
个标题
返回完整的请求体
从与
路径匹配的请求中返回元素
我们来看看下面的合同
运行
测试代码将导致创建一个或多或少这样的测试
您可以看到请求中的元素在响应中已被正确引用
生成的
存根将看起来或多或少是这样的
因此
发送请求作为合同
部分提出的请求将导致发送以下响应主体
重要
此功能仅适用于版本大于或等于
的
我们正在使用
的
响应变压器
它使用
将
模板转换成正确的值
另外我们正在注册
个帮助函数
以可嵌入
的格式转义请求正文
另一个是
对于给定的参数知道如何在请求体中查找对象
匹配部分的动态属性
如果您一直在使用
这似乎很熟悉
很多用户习惯于在身体和设定合约的动态部分之间进行分隔
这就是为什么你可以从两个不同的部分获利
一个称为
您可以在其中定义应该存在于存根中的动态值
您可以在合同的
或
部分设置
另一个称为
它存在于合同的
或
方面
目前
我们仅支持具有以下匹配可能性的基于
路径的匹配器
对于
通过提供的
路径从响应中获取的值需要等于合同中提供的值
通过提供的
路径从响应中获取的值需要与正则表达式匹配
通过提供的
路径从响应中获取的值需要与
的正则表达式匹配
通过提供的
路径从响应中获取的值需要与
的正则表达式匹配
通过提供的
路径从响应中获取的值需要匹配
时间的正则表达式
对于
通过提供的
路径从响应中获取的值需要等于合同中提供的值
通过提供的
路径从响应中获取的值需要与正则表达式匹配
通过提供的
路径从响应中获取的值需要与
的正则表达式匹配
通过提供的
路径从响应中获取的值需要匹配
的正则表达式
通过提供的
路径从响应中获取的值需要匹配
时间的正则表达式
通过提供的
路径从响应中获取的值需要与合同中的响应正文中定义的类型相同
可以关闭
您可以设置
和
这样你可以断定集合的大小
通过提供的
路径从响应中获取的值将作为您提供的自定义方法的输入传递
例如
将导致调用匹配
路径的值将被通过的
方法
我们来看看下面的例子
在这个例子中
我们在匹配器部分提供合同的动态部分
对于请求部分
您可以看到对于所有字段
但是
我们正在明确地设置我们希望存根包含的正则表达式的值
对于
验证将以与不使用匹配器相同的方式进行
在这种情况下
测试将执行相等检查
对于
部分的响应方面
我们以类似的方式定义所有的动态部分
唯一的区别是我们也有
匹配器
在这种情况下
我们正在检查
个字段
我们正在验证测试的响应是否具有一个值
其
路径与给定字段匹配的类型与响应主体中定义的相同
对于
我们只是检查类型是否相同
对于
我们正在检查类型
并声明大小是否大于或等于最小出现次数
对于
我们正在检查类型
并声明大小是否小于或等于最大值
对于
我们正在检查类型
并确定大小是否在最小和最大值之间
所得到的测试或多或少会看起来像这样
请注意
我们将自动生成的断言与匹配器与
部分分开
和
这样的
支持
我们支持
基类需要定义
和服务器初始化
现在唯一的选择如何测试
是启动一个
服务器
使用身体的请求需要设置内容类型
否则将使用
为了使用
模式
请使用以下设置
生成测试
的示例
异步支持
如果您在服务器端使用异步通信
您的控制器正在返回
等等
然后在合同中您必须在
部分中提供
方法
使用上下文路径
支持上下文路径
重要
为了完全支持上下文路径
唯一改变的是在
端的切换
自动生成测试需要使用
模式
消费者方面保持不变
为了让生成的测试通过
您必须切换
模式
的
摇篮
这样就可以生成
不
使用
的测试
这意味着您正在生成真实的请求
您需要设置生成的测试的基类以在真正的套接字上工作
让我们想象下面的合同
以下是一个如何设置基类和
的示例
以使所有操作都正常工作
这样一来
您自动生成测试中的所有请求都将发送到包含上下文路径的实际端点
例如
您的合同反映出您具有上下文路径
因此您生成的存根也将具有该信息
例如
在存根中您将看到您也调用了
消息传递顶级元素
消息传递的
与重点在
上的
有点不同
由方法触发的输出
可以通过调用方法来触发输出消息
例如
调度程序启动并发送消息
在这种情况下
如果将执行一个称为
的方法
输出消息将被发送到
在消息
发布者的
一方
我们将生成一个测试
该测试将调用该方法来触发该消息
在
消费者
端
您可以使用
触发消息
由消息触发的输出
可以通过接收消息来触发输出消息
在这种情况下
如果
目的地收到正确的消息
则输出消息将被发送到
在消息
发布者的
一方
我们将生成一个测试
它将输入消息发送到定义的目的地
在
消费者
端
您可以向输入目的地发送消息
也可以使用
触发消息
消费者
生产者
在
中
您有一个概念
符号
您也可以在消息中使用它们
但是我们还提供了下面提供的
和
方法
请注意
您可以使用
或
方法来提供
和
部分
一个文件中的多个合同
可以在一个文件中定义多个合同
这样的合同的例子可以这样看
在这个例子中
一个合同有
字段
另一个没有
这将导致生成两个或多或少这样的测试
请注意
对于具有
字段的合同
生成的测试方法名为
对于没有名称的人
它对应于文件
的名称和列表中的合同索引
生成的存根将看起来像这样
您可以看到第一个文件从合同中获取了
参数
第二个获得了以索引为前缀的合同文件
的名称
在这种情况下
合同在文件中的合同列表中具有索引
小费
正如你可以看到
如果您的合同名称更好
那么您的测试更有意义
定制
扩展
可以向
提供自己的功能
此功能的关键要求是保持静态兼容性
下面你可以看到一个例子
创建具有可重用类的
在
中引用这些类
这里
可以找到完整的例子
普通
下面你可以找到我们将在
中重用的三个类
包含
消费者
和
制作者使用的功能
包含由使用功能的
消费者
包含由使用的功能
制片人
将依赖项添加到项目中
为了使插件和
能够引用常见的
类
您需要将依赖关系传递给您的项目
测试依赖项目的依赖关系
首先将常见的
依赖项添加为测试依赖关系
这样
由于您的合同文件在测试资源路径中可用
所以公用的
类将自动显示在您的
文件中
的
摇篮
测试插件依赖关系
现在你必须添加插件的依赖关系
以便在运行时重用
的
摇篮
在
中引用类
现在您可以参考
中的课程
例
可插拔架构
在某些情况下
您将合同定义为其他格式
如
或
另一方面
您希望从测试和存根生成中获利
添加自己的任何一个实现是很容易的
此外
您还可以自定义测试生成的方式
例如
您可以为其他语言生成测试
并且可以对存根生成执行相同操作
可为其他存根
服务器实现生成存根
定制合同转换器
我们假设您的合同是用
文件写成的
感谢界面
您可以注册自己的合同结构转换器的实现
您的实现需要说明开始转换的条件
此外
您必须定义如何以两种方式执行转换
重要
创建实施后
您必须创建一个
文件
您可以在其中提供实施的完全限定名称
文件的示例
和
实现
契约转换器
提供了
协议
代表合同的开箱即用支持
换句话说
而不是使用
您可以使用
文件
在本节中
我们将介绍如何为您的项目添加此类支持
契约契约
我们将在下面的一个契约契约的例子中工作
我们将此文件放在
文件夹下
生产者契约
在生产者方面
您可以添加两个附加依赖关系的插件配置
一个是
支持
另一个表示您正在使用的当前
版本
的
摇篮
当您执行应用程序的构建时
将会产生一个或多或少的这样的测试
并且这样的存根看起来像这样
消费者契约
在生产者方面
您可以添加项目依赖关系两个附加依赖关系
一个是
支持
另一个表示您正在使用的当前
版本
的
摇篮
定制测试发生器
如果您想为
生成不同语言的测试
或者您不满意我们为您建立
测试的方式
那么您可以注册自己的实现来做到这一点
感谢界面
您可以注册自己的生成测试的实现
再次提供一个合适的
文件就足够了
例
自定义存根发生器
如果要为
生成其他存根服务器的存根
就可以插入您自己的此接口的实现
您可以注册自己的生成存根的实现
再次提供一个合适的
文件就足够了
例
默认实现是
存根生成
小费
您可以提供多个存根生成器实现
这样
例如从单个
作为输入
您可以例如生成
存根和
文件
自定义
如果您决定使用自定义存根生成器
则还需要使用不同的存根提供程序来运行存根的自定义方式
让我们假设您正在使用
来构建您的存根
你写了一个正确的存根生成器
你的存根被放在一个
文件中
为了
知道如何运行存根
您必须定义一个自定义的
服务器实现
它可以看起来像这样
并将其注册到您的
文件中
这样你就可以使用
来运行存根
重要
如果您不提供任何实现
那么将选择默认的
基于
的
如果您提供多个
那么列表中的第一个将被选中
自定义存根下载器
您可以自定义存根的下载方式
如果您不想以默认方式从
下载
您可以设置自己的实现
下面您可以找到一个
示例
它从
的测试资源获取
文件
将它们复制到临时文件
然后将该临时文件夹作为存根的根传递
并将其注册到您的
文件中
这样你就可以选择一个文件夹与你的存根的来源
重要
如果您没有提供任何实现
那么将选择从远程备份中下载存根的默认
如果您提供多个
那么列表中的第一个将被选中
链接
在这里
您可以找到有关
验证器的有趣链接
样本
文档
遗产文件
文档
消息传递文档
插件
附录
配置纲要
名称默认描述
标记说
如果存在加密或解密错误
进程将失败
对称密钥
作为一个更强大的替代方案
考虑使用密钥库
商店中的钥匙别名
密钥存储文件的位置
例如
锁定密钥库的密码
秘密保护密钥
默认为密码相同
使用
算法
或
一旦设置不改变它
或现有的密码将不可解密
用于加密密文的随机秘密
一旦设置不改变它
或现有的密码将不可解密
标志表示应该在内部使用
强
加密
如果为真
则将
算法应用于
加密字节
默认值为
在这种情况下使用
标准
代替
一旦设置不改变它
或现有的密码将不可解密
通过
将环境更改为
启用
暂停端点
发送
启用
端点刷新配置并重新初始化刷新作用域
启用
端点重新启动应用程序上下文
启用
端点
发送
启用
端点来检查
的状态
指示服务器是否可以将客户端请求重定向到备份服务器
集群
如果设置为
服务器将直接处理请求
如果设置为
则可能会向客户端发送
重定向
并具有新的服务器位置
获取此实例所在区域的可用性区域列表
用于
数据中心
更改在运行时在
指定的下一个注册表提取周期中有效
获取执行
的实现的名称
以便仅在
客户端启动时首次将注册表信息作为回退选项提取
对于需要额外的弹性的注册表信息的应用程序可能需要这一点
而无法运行它们
缓存刷新执行者指数退出相关属性
在发生超时序列的情况下
它是重试延迟的最大乘数值
初始化的线程池大小
客户端数据接受名称
这是一个瞬态配置
一旦最新的编解码器稳定
可以删除
因为只有一个
指示
客户端是否应该禁用提取
而应该诉诸于获取完整的注册表信息
请注意
增量获取可以极大地减少流量
因为尤利卡服务器的更改速率通常远低于提取速率
更改在运行时在
指定的下一个注册表提取周期中有效
在
服务器的序列化
反序列化信息期间
获取
符号
的替换字符串
标记以指示启用
客户端
这是一个瞬态配置
一旦最新的编解码器稳定
可以删除
因为只有一个
在
服务器的序列化
反序列化信息期间获取下划线符号
的替换字符串
表示到
服务器的
连接可以在关闭之前保持空闲状态的时间
以秒为单位
在
环境中
建议值为
秒或更短
因为防火墙在几分钟内清除连接信息
将连接挂在空中
指示在连接到
服务器需要超时之前等待
以秒为单位
的时间
请注意
客户端中的连接由
汇集
此设置会影响实际的连接创建以及从池中获取连接的等待时间
获取要查询的
名称以获取
服务器的列表
如果合同通过实现
返回服务
则不需要此信息
当
设置为
时
使用
机制
而
客户端希望
以某种方式配置
以便可以动态获取更改的
服务器
更改在运行时有效
获取用于构建服务
的端口
以在
服务器列表来自
时联系
服务器
如果合同返回服务
则不需要此信息
当
设置为
时
使用
机制
而
客户端希望
以某种方式配置
以便可以动态获取更改的
服务器
更改在运行时有效
指示从
服务器读取之前需要等待
秒
多久才能超时
获取从
客户端到所有
服务器允许的总连接数
获取从
客户端到
服务器主机允许的总连接数
获取用于构建服务网址的
上下文
以便在
服务器列表来自
时联系
服务器
如果合同从
返回服务网址
则不需要此信息
当
设置为
时
使用
机制
而
客户端希望
以某种方式配置
以便可以动态获取更改的
服务器
更改在运行时有效
表示轮询对
服务器信息进行更改的频率
以秒为单位
可以添加或删除
服务器
此设置控制
客户端应该知道的时间
指示该客户端是否应从
服务器获取
注册表信息
逗号分隔将获取
注册表信息的区域列表
必须为
返回的每个区域定义可用性区域
否则
将导致发现客户端启动失败
指示是否在仅具有
状态的实例的过滤应用程序之后获取应用程序
指示从服务器支持时
是否必须压缩从
服务器提取的内容
来自
服务器的注册表信息被压缩以获得最佳的网络流量
心跳执行者指数回撤相关财产
在发生超时序列的情况下
它是重试延迟的最大乘数值
执行器初始化的线程池大小
指示将实例信息复制到
服务器的开始时间
以秒为单位
指示复制要复制到
服务器的实例更改的频率
以秒为单位
指示在注册表信息方面是否记录
服务器和
客户端之间的差异
客户端尝试仅从欧莱雅服务器检索增量更改以最小化网络流量
收到三角形后
客户端将从服务器的信息进行协调
以验证它是否已经没有漏掉一些信息
当客户端发生网络问题与服务器通信时
可能会发生调解失败
如果对帐失败
客户端将获得完整的注册表信息
在获取完整的注册表信息的同时
客户端可以记录客户端和服务器之间的差异
并且此设置控制它
更改在运行时在
指定的下一个注册表提取周期中有效
如果设置为
则通过
进行的本地状态更新将触发对远程
服务器的按需
但限速
注册
更新
指示此实例是否应尝试在同一区域中使用尤里卡服务器延迟和
或其他原因
理想情况下
客户端配置为与同一区域中的服务器通信
更改在运行时在
指定的下一个注册表提取周期中有效
获取代理主机到
服务器
如果有的话
获取代理密码
如果有
获取代理端口到
服务器
如果有的话
获取代理用户名
如果有
获取此实例所在的区域
用于
数据中心
指示此实例是否应将其信息注册到
服务器以供其他人发现
在某些情况下
您不希望发现实例
而您只想发现其他实例
指示从
服务器获取注册表信息的频率
以秒为单位
指示客户端是否只对单个
的注册表信息感兴趣
可用性区域映射到与
服务器通信的完全限定
的列表
每个值可以是单个
或逗号分隔的替代位置列表
通常
尤里卡服务器
携带协议
主机
端口
上下文和版本信息
如果有的话
示例
更改在运行时在
指定的下一个服务网址刷新周期中有效
指示
客户端是否应该使用
机制来获取要与之通信的
服务器列表
当
名称更新为具有其他服务器时
该信息将在
客户端轮询该
中指定的信息之后立即使用
或者
服务
可以返回
但用户应该实现自己的机制来返回更新的列表
以防发生更改
更改在运行时有效
标志以启用
仪表板
默认值为
到
仪表板
相对于
路径
的路径
默认为
获取与此实例关联的
自动缩放组名称
该信息在
环境中专门用于在实例启动后自动将实例停止运行
并且已将其禁用
获取要在
中注册的应用程序组的名称
获取要在
注册的应用程序的名称
返回此实例部署的数据中心
如果实例部署在
中
则此信息用于获取一些
特定实例信息
获取此实例的绝对运行状况检查页面
如果运行状况检查页面驻留在与
通话的同一个实例中
用户可以提供
否则在实例是其他服务器的代理的情况下
用户可以提供完整的
如果提供完整的
则优先
它通常用于根据实例的健康状况做出有根据的决策
例如
它可用于确定是否继续部署到整个场
或者停止部署而不会造成进一步的损坏
完整的
应遵循格式
其中值
在运行时被替换
获取此实例的相对运行状况检查
路径
然后
健康检查页面
由主机名和通信类型构建
如
和
中指定的安全或不安全
它通常用于根据实例的健康状况做出有根据的决策
例如
它可用于确定是否继续部署到整个场
或者停止部署而不会造成进一步的损坏
获取此实例的绝对主页
如果主页位于与
通话的同一个实例中
用户可以提供
否则在实例是其他服务器的代理的情况下
用户可以提供完整的
如果提供完整的
则优先
它通常用于其他服务的信息目的
以将其用作着陆页
完整的
应遵循格式
其中值
在运行时被替换
获取此实例的相对主页
路径
然后
主页
由
和通信类型构建
安全或不安全
它通常用于其他服务的信息目的
以将其用作着陆页
如果可以在配置时确定主机名
否则将从操作系统原语中猜出
使用
服务器注册的初始状态
指示在
注册后
实例是否应该启用流量
有时候
应用程序可能需要做一些预处理
才能准备好交通
获取要在
注册的此实例的唯一
在
的范围内
获取实例的
此信息仅用于学术目的
因为来自其他实例的通信主要发生在使用
中提供的信息
指示
服务器在接收到最后一个心跳之后等待的时间
秒
然后才能从此视图中删除此实例
并禁止此实例的流量
将此值设置得太长可能意味着流量可以路由到实例
即使实例不存在
设置此值太小可能意味着
由于临时网络故障
实例可能会被取消流量
此值将设置为至少高于
中指定的值
指示
客户端需要向
服务器发送心跳以指示它仍然存在的频率
以秒为单位
如果在
中指定的时间段内未收到心跳线
则
服务器将从其视图中删除该实例
因此不允许此实例的流量
请注意
如果该实例实现
然后决定使其本身不可用
则该实例仍然可能无法访问流量
获取与此实例关联的元数据名称
值对
该信息发送到
服务器
可以被其他实例使用
获取用于查找属性的命名空间
忽略
获取实例应该接收流量的非安全端口
指示是否应启用非安全端口的流量
标示说
当猜测主机名时
服务器的
地址应该在操作系统报告的主机名中使用
用于确定租赁期间取消的价值
独立时默认为
应该为对等复制的
设置为
获取此实例的绝对安全运行状况检查页面
如果健康检查页面驻留在与
通话的同一个实例中
用户可以提供
否则在实例是其他服务器的代理的情况下
用户可以提供完整的
如果提供完整的
则优先
它通常用于根据实例的健康状况做出有根据的决策
例如
它可用于确定是否继续部署到整个场
或者停止部署而不会造成进一步的损坏
完整的
应遵循格式
其中值
在运行时被替换
获取实例应该接收流量的安全端口
指示安全端口是否应启用流量
获取为此实例定义的安全虚拟主机名
这通常是其他实例通过使用安全虚拟主机名找到此实例的方式
这与完全限定域名相似
您的服务的用户将需要找到此实例
获取此实例的绝对状态页面
路径
如果状态页面驻留在与
通话的同一个实例中
用户可以提供
否则在实例是其他服务器的代理的情况下
用户可以提供完整的
如果提供完整的
则优先
它通常用于其他服务的信息目的
以查找此实例的状态
用户可以提供一个简单的
来指示实例的当前状态
获取此实例的相对状态页面
路径
然后
状态页面
由安全端口和非安全端口中指定的
和通信类型构建
安全或不安全
它通常用于其他服务的信息目的
以查找此实例的状态
用户可以提供一个简单的
来指示实例的当前状态
获取为此实例定义的虚拟主机名
这通常是其他实例通过使用虚拟主机名找到此实例的方式
这与完全限定域名相似
您的服务的用户将需要找到此实例
支持的
类型列表
最小阈值内容大小
标记以指示应安装配置服务器运行状况指示器
生成缓存结果的时间
以毫秒为单位
默认
分钟
启用
指标轮询
默认为
后续轮询度量之间的间隔
默认为
启用刷新范围的运行状况端点
启用
的健康端点
当
达到这个大小时
会记录一个警告
如果您在
中使用字符串连接
这将非常有用
使用的监视器注册表的完全限定类名
每个路由的认证策略
想要听
的服务
默认为
表示所有服务
标志关闭
默认打开
名称
消息的流目的地
标志表示总线已启用
标志关闭环境变化事件
默认为开
关闭刷新事件的标志
默认为开
打开
跟踪的标志
默认关闭
标记以指示启用发现
心跳次数以毫秒为单位的频率
客户端将轮询该频率并广播服务
列表
要进行身份验证的组织名称
默认为用户默认值
用户验证和获取令牌的密码
要进行身份验证的空间名称
默认为用户默认值
云控制器
的
验证用户名
通常是电子邮件地址
标记以指示可以使用
设置为
以防止用户意外更改默认值
默认值为
客户端使用的授权令牌连接到服务器
标记以指示启用配置服务器发现
配置服务器
将通过发现查找
服务
来定位配置服务器
标记说远程配置启用
默认为
标记表示无法连接到服务器是致命的
默认为
用于拉取远程配置属性的标签名称
默认设置在服务器上
通常是基于
的服务器的
主
用于获取远程属性的应用程序名称
标志表示当
为
时
外部属性应该采用最低优先级
并且不覆盖任何现有的属性源
包括本地配置文件
默认为
标记以指示外部属性应覆盖系统属性
默认值为
联系远程服务器时使用的密码
获取远程配置时使用的默认配置文件
逗号分隔
默认为
默认
初始重试间隔
以毫秒为单位
最大尝试次数
退避的最大间隔
下一个间隔的乘数
表示配置服务器应使用远程存储库中的属性初始化其自己的环境
默认情况下关闭
因为它会延迟启动
但在将服务器嵌入到另一个应用程序中时很有用
传入请求没有特定的默认应用程序名称
传入请求没有特定标签时的默认存储库标签
传入请求没有特定的默认应用程序配置文件时
在发送给客户端之前启用对环境属性的解密
库的本地工作副本的基本目录
标记以表明应该在启动时克隆存储库
不是按需
通常会导致启动速度较慢
但
第一次查询更快
标记表示存储库应该强制拉
如果真的丢弃任何本地更改并从远程存储库获取
使用远程存储库验证密码
存储库标识符映射到位置和其他属性
在本地工作副本中使用的搜索路径
默认情况下只搜索根
用于获取
或
连接的超时
以秒为单位
如果适用
默认
秒
远程存储库的
用于远程存储库的身份验证用户名
标识以确定在解密期间如何处理异常
默认为
搜索配置文件的位置
默认与
应用程序相同
因此
为本地存储库报告的版本字符串
无条件发送给所有客户的资源的额外地图
配置资源路径的前缀
默认为空
当您不想更改上下文路径或
路径时嵌入其他应用程序时很有用
标记为指示作为文本或集合
而不是映射
的
文档应以
本机
形式返回
库的本地工作副本的基本目录
用于环境属性请求的默认标签
使用远程存储库验证密码
在本地工作副本中使用的搜索路径
默认情况下只搜索根
远程存储库的
用于远程存储库的身份验证用户名
安全令牌通过到底层环境库
远程服务器的
默认
联系远程服务器时使用的用户名
如果格式为
或
则使用以下字段来查找协调配置
在配置查找期间抛出异常
如果为
否则为日志警告
手表的固定延迟的价值在毫秒
默认为
如果手表启用默认为
等待
或阻止
观看查询的秒数
默认为
需要小于默认的
默认为
要增加
超时
使用自定义的
创建一个带有自定义
的
如果没有在
中列出
请在服务列表中查询标签
服务实例区域来自元数据
这允许更改元数据标签名称
是否启用服务发现
在服务注册期间抛出异常
如果为
否则
记录警告
默认为
执行健康检查的频率
例如
调用健康检查的备用服务器路径
健康检查超时
例如
自定义健康检查网址覆盖默认值
访问服务器时使用的主机名
唯一的服务实例
服务实例区
访问服务时使用的
地址
还必须设置
才能使用
端口注册管理服务
默认为管理端口
注册管理服务时使用后缀
注册管理服务时使用的标签
端口注册服务
默认为侦听端口
我们将如何确定使用地址的来源
在注册时使用
地址而不是主机名
将
参数添加到
这会将健康检查推送到服务器
注册为领事服务
注册领事健康检查
在开发服务期间有用
是否注册
或
服务
服务器列表中要查询的
的
标签的映射
这允许通过单个标签过滤服务
服务名称
注册服务时使用的标签
启用了
代理主机名
默认为
代理端口
默认为
初始重试间隔
以毫秒为单位
最大尝试次数
退避的最大间隔
下一个间隔的乘数
默认主机名
用于发生错误的情况
默认
用于发生错误的情况
将被忽略的网络接口的
正则表达式列表
将被忽略的网络地址的
正则表达式列表
计算主机名的超时秒数
仅使用与站点本地地址的接口
有关详细信息
请参阅
重试之间等待的初始时间
与
连接时阻止的时间单位
等待时间阻止连接到
连接字符串到
集群
将检查以验证依赖关系是否存在的默认运行状况端点
将别名映射到
从
的角度看
别名实际上是
因为
不能接受
中的嵌套结构
预定义的主机可以在
中注册自己的服务
对应于
规范中的
端口注册服务
默认为侦听端口
获取与此实例关联的元数据名称
值对
该信息被发送到动物管理员
可以被其他实例使用
在动物园管理员中注册为服务
所有实例都被注册的根
文件夹
在
服务注册期间解决的
规范
启用了
最多重试次数
每次重试最多可以以
为单位睡眠
将应用于所有
依赖关系的路径的公共前缀
修复默认轮询器的延迟
默认轮询器每轮询的最大消息
启用
侦察器
一组简单的模式
通道名称将与之匹配
默认值为
所有通道
请参阅
具有使用
注释的方法的类的简单名称
从异步进程开始
使用
注释的方法的名称
如果标题名称被添加为标签
则使用前缀
执行异步方法的线程的名称
额外的标题应该作为标签添加
如果它们存在
如果头值是多值的
则标签值将是逗号分隔的单引号列表
或主机头的域部分
示例
用于过滤主机而不是
地址
方法或动词
如
或
用于过滤
路由
绝对的
路径
没有任何查询参数
示例
用于过滤
路由
可以与
一起移植
在
中
只支持等于过滤器
删除查询参数使不同
的数量减少
例如
无论查询行中编码的签名参数如何
都可以查询相同的资源
这不会降低
单路由的基数
例如
通常将路由表示为
模板
如
在只有等量查询可用的系统中
如果实际请求是
则搜索
将不匹配
历史记录
这通常在拉链中被表示为
但最常见的只是一条路
如果标题名称被添加为标签
则使用前缀
非空
请求体的大小
以字节为单位
防爆
大上传可能会超出限制或直接影响延迟
非空
响应体的大小
以字节为单位
防爆
大量下载可能会超出限制或直接影响延迟
当
响应代码不在
范围内
防爆
用于过滤错误状态
范围不会被记录
因为成功代码对延迟故障排除不那么有趣
省略节省每个跨度至少
个字节
整个
包括方案
主机和查询参数
如果可用
防爆
结合
您可以了解完全限定的请求行
这是可选的
因为它可能包括私人数据或相当长的长度
命令组的名称
使用命令组密钥将诸如报告
警报
仪表板或团队
库所有权的命令分组在一起
命令键的名称描述给定命令的名称
代表用于监视
断路器
指标发布
缓存和其他此类用途的
的关键
如果标题名称被添加为标签
则使用前缀
线程池密钥的名称
线程池密钥表示用于监视
指标发布
缓存和其他此类用途的
甲
与单个相关的
如由检索
注入它
或者它的默认值使用
创建的创建它
额外的标题应该作为标签添加
如果它们存在
如果头值不是
它将使用其
方法转换为
估计有效载荷的大小
如果有的话
有效载荷的类型
如果标题名称被添加为标签
则使用前缀
小写
连字符分隔处理请求的类的名称
防爆
名为
的类将导致
标签值
小写
连字符分隔处理请求的类的名称
防爆
名为
的方法将导致
标签值
应采样的请求百分比
例如
的请求应该被抽样
精度仅为全数
即不支持
的痕迹
如果为
则生成
位跟踪
而不是
位跟踪
标识以确定代理是否转发主机头
标识以确定代理是否添加
标头
单个路由可以使用的最大连接数
代理可以容纳到后端的总连接数
标记说
如果
在类路径上
则将
添加到忽略的标头
通过将
设置为
我们可以关闭此默认行为
这应该与禁用默认的
标头一起使用
请参见
标头的名称完全忽略
即将其从下游请求中删除
并将其从下游响应中删除
一组服务名称不考虑代理自动
默认情况下
发现客户端中的所有服务都将被代理
所有路由的公共前缀
标记说
可以删除超过第一个分号的路径元素
默认情况下是否支持重试的标志
假设路由本身支持
将路线名称映射到属性
一般预期由
安全性添加的标头
因此如果代理和后端使用
保护
则通常会重复
默认情况下
如果存在
安全性
并且
它们将被添加到忽略的标头
的总信号量的最大数量
不传递到下游请求的敏感标头列表
默认为通常包含用户凭据的
安全
标题集
如果下游服务是与代理相同的系统的一部分
那么从列表中删除它们是正确的
所以他们正在共享认证数据
如果在您自己的域之外使用物理
那么一般来说泄漏用户凭据将是一个坏主意
安装
作为
的路径
不是
的一部分
对于具有大型机构的请求
例如文件上传
对于更高的内存效率更高
标记以说明是否应验证
连接的主机名
默认值为
这只应用于测试设置
在转发之前标记是否从路径中删除前缀
标记说可以跟踪请求机构
分布式系统
著作权归作者所有
举报文章
卡卡罗
下载
生成长微博图片
更多分享
构建微服务架构之九
消息总线
本文参考了
问题
如何实现对配置信息的实时更新
虽然
我们已经能够通过
接口和
仓库的
入门手册
服务器配置
重要说明
本方是翻译自
这个文章
感谢
学习
服务注册与发现
学习
服务注册与发现
简介
是一个基于
实现的云应用开发工具
它为基于
的云应用开发中的配置管理
服务发现
断路器
智能路由
微代理
控制总线
全局锁
决策竞选
分布式会话和
微服务架构集大成者
软件是有生命的
你做出来的架构决定了这个软件它这一生是坎坷还是幸福
本文不是讲解如何使用
的教程
而是探讨
是什么
以及它诞生的背景和意义
背景
年以后
国内互联网行业飞速发展
我们对软件系统的需求已经不再是过去
猛然醒悟
猛然醒悟
不知有过多少次这种经历
总在事情已经发生过后
猛然发现事情背后隐藏的故事
不管是与她相处
与他相处
还是与它相处
醒悟过后总是有那么一点点感伤与遗憾
虽然很多时候都想去做些什么来弥补
不过弥补的过程总是那么艰辛
以至于有些已经无法弥补
此刻才终于明白
为什么人
一些链接
官方文档
美团
学习日语五十音唱喜欢日语的歌曲
老司机告诉如何学习
本文内容由日语小伙龙龙整理发布
帮助更多学习日语的伙伴走出困境
喜欢的话
可以订阅一发
每日分享日语干货
动漫
文化
歌曲等
五十音图就是日语最基础的基础
也就是地基
由于日语的元音比较单调
只有
这五种
再和各种辅音搭配
组合出五十音图
因此之前油酱也说
日语小伙龙龙
兰州最全公交线路图
再也不怕坐错车下错站了
路
夏季
冬季
兰州车站
和平饭店
兰州大学
盘旋路西口
渭河源特产商场
兰州华夏医院
广场东口
广场西口
静宁路口
市博物馆
南关十字
双城门
西关十字
西湖公园
公交集团
七里河桥
兰州西站
路
看见兰州
子钰学理财
目录
子钰学理财
我为什么要学理财
子钰学理财
书单
入门篇
子钰学理财
小狗钱钱
告诉我们的财富法则
上
子钰学理财
小狗钱钱
告诉我们的财富法则
下
子钰学理财
如何走上财务自由之路
子钰学理财
富爸爸穷爸爸
的作者早就破产
杨子钰